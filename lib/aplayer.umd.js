(function(G,Ce){typeof exports=="object"&&typeof module!="undefined"?module.exports=Ce(require("vue")):typeof define=="function"&&define.amd?define(["vue"],Ce):(G=typeof globalThis!="undefined"?globalThis:G||self,G["vueplug-aplayer"]=Ce(G.Vue))})(this,function(G){"use strict";if(typeof window!="undefined"){let N=function(){var W=document.body,k=document.getElementById("__svg__icons__dom__");k||(k=document.createElementNS("http://www.w3.org/2000/svg","svg"),k.style.position="absolute",k.style.width="0",k.style.height="0",k.id="__svg__icons__dom__",k.setAttribute("xmlns","http://www.w3.org/2000/svg"),k.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),k.innerHTML='<symbol  viewBox="0 0 32 32" id="icon-loading"><path d="M4 16C4 9.4 9.4 4 16 4s12 5.4 12 12c0 1.2-.8 2-2 2s-2-.8-2-2c0-4.4-3.6-8-8-8s-8 3.6-8 8 3.6 8 8 8c1.2 0 2 .8 2 2s-.8 2-2 2C9.4 28 4 22.6 4 16z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-lrc"><path d="M26.667 5.333H5.333a2.667 2.667 0 0 0-2.666 2.666V24.001a2.667 2.667 0 0 0 2.666 2.666h21.335a2.667 2.667 0 0 0 2.666-2.666V7.999a2.667 2.667 0 0 0-2.666-2.666h-.001zM5.333 16h5.333v2.667H5.333V16zm13.334 8H5.334v-2.667h13.333V24zm8 0h-5.333v-2.667h5.333V24zm0-5.333H13.334V16h13.333v2.667z" /></symbol><symbol  viewBox="-5 0 32 32" id="icon-menu"><path d="M20.8 14.4q.704 0 1.152.48T22.4 16t-.48 1.12-1.12.48H1.6q-.64 0-1.12-.48T0 16t.448-1.12T1.6 14.4h19.2zM1.6 11.2q-.64 0-1.12-.48T0 9.6t.448-1.12T1.6 8h19.2q.704 0 1.152.48T22.4 9.6t-.48 1.12-1.12.48H1.6zm19.2 9.6q.704 0 1.152.48t.448 1.12-.48 1.12-1.12.48H1.6q-.64 0-1.12-.48T0 22.4t.448-1.12T1.6 20.8h19.2z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-no-repeat"><path d="m2.667 7.027 1.707-1.693 22.293 22.293-1.693 1.707-4-4H9.334v4l-5.333-5.333 5.333-5.333v4h8.973l-8.973-8.973v.973H6.667v-3.64l-4-4zm20 10.306h2.667v5.573l-2.667-2.667v-2.907zm0-10.666v-4L28 8l-5.333 5.333v-4H11.76L9.093 6.666h13.573z" /></symbol><symbol  viewBox="-8 0 32 32" id="icon-pause"><path d="M14.08 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112V6.848q0-2.048 2.88-2.048zm-11.2 0q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112T0 25.088V6.848Q0 4.8 2.88 4.8z" /></symbol><symbol  viewBox="-8 0 32 32" id="icon-play"><path d="M15.552 15.168q.448.32.448.832 0 .448-.448.768L1.856 25.28q-.768.512-1.312.192T0 24.192V7.744q0-.96.544-1.28t1.312.192z" /></symbol><symbol  viewBox="-1 0 32 32" id="icon-repeat-all-legacy"><path d="M25.6 9.92q1.344 0 2.272.928t.928 2.272v9.28q0 1.28-.928 2.24t-2.272.96H3.2q-1.28 0-2.24-.96T0 22.4v-9.28q0-1.344.96-2.272T3.2 9.92h8V6.4l6.4 5.76-6.4 5.76V14.4H4.48v6.72h19.84V14.4h-4.8V9.92h6.08z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-repeat-all"><path d="M9.333 9.333h13.333v4L27.999 8l-5.333-5.333v4h-16v8h2.667V9.334zm13.334 13.334H9.334v-4L4.001 24l5.333 5.333v-4h16v-8h-2.667v5.333z" /></symbol><symbol  viewBox="0 0 38 32" id="icon-repeat-one-legacy"><path d="M2.072 21.577A1.333 1.333 0 0 0 3 19.936a9.18 9.18 0 0 1-.333-2.457c0-5.049 4.108-9.158 9.158-9.158h5.428c.056-.922.221-1.816.482-2.667h-5.911c-3.158 0-6.128 1.23-8.361 3.463S0 14.32 0 17.478c0 1.076.145 2.143.431 3.171a1.333 1.333 0 0 0 1.641.927zm19.322 4.036H8.985v-2.362c0-.758-.528-1.052-1.172-.652l-5.685 3.522c-.644.4-.651 1.063-.014 1.474l5.712 3.69c.637.411 1.158.127 1.158-.63v-2.374h12.409c3.158 0 6.128-1.23 8.361-3.463a11.77 11.77 0 0 0 2.99-5.029c-.985.368-2.033.606-3.125.691-1.492 3.038-4.619 5.135-8.226 5.135zM28.718 0c-4.985 0-9.026 4.041-9.026 9.026s4.041 9.026 9.026 9.026 9.026-4.041 9.026-9.026S33.703 0 28.718 0zm1.674 13.827h-1.728V7.005c-.635.576-1.433 1.004-2.407 1.285V6.577a6.252 6.252 0 0 0 1.506-.62c.532-.325.975-.665 1.329-1.034h1.3v8.904z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-repeat-one"><path d="M9.333 9.333h13.333v4L27.999 8l-5.333-5.333v4h-16v8h2.667V9.334zm13.334 13.334H9.334v-4L4.001 24l5.333 5.333v-4h16v-8h-2.667v5.333zM17.333 20v-8H16l-2.667 1.333v1.333h2v5.333h2z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-shuffle"><path d="m22.667 4 7 6-7 6 7 6-7 6v-4h-3.653l-3.76-3.76 2.827-2.827L20.668 20h2v-8h-2l-12 12h-6v-4h4.347l12-12h3.653V4zm-20 4h6l3.76 3.76L9.6 14.587 7.013 12H2.666V8z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-skip"><path d="M25.468 6.947a1.004 1.004 0 0 0-1.03.057L18 11.384V7.831a1.001 1.001 0 0 0-1.562-.827l-12 8.164a1 1 0 0 0 0 1.654l12 8.168A.999.999 0 0 0 18 24.164v-3.556l6.438 4.382A.999.999 0 0 0 26 24.164V7.831c0-.371-.205-.71-.532-.884z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-volume-down"><path d="M13.728 6.272v19.456q0 .448-.352.8t-.8.32-.8-.32l-5.952-5.952H1.152q-.48 0-.8-.352t-.352-.8v-6.848q0-.48.352-.8t.8-.352h4.672l5.952-5.952q.32-.32.8-.32t.8.32.352.8zM20.576 16q0 1.344-.768 2.528t-2.016 1.664q-.16.096-.448.096-.448 0-.8-.32t-.32-.832q0-.384.192-.64t.544-.448.608-.384.512-.64.192-1.024-.192-1.024-.512-.64-.608-.384-.544-.448-.192-.64q0-.48.32-.832t.8-.32q.288 0 .448.096 1.248.48 2.016 1.664T20.576 16z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-volume-off"><path d="M13.728 6.272v19.456q0 .448-.352.8t-.8.32-.8-.32l-5.952-5.952H1.152q-.48 0-.8-.352t-.352-.8v-6.848q0-.48.352-.8t.8-.352h4.672l5.952-5.952q.32-.32.8-.32t.8.32.352.8z" /></symbol><symbol  viewBox="0 0 32 32" id="icon-volume-up"><path d="M13.728 6.272v19.456q0 .448-.352.8t-.8.32-.8-.32l-5.952-5.952H1.152q-.48 0-.8-.352t-.352-.8v-6.848q0-.48.352-.8t.8-.352h4.672l5.952-5.952q.32-.32.8-.32t.8.32.352.8zM20.576 16q0 1.344-.768 2.528t-2.016 1.664q-.16.096-.448.096-.448 0-.8-.32t-.32-.832q0-.384.192-.64t.544-.448.608-.384.512-.64.192-1.024-.192-1.024-.512-.64-.608-.384-.544-.448-.192-.64q0-.48.32-.832t.8-.32q.288 0 .448.096 1.248.48 2.016 1.664T20.576 16zm4.576 0q0 2.72-1.536 5.056t-4 3.36q-.256.096-.448.096-.48 0-.832-.352t-.32-.8q0-.704.672-1.056 1.024-.512 1.376-.8 1.312-.96 2.048-2.4T22.848 16t-.736-3.104-2.048-2.4q-.352-.288-1.376-.8-.672-.352-.672-1.056 0-.448.32-.8t.8-.352q.224 0 .48.096 2.496 1.056 4 3.36T25.152 16zm4.576 0q0 4.096-2.272 7.552t-6.048 5.056q-.224.096-.448.096-.48 0-.832-.352t-.32-.8q0-.64.704-1.056l.384-.192q.256-.128.416-.192.8-.448 1.44-.896 2.208-1.632 3.456-4.064T27.424 16t-1.216-5.152-3.456-4.064q-.64-.448-1.44-.896-.128-.096-.416-.192t-.384-.192q-.704-.416-.704-1.056 0-.448.32-.8t.832-.352q.224 0 .448.096 3.776 1.632 6.048 5.056T29.728 16z" /></symbol>',W.insertBefore(k,W.lastChild)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",N):N()}var Ce=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Xe(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var We={exports:{}};(function(N,W){typeof window!="undefined"&&function(C,p){N.exports=p()}(Ce,function(){return function(k){var C={};function p(M){if(C[M])return C[M].exports;var D=C[M]={i:M,l:!1,exports:{}};return k[M].call(D.exports,D,D.exports,p),D.l=!0,D.exports}return p.m=k,p.c=C,p.d=function(M,D,L){p.o(M,D)||Object.defineProperty(M,D,{enumerable:!0,get:L})},p.r=function(M){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},p.t=function(M,D){if(D&1&&(M=p(M)),D&8||D&4&&typeof M=="object"&&M&&M.__esModule)return M;var L=Object.create(null);if(p.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:M}),D&2&&typeof M!="string")for(var b in M)p.d(L,b,function(P){return M[P]}.bind(null,b));return L},p.n=function(M){var D=M&&M.__esModule?function(){return M.default}:function(){return M};return p.d(D,"a",D),D},p.o=function(M,D){return Object.prototype.hasOwnProperty.call(M,D)},p.p="/dist/",p(p.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(k,C,p){var M=Object.prototype.hasOwnProperty,D="~";function L(){}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(D=!1));function b(m,x,y){this.fn=m,this.context=x,this.once=y||!1}function P(m,x,y,T,E){if(typeof y!="function")throw new TypeError("The listener must be a function");var v=new b(y,T||m,E),n=D?D+x:x;return m._events[n]?m._events[n].fn?m._events[n]=[m._events[n],v]:m._events[n].push(v):(m._events[n]=v,m._eventsCount++),m}function O(m,x){--m._eventsCount===0?m._events=new L:delete m._events[x]}function A(){this._events=new L,this._eventsCount=0}A.prototype.eventNames=function(){var x=[],y,T;if(this._eventsCount===0)return x;for(T in y=this._events)M.call(y,T)&&x.push(D?T.slice(1):T);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(y)):x},A.prototype.listeners=function(x){var y=D?D+x:x,T=this._events[y];if(!T)return[];if(T.fn)return[T.fn];for(var E=0,v=T.length,n=new Array(v);E<v;E++)n[E]=T[E].fn;return n},A.prototype.listenerCount=function(x){var y=D?D+x:x,T=this._events[y];return T?T.fn?1:T.length:0},A.prototype.emit=function(x,y,T,E,v,n){var e=D?D+x:x;if(!this._events[e])return!1;var r=this._events[e],t=arguments.length,f,a;if(r.fn){switch(r.once&&this.removeListener(x,r.fn,void 0,!0),t){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,y),!0;case 3:return r.fn.call(r.context,y,T),!0;case 4:return r.fn.call(r.context,y,T,E),!0;case 5:return r.fn.call(r.context,y,T,E,v),!0;case 6:return r.fn.call(r.context,y,T,E,v,n),!0}for(a=1,f=new Array(t-1);a<t;a++)f[a-1]=arguments[a];r.fn.apply(r.context,f)}else{var i=r.length,l;for(a=0;a<i;a++)switch(r[a].once&&this.removeListener(x,r[a].fn,void 0,!0),t){case 1:r[a].fn.call(r[a].context);break;case 2:r[a].fn.call(r[a].context,y);break;case 3:r[a].fn.call(r[a].context,y,T);break;case 4:r[a].fn.call(r[a].context,y,T,E);break;default:if(!f)for(l=1,f=new Array(t-1);l<t;l++)f[l-1]=arguments[l];r[a].fn.apply(r[a].context,f)}}return!0},A.prototype.on=function(x,y,T){return P(this,x,y,T,!1)},A.prototype.once=function(x,y,T){return P(this,x,y,T,!0)},A.prototype.removeListener=function(x,y,T,E){var v=D?D+x:x;if(!this._events[v])return this;if(!y)return O(this,v),this;var n=this._events[v];if(n.fn)n.fn===y&&(!E||n.once)&&(!T||n.context===T)&&O(this,v);else{for(var e=0,r=[],t=n.length;e<t;e++)(n[e].fn!==y||E&&!n[e].once||T&&n[e].context!==T)&&r.push(n[e]);r.length?this._events[v]=r.length===1?r[0]:r:O(this,v)}return this},A.prototype.removeAllListeners=function(x){var y;return x?(y=D?D+x:x,this._events[y]&&O(this,y)):(this._events=new L,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=D,A.EventEmitter=A,k.exports=A},"./node_modules/url-toolkit/src/url-toolkit.js":function(k,C,p){(function(M){var D=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,L=/^([^\/?#]*)([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,P=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,O={buildAbsoluteURL:function(A,m,x){if(x=x||{},A=A.trim(),m=m.trim(),!m){if(!x.alwaysNormalize)return A;var y=O.parseURL(A);if(!y)throw new Error("Error trying to parse base URL.");return y.path=O.normalizePath(y.path),O.buildURLFromParts(y)}var T=O.parseURL(m);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return x.alwaysNormalize?(T.path=O.normalizePath(T.path),O.buildURLFromParts(T)):m;var E=O.parseURL(A);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var v=L.exec(E.path);E.netLoc=v[1],E.path=v[2]}E.netLoc&&!E.path&&(E.path="/");var n={scheme:E.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(n.netLoc=E.netLoc,T.path[0]!=="/"))if(!T.path)n.path=E.path,T.params||(n.params=E.params,T.query||(n.query=E.query));else{var e=E.path,r=e.substring(0,e.lastIndexOf("/")+1)+T.path;n.path=O.normalizePath(r)}return n.path===null&&(n.path=x.alwaysNormalize?O.normalizePath(T.path):T.path),O.buildURLFromParts(n)},parseURL:function(A){var m=D.exec(A);return m?{scheme:m[1]||"",netLoc:m[2]||"",path:m[3]||"",params:m[4]||"",query:m[5]||"",fragment:m[6]||""}:null},normalizePath:function(A){for(A=A.split("").reverse().join("").replace(b,"");A.length!==(A=A.replace(P,"")).length;);return A.split("").reverse().join("")},buildURLFromParts:function(A){return A.scheme+A.netLoc+A.path+A.params+A.query+A.fragment}};k.exports=O})()},"./node_modules/webworkify-webpack/index.js":function(k,C,p){function M(x){var y={};function T(v){if(y[v])return y[v].exports;var n=y[v]={i:v,l:!1,exports:{}};return x[v].call(n.exports,n,n.exports,T),n.l=!0,n.exports}T.m=x,T.c=y,T.i=function(v){return v},T.d=function(v,n,e){T.o(v,n)||Object.defineProperty(v,n,{configurable:!1,enumerable:!0,get:e})},T.r=function(v){Object.defineProperty(v,"__esModule",{value:!0})},T.n=function(v){var n=v&&v.__esModule?function(){return v.default}:function(){return v};return T.d(n,"a",n),n},T.o=function(v,n){return Object.prototype.hasOwnProperty.call(v,n)},T.p="/",T.oe=function(v){throw console.error(v),v};var E=T(T.s=ENTRY_MODULE);return E.default||E}var D="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+D+").*?\\)";function b(x){return(x+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function P(x){return!isNaN(1*x)}function O(x,y,T){var E={};E[T]=[];var v=y.toString(),n=v.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return E;for(var e=n[1],r=new RegExp("(\\\\n|\\W)"+b(e)+L,"g"),t;t=r.exec(v);)t[3]!=="dll-reference"&&E[T].push(t[3]);for(r=new RegExp("\\("+b(e)+'\\("(dll-reference\\s('+D+'))"\\)\\)'+L,"g");t=r.exec(v);)x[t[2]]||(E[T].push(t[1]),x[t[2]]=p(t[1]).m),E[t[2]]=E[t[2]]||[],E[t[2]].push(t[4]);for(var f=Object.keys(E),a=0;a<f.length;a++)for(var i=0;i<E[f[a]].length;i++)P(E[f[a]][i])&&(E[f[a]][i]=1*E[f[a]][i]);return E}function A(x){var y=Object.keys(x);return y.reduce(function(T,E){return T||x[E].length>0},!1)}function m(x,y){for(var T={main:[y]},E={main:[]},v={main:{}};A(T);)for(var n=Object.keys(T),e=0;e<n.length;e++){var r=n[e],t=T[r],f=t.pop();if(v[r]=v[r]||{},!(v[r][f]||!x[r][f])){v[r][f]=!0,E[r]=E[r]||[],E[r].push(f);for(var a=O(x,x[r][f],r),i=Object.keys(a),l=0;l<i.length;l++)T[i[l]]=T[i[l]]||[],T[i[l]]=T[i[l]].concat(a[i[l]])}}return E}k.exports=function(x,y){y=y||{};var T={main:p.m},E=y.all?{main:Object.keys(T.main)}:m(T,x),v="";Object.keys(E).filter(function(f){return f!=="main"}).forEach(function(f){for(var a=0;E[f][a];)a++;E[f].push(a),T[f][a]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",v=v+"var "+f+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+E[f].map(function(i){return""+JSON.stringify(i)+": "+T[f][i].toString()}).join(",")+`});
`}),v=v+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(x))+")({"+E.main.map(function(f){return""+JSON.stringify(f)+": "+T.main[f].toString()}).join(",")+"}))(self);";var n=new window.Blob([v],{type:"text/javascript"});if(y.bare)return n;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,r=e.createObjectURL(n),t=new window.Worker(r);return t.objectURL=r,t}},"./src/config.ts":function(k,C,p){p.r(C),p.d(C,"hlsDefaultConfig",function(){return l}),p.d(C,"mergeConfig",function(){return h}),p.d(C,"enableStreamingMode",function(){return u});var M=p("./src/controller/abr-controller.ts"),D=p("./src/controller/audio-stream-controller.ts"),L=p("./src/controller/audio-track-controller.ts"),b=p("./src/controller/subtitle-stream-controller.ts"),P=p("./src/controller/subtitle-track-controller.ts"),O=p("./src/controller/buffer-controller.ts"),A=p("./src/controller/timeline-controller.ts"),m=p("./src/controller/cap-level-controller.ts"),x=p("./src/controller/fps-controller.ts"),y=p("./src/controller/eme-controller.ts"),T=p("./src/controller/cmcd-controller.ts"),E=p("./src/utils/xhr-loader.ts"),v=p("./src/utils/fetch-loader.ts"),n=p("./src/utils/cues.ts"),e=p("./src/utils/mediakeys-helper.ts"),r=p("./src/utils/logger.ts");function t(){return t=Object.assign||function(s){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(s[g]=d[g])}return s},t.apply(this,arguments)}function f(s,o){var d=Object.keys(s);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(s);o&&(g=g.filter(function(S){return Object.getOwnPropertyDescriptor(s,S).enumerable})),d.push.apply(d,g)}return d}function a(s){for(var o=1;o<arguments.length;o++){var d=arguments[o]!=null?arguments[o]:{};o%2?f(Object(d),!0).forEach(function(g){i(s,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(d)):f(Object(d)).forEach(function(g){Object.defineProperty(s,g,Object.getOwnPropertyDescriptor(d,g))})}return s}function i(s,o,d){return o in s?Object.defineProperty(s,o,{value:d,enumerable:!0,configurable:!0,writable:!0}):s[o]=d,s}var l=a(a({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:E.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:O.default,capLevelController:m.default,fpsController:x.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},c()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:P.default,timelineController:A.TimelineController,audioStreamController:D.default,audioTrackController:L.default,emeController:y.default,cmcdController:T.default});function c(){return{cueHandler:n.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function h(s,o){if((o.liveSyncDurationCount||o.liveMaxLatencyDurationCount)&&(o.liveSyncDuration||o.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(o.liveMaxLatencyDurationCount!==void 0&&(o.liveSyncDurationCount===void 0||o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(o.liveMaxLatencyDuration!==void 0&&(o.liveSyncDuration===void 0||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},s,o)}function u(s){var o=s.loader;if(o!==v.default&&o!==E.default)r.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1;else{var d=Object(v.fetchSupported)();d&&(s.loader=v.default,s.progressive=!0,s.enableSoftwareAES=!0,r.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(k,C,p){p.r(C);var M=p("./src/polyfills/number.ts"),D=p("./src/utils/ewma-bandwidth-estimator.ts"),L=p("./src/events.ts"),b=p("./src/utils/buffer-helper.ts"),P=p("./src/errors.ts"),O=p("./src/types/loader.ts"),A=p("./src/utils/logger.ts");function m(T,E){for(var v=0;v<E.length;v++){var n=E[v];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(T,n.key,n)}}function x(T,E,v){return E&&m(T.prototype,E),v&&m(T,v),T}var y=function(){function T(v){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=v;var n=v.config;this.bwEstimator=new D.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var E=T.prototype;return E.registerListeners=function(){var n=this.hls;n.on(L.Events.FRAG_LOADING,this.onFragLoading,this),n.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(L.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var n=this.hls;n.off(L.Events.FRAG_LOADING,this.onFragLoading,this),n.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(L.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},E.onFragLoading=function(n,e){var r=e.frag;if(r.type===O.PlaylistLevelType.MAIN&&!this.timer){var t;this.fragCurrent=r,this.partCurrent=(t=e.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)}},E.onLevelLoaded=function(n,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},E._abandonRulesCheck=function(){var n=this.fragCurrent,e=this.partCurrent,r=this.hls,t=r.autoLevelEnabled,f=r.config,a=r.media;if(!(!n||!a)){var i=e?e.stats:n.stats,l=e?e.duration:n.duration;if(i.aborted){A.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!t||a.paused||!a.playbackRate||!a.readyState)){var c=performance.now()-i.loading.start,h=Math.abs(a.playbackRate);if(!(c<=500*l/h)){var u=r.levels,s=r.minAutoLevel,o=u[n.level],d=i.total||Math.max(i.loaded,Math.round(l*o.maxBitrate/8)),g=Math.max(1,i.bwEstimate?i.bwEstimate/8:i.loaded*1e3/c),S=(d-i.loaded)/g,R=a.currentTime,I=(b.BufferHelper.bufferInfo(a,R,f.maxBufferHole).end-R)/h;if(!(I>=2*l/h||S<=I)){var _=Number.POSITIVE_INFINITY,B;for(B=n.level-1;B>s;B--){var F=u[B].maxBitrate;if(_=l*F/(8*.8*g),_<I)break}if(!(_>=S)){var U=this.bwEstimator.getEstimate();A.logger.warn("Fragment "+n.sn+(e?" part "+e.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(U)?(U/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+S.toFixed(3)+` s
      Estimated load time for the next fragment: `+_.toFixed(3)+` s
      Time to underbuffer: `+I.toFixed(3)+" s"),r.nextLoadLevel=B,this.bwEstimator.sample(c,i.loaded),this.clearTimer(),n.loader&&(this.fragCurrent=this.partCurrent=null,n.loader.abort()),r.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:e,stats:i})}}}}}},E.onFragLoaded=function(n,e){var r=e.frag,t=e.part;if(r.type===O.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(r.sn)){var f=t?t.stats:r.stats,a=t?t.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[r.level],l=(i.loaded?i.loaded.bytes:0)+f.loaded,c=(i.loaded?i.loaded.duration:0)+a;i.loaded={bytes:l,duration:c},i.realBitrate=Math.round(8*l/c)}if(r.bitrateTest){var h={stats:f,frag:r,part:t,id:r.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,h),r.bitrateTest=!1}}},E.onFragBuffered=function(n,e){var r=e.frag,t=e.part,f=t?t.stats:r.stats;if(!f.aborted&&!(r.type!==O.PlaylistLevelType.MAIN||r.sn==="initSegment")){var a=f.parsing.end-f.loading.start;this.bwEstimator.sample(a,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},E.onError=function(n,e){switch(e.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},E.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},E.getNextABRAutoLevel=function(){var n=this.fragCurrent,e=this.partCurrent,r=this.hls,t=r.maxAutoLevel,f=r.config,a=r.minAutoLevel,i=r.media,l=e?e.duration:n?n.duration:0,c=i?i.currentTime:0,h=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,s=(b.BufferHelper.bufferInfo(i,c,f.maxBufferHole).end-c)/h,o=this.findBestLevel(u,a,t,s,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(o>=0)return o;A.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var d=l?Math.min(l,f.maxStarvationDelay):f.maxStarvationDelay,g=f.abrBandWidthFactor,S=f.abrBandWidthUpFactor;if(!s){var R=this.bitrateTestDelay;if(R){var I=l?Math.min(l,f.maxLoadingDelay):f.maxLoadingDelay;d=I-R,A.logger.trace("bitrate test took "+Math.round(1e3*R)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*d)+" ms"),g=S=1}}return o=this.findBestLevel(u,a,t,s+d,g,S),Math.max(o,0)},E.findBestLevel=function(n,e,r,t,f,a){for(var i,l=this.fragCurrent,c=this.partCurrent,h=this.lastLoadedFragLevel,u=this.hls.levels,s=u[h],o=!!(s!=null&&(i=s.details)!==null&&i!==void 0&&i.live),d=s==null?void 0:s.codecSet,g=c?c.duration:l?l.duration:0,S=r;S>=e;S--){var R=u[S];if(!(!R||d&&R.codecSet!==d)){var I=R.details,_=(c?I==null?void 0:I.partTarget:I==null?void 0:I.averagetargetduration)||g,B=void 0;S<=h?B=f*n:B=a*n;var F=u[S].maxBitrate,U=F*_/B;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+S+"/"+Math.round(B)+"/"+F+"/"+_+"/"+t+"/"+U),B>F&&(!U||o&&!this.bitrateTestDelay||U<t))return S}}return-1},x(T,[{key:"nextAutoLevel",get:function(){var n=this._nextAutoLevel,e=this.bwEstimator;if(n!==-1&&(!e||!e.canEstimate()))return n;var r=this.getNextABRAutoLevel();return n!==-1&&(r=Math.min(n,r)),r},set:function(n){this._nextAutoLevel=n}}]),T}();C.default=y},"./src/controller/audio-stream-controller.ts":function(k,C,p){p.r(C);var M=p("./src/polyfills/number.ts"),D=p("./src/controller/base-stream-controller.ts"),L=p("./src/events.ts"),b=p("./src/utils/buffer-helper.ts"),P=p("./src/controller/fragment-tracker.ts"),O=p("./src/types/level.ts"),A=p("./src/types/loader.ts"),m=p("./src/loader/fragment.ts"),x=p("./src/demux/chunk-cache.ts"),y=p("./src/demux/transmuxer-interface.ts"),T=p("./src/types/transmuxer.ts"),E=p("./src/controller/fragment-finders.ts"),v=p("./src/utils/discontinuities.ts"),n=p("./src/errors.ts"),e=p("./src/utils/logger.ts");function r(){return r=Object.assign||function(l){for(var c=1;c<arguments.length;c++){var h=arguments[c];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(l[u]=h[u])}return l},r.apply(this,arguments)}function t(l,c){l.prototype=Object.create(c.prototype),l.prototype.constructor=l,f(l,c)}function f(l,c){return f=Object.setPrototypeOf||function(u,s){return u.__proto__=s,u},f(l,c)}var a=100,i=function(l){t(c,l);function c(u,s){var o;return o=l.call(this,u,s,"[audio-stream-controller]")||this,o.videoBuffer=null,o.videoTrackCC=-1,o.waitingVideoCC=-1,o.audioSwitch=!1,o.trackId=-1,o.waitingData=null,o.mainDetails=null,o.bufferFlushed=!1,o._registerListeners(),o}var h=c.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var s=this.hls;s.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(L.Events.ERROR,this.onError,this),s.on(L.Events.BUFFER_RESET,this.onBufferReset,this),s.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var s=this.hls;s.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(L.Events.ERROR,this.onError,this),s.off(L.Events.BUFFER_RESET,this.onBufferReset,this),s.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onInitPtsFound=function(s,o){var d=o.frag,g=o.id,S=o.initPTS;if(g==="main"){var R=d.cc;this.initPTS[d.cc]=S,this.log("InitPTS for cc: "+R+" found from main: "+S),this.videoTrackCC=R,this.state===D.State.WAITING_INIT_PTS&&this.tick()}},h.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=D.State.STOPPED;return}var o=this.lastCurrentTime;this.stopLoad(),this.setInterval(a),this.fragLoadError=0,o>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+o.toFixed(3)),this.state=D.State.IDLE):(this.loadedmetadata=!1,this.state=D.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},h.doTick=function(){switch(this.state){case D.State.IDLE:this.doTickIdle();break;case D.State.WAITING_TRACK:{var s,o=this.levels,d=this.trackId,g=o==null||(s=o[d])===null||s===void 0?void 0:s.details;if(g){if(this.waitForCdnTuneIn(g))break;this.state=D.State.WAITING_INIT_PTS}break}case D.State.FRAG_LOADING_WAITING_RETRY:{var S,R=performance.now(),I=this.retryDate;(!I||R>=I||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=D.State.IDLE);break}case D.State.WAITING_INIT_PTS:{var _=this.waitingData;if(_){var B=_.frag,F=_.part,U=_.cache,w=_.complete;if(this.initPTS[B.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=D.State.FRAG_LOADING;var K=U.flush(),H={frag:B,part:F,payload:K,networkDetails:null};this._handleFragmentLoadProgress(H),w&&l.prototype._handleFragmentLoadComplete.call(this,H)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),Y=b.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),z=Object(E.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,B);z<0&&(e.logger.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=D.State.IDLE}}this.onTickEnd()},h.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=D.State.IDLE)},h.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var o=this.mediaBuffer?this.mediaBuffer:s,d=o.buffered;!this.loadedmetadata&&d.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},h.doTickIdle=function(){var s,o,d=this.hls,g=this.levels,S=this.media,R=this.trackId,I=d.config;if(!(!g||!g[R])&&!(!S&&(this.startFragRequested||!I.startFragPrefetch))){var _=g[R],B=_.details;if(!B||B.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(B)){this.state=D.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,m.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.AUDIO);if(F!==null){var U=F.len,w=this.getMaxBufferLength(),K=this.audioSwitch;if(!(U>=w&&!K)){if(!K&&this._streamEnded(F,B)){d.trigger(L.Events.BUFFER_EOS,{type:"audio"}),this.state=D.State.ENDED;return}var H=B.fragments,j=H[0].start,Y=F.end;if(K){var z=this.getLoadPosition();Y=z,B.PTSKnown&&z<j&&(F.end>j||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),S.currentTime=j+.05)}var V=this.getNextFragment(Y,B);if(!V){this.bufferFlushed=!0;return}((s=V.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((o=V.decryptdata)!==null&&o!==void 0&&o.key)?this.loadKey(V,B):this.loadFragment(V,B,Y)}}}},h.getMaxBufferLength=function(){var s=l.prototype.getMaxBufferLength.call(this),o=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN);return o===null?s:Math.max(s,o.len)},h.onMediaDetaching=function(){this.videoBuffer=null,l.prototype.onMediaDetaching.call(this)},h.onAudioTracksUpdated=function(s,o){var d=o.audioTracks;this.resetTransmuxer(),this.levels=d.map(function(g){return new O.Level(g)})},h.onAudioTrackSwitching=function(s,o){var d=!!o.url;this.trackId=o.id;var g=this.fragCurrent;g!=null&&g.loader&&g.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),d?this.setInterval(a):this.resetTransmuxer(),d?(this.audioSwitch=!0,this.state=D.State.IDLE):this.state=D.State.STOPPED,this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},h.onLevelLoaded=function(s,o){this.mainDetails=o.details},h.onAudioTrackLoaded=function(s,o){var d,g=this.levels,S=o.details,R=o.id;if(!g){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var I=g[R],_=0;if(S.live||(d=I.details)!==null&&d!==void 0&&d.live){var B=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!B)return;!I.details&&S.hasProgramDateTime&&B.hasProgramDateTime?(Object(v.alignMediaPlaylistByPDT)(S,B),_=S.fragments[0].start):_=this.alignPlaylists(S,I.details)}I.details=S,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!S.live)&&this.setStartPosition(I.details,_),this.state===D.State.WAITING_TRACK&&!this.waitForCdnTuneIn(S)&&(this.state=D.State.IDLE),this.tick()},h._handleFragmentLoadProgress=function(s){var o,d=s.frag,g=s.part,S=s.payload,R=this.config,I=this.trackId,_=this.levels;if(!_){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+d.sn+" of level "+d.level+" will not be buffered");return}var B=_[I];console.assert(B,"Audio track is defined on fragment load progress");var F=B.details;console.assert(F,"Audio track details are defined on fragment load progress");var U=R.defaultAudioCodec||B.audioCodec||"mp4a.40.2",w=this.transmuxer;w||(w=this.transmuxer=new y.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var K=this.initPTS[d.cc],H=(o=d.initSegment)===null||o===void 0?void 0:o.data;if(K!==void 0){var j=!1,Y=g?g.index:-1,z=Y!==-1,V=new T.ChunkMetadata(d.level,d.sn,d.stats.chunkCount,S.byteLength,Y,z);w.push(S,H,U,"",d,g,F.totalduration,j,V,K)}else{e.logger.log("Unknown video PTS for cc "+d.cc+", waiting for video PTS before demuxing audio frag "+d.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+I);var Q=this.waitingData=this.waitingData||{frag:d,part:g,cache:new x.default,complete:!1},X=Q.cache;X.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=D.State.WAITING_INIT_PTS}},h._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}l.prototype._handleFragmentLoadComplete.call(this,s)},h.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},h.onBufferCreated=function(s,o){var d=o.tracks.audio;d&&(this.mediaBuffer=d.buffer),o.tracks.video&&(this.videoBuffer=o.tracks.video.buffer)},h.onFragBuffered=function(s,o){var d=o.frag,g=o.part;if(d.type===A.PlaylistLevelType.AUDIO){if(this.fragContextChanged(d)){this.warn("Fragment "+d.sn+(g?" p: "+g.index:"")+" of level "+d.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}d.sn!=="initSegment"&&(this.fragPrevious=d,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(d,g)}},h.onError=function(s,o){switch(o.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,o);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==D.State.ERROR&&this.state!==D.State.STOPPED&&(this.state=o.fatal?D.State.ERROR:D.State.IDLE,this.warn(o.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(o.parent==="audio"&&(this.state===D.State.PARSING||this.state===D.State.PARSED)){var d=!0,g=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);g&&g.len>.5&&(d=!this.reduceMaxBufferLength(g.len)),d&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,l.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},h.onBufferFlushed=function(s,o){var d=o.type;d===m.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},h._handleTransmuxComplete=function(s){var o,d="audio",g=this.hls,S=s.remuxResult,R=s.chunkMeta,I=this.getCurrentContext(R);if(!I){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(R.level);return}var _=I.frag,B=I.part,F=S.audio,U=S.text,w=S.id3,K=S.initSegment;if(!this.fragContextChanged(_)){if(this.state=D.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),K!=null&&K.tracks&&(this._bufferInitSegment(K.tracks,_,R),g.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:d,tracks:K.tracks})),F){var H=F.startPTS,j=F.endPTS,Y=F.startDTS,z=F.endDTS;B&&(B.elementaryStreams[m.ElementaryStreamTypes.AUDIO]={startPTS:H,endPTS:j,startDTS:Y,endDTS:z}),_.setElementaryStreamInfo(m.ElementaryStreamTypes.AUDIO,H,j,Y,z),this.bufferFragmentData(F,_,B,R)}if(w!=null&&(o=w.samples)!==null&&o!==void 0&&o.length){var V=r({frag:_,id:d},w);g.trigger(L.Events.FRAG_PARSING_METADATA,V)}if(U){var Q=r({frag:_,id:d},U);g.trigger(L.Events.FRAG_PARSING_USERDATA,Q)}}},h._bufferInitSegment=function(s,o,d){if(this.state===D.State.PARSING){s.video&&delete s.video;var g=s.audio;if(!!g){g.levelCodec=g.codec,g.id="audio",this.log("Init audio buffer, container:"+g.container+", codecs[parsed]=["+g.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,s);var S=g.initSegment;if(S!=null&&S.byteLength){var R={type:"audio",frag:o,part:null,chunkMeta:d,parent:o.type,data:S};this.hls.trigger(L.Events.BUFFER_APPENDING,R)}this.tick()}}},h.loadFragment=function(s,o,d){var g=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||g===P.FragmentState.NOT_LOADED||g===P.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):o.live&&!Object(M.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=D.State.WAITING_INIT_PTS):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,s,o,d)))},h.completeAudioSwitch=function(){var s=this.hls,o=this.media,d=this.trackId;o&&(this.log("Switching audio track : flushing all audio"),l.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:d})},c}(D.default);C.default=i},"./src/controller/audio-track-controller.ts":function(k,C,p){p.r(C);var M=p("./src/events.ts"),D=p("./src/errors.ts"),L=p("./src/controller/base-playlist-controller.ts"),b=p("./src/types/loader.ts");function P(y,T){for(var E=0;E<T.length;E++){var v=T[E];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(y,v.key,v)}}function O(y,T,E){return T&&P(y.prototype,T),E&&P(y,E),y}function A(y,T){y.prototype=Object.create(T.prototype),y.prototype.constructor=y,m(y,T)}function m(y,T){return m=Object.setPrototypeOf||function(v,n){return v.__proto__=n,v},m(y,T)}var x=function(y){A(T,y);function T(v){var n;return n=y.call(this,v,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var E=T.prototype;return E.registerListeners=function(){var n=this.hls;n.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(M.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var n=this.hls;n.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(M.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,y.prototype.destroy.call(this)},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},E.onManifestParsed=function(n,e){this.tracks=e.audioTracks||[]},E.onAudioTrackLoaded=function(n,e){var r=e.id,t=e.details,f=this.tracksInGroup[r];if(!f){this.warn("Invalid audio track id "+r);return}var a=f.details;f.details=e.details,this.log("audioTrack "+r+" loaded ["+t.startSN+"-"+t.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,a))},E.onLevelLoading=function(n,e){this.switchLevel(e.level)},E.onLevelSwitching=function(n,e){this.switchLevel(e.level)},E.switchLevel=function(n){var e=this.hls.levels[n];if(!!(e!=null&&e.audioGroupIds)){var r=e.audioGroupIds[e.urlId];if(this.groupId!==r){this.groupId=r;var t=this.tracks.filter(function(a){return!r||a.groupId===r});this.selectDefaultTrack&&!t.some(function(a){return a.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=t;var f={audioTracks:t};this.log("Updating audio tracks, "+t.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},E.onError=function(n,e){y.prototype.onError.call(this,n,e),!(e.fatal||!e.context)&&e.context.type===b.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},E.setAudioTrack=function(n){var e=this.tracksInGroup;if(n<0||n>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var r=e[this.trackId];this.log("Now switching to audio-track index "+n);var t=e[n],f=t.id,a=t.groupId,i=a===void 0?"":a,l=t.name,c=t.type,h=t.url;if(this.trackId=n,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:i,name:l,type:c,url:h}),!(t.details&&!t.details.live)){var u=this.switchParams(t.url,r==null?void 0:r.details);this.loadPlaylist(u)}},E.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,r=this.findTrackId(e)||this.findTrackId();r!==-1?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},E.findTrackId=function(n){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var t=e[r];if((!this.selectDefaultTrack||t.default)&&(!n||n===t.name))return t.id}return-1},E.loadPlaylist=function(n){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,t=e.groupId,f=e.url;if(n)try{f=n.addDirectives(f)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:f,id:r,groupId:t,deliveryDirectives:n||null})}},O(T,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),T}(L.default);C.default=x},"./src/controller/base-playlist-controller.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return O});var M=p("./src/polyfills/number.ts"),D=p("./src/types/level.ts"),L=p("./src/controller/level-helper.ts"),b=p("./src/utils/logger.ts"),P=p("./src/errors.ts"),O=function(){function A(x,y){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,y+":"),this.warn=b.logger.warn.bind(b.logger,y+":"),this.hls=x}var m=A.prototype;return m.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},m.onError=function(y,T){T.fatal&&T.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},m.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},m.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},m.stopLoad=function(){this.canLoad=!1,this.clearTimer()},m.switchParams=function(y,T){var E=T==null?void 0:T.renditionReports;if(E)for(var v=0;v<E.length;v++){var n=E[v],e=""+n.URI;if(e===y.substr(-e.length)){var r=parseInt(n["LAST-MSN"]),t=parseInt(n["LAST-PART"]);if(T&&this.hls.config.lowLatencyMode){var f=Math.min(T.age-T.partTarget,T.targetduration);t!==void 0&&f>T.partTarget&&(t+=1)}if(Object(M.isFiniteNumber)(r))return new D.HlsUrlParameters(r,Object(M.isFiniteNumber)(t)?t:void 0,D.HlsSkip.No)}}},m.loadPlaylist=function(y){},m.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},m.playlistLoaded=function(y,T,E){var v=this,n=T.details,e=T.stats,r=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(n.advancedDateTime=Date.now()-r,n.live||E!=null&&E.live){if(n.reloaded(E),E&&this.log("live playlist "+y+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),E&&n.fragments.length>0&&Object(L.mergeDetails)(E,n),!this.canLoad||!n.live)return;var t,f=void 0,a=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var i=this.hls.config.lowLatencyMode,l=n.lastPartSn,c=n.endSN,h=n.lastPartIndex,u=h!==-1,s=l===c,o=i?0:h;u?(f=s?c+1:l,a=s?o:h+1):f=c+1;var d=n.age,g=d+n.ageHeader,S=Math.min(g-n.partTarget,n.targetduration*1.5);if(S>0){if(E&&S>E.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+E.tuneInGoal+" to: "+S+" with playlist age: "+n.age),S=0;else{var R=Math.floor(S/n.targetduration);if(f+=R,a!==void 0){var I=Math.round(S%n.targetduration/n.partTarget);a+=I}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+d.toFixed(2)+"s goal: "+S+" skip sn "+R+" to part "+a)}n.tuneInGoal=S}if(t=this.getDeliveryDirectives(n,T.deliveryDirectives,f,a),i||!s){this.loadPlaylist(t);return}}else t=this.getDeliveryDirectives(n,T.deliveryDirectives,f,a);var _=Object(L.computeReloadInterval)(n,e);f!==void 0&&n.canBlockReload&&(_-=n.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout(function(){return v.loadPlaylist(t)},_)}else this.clearTimer()},m.getDeliveryDirectives=function(y,T,E,v){var n=Object(D.getSkipValue)(y,E);return T!=null&&T.skip&&y.deltaUpdateFailed&&(E=T.msn,v=T.part,n=D.HlsSkip.No),new D.HlsUrlParameters(E,v,n)},m.retryLoadingOrFail=function(y){var T=this,E=this.hls.config,v=this.retryCount<E.levelLoadingMaxRetry;if(v){var n;if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(n=y.context)!==null&&n!==void 0&&n.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*E.levelLoadingRetryDelay,E.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+y.details+'"')}}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return v},A}()},"./src/controller/base-stream-controller.ts":function(k,C,p){p.r(C),p.d(C,"State",function(){return c}),p.d(C,"default",function(){return h});var M=p("./src/polyfills/number.ts"),D=p("./src/task-loop.ts"),L=p("./src/controller/fragment-tracker.ts"),b=p("./src/utils/buffer-helper.ts"),P=p("./src/utils/logger.ts"),O=p("./src/events.ts"),A=p("./src/errors.ts"),m=p("./src/types/transmuxer.ts"),x=p("./src/utils/mp4-tools.ts"),y=p("./src/utils/discontinuities.ts"),T=p("./src/controller/fragment-finders.ts"),E=p("./src/controller/level-helper.ts"),v=p("./src/loader/fragment-loader.ts"),n=p("./src/crypt/decrypter.ts"),e=p("./src/utils/time-ranges.ts"),r=p("./src/types/loader.ts");function t(u,s){for(var o=0;o<s.length;o++){var d=s[o];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}function f(u,s,o){return s&&t(u.prototype,s),o&&t(u,o),u}function a(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function i(u,s){u.prototype=Object.create(s.prototype),u.prototype.constructor=u,l(u,s)}function l(u,s){return l=Object.setPrototypeOf||function(d,g){return d.__proto__=g,d},l(u,s)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},h=function(u){i(s,u);function s(d,g,S){var R;return R=u.call(this)||this,R.hls=void 0,R.fragPrevious=null,R.fragCurrent=null,R.fragmentTracker=void 0,R.transmuxer=null,R._state=c.STOPPED,R.media=void 0,R.mediaBuffer=void 0,R.config=void 0,R.bitrateTest=!1,R.lastCurrentTime=0,R.nextLoadPosition=0,R.startPosition=0,R.loadedmetadata=!1,R.fragLoadError=0,R.retryDate=0,R.levels=null,R.fragmentLoader=void 0,R.levelLastLoaded=null,R.startFragRequested=!1,R.decrypter=void 0,R.initPTS=[],R.onvseeking=null,R.onvended=null,R.logPrefix="",R.log=void 0,R.warn=void 0,R.logPrefix=S,R.log=P.logger.log.bind(P.logger,S+":"),R.warn=P.logger.warn.bind(P.logger,S+":"),R.hls=d,R.fragmentLoader=new v.default(d.config),R.fragmentTracker=g,R.config=d.config,R.decrypter=new n.default(d,d.config),d.on(O.Events.KEY_LOADED,R.onKeyLoaded,a(R)),R}var o=s.prototype;return o.doTick=function(){this.onTickEnd()},o.onTickEnd=function(){},o.startLoad=function(g){},o.stopLoad=function(){this.fragmentLoader.abort();var g=this.fragCurrent;g&&this.fragmentTracker.removeFragment(g),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},o._streamEnded=function(g,S){var R=this.fragCurrent,I=this.fragmentTracker;if(!S.live&&R&&R.sn>=S.endSN&&!g.nextStart){var _=S.partList;if(_!=null&&_.length){var B=_[_.length-1],F=b.BufferHelper.isBuffered(this.media,B.start+B.duration/2);return F}var U=I.getState(R);return U===L.FragmentState.PARTIAL||U===L.FragmentState.OK}return!1},o.onMediaAttached=function(g,S){var R=this.media=this.mediaBuffer=S.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),R.addEventListener("seeking",this.onvseeking),R.addEventListener("ended",this.onvended);var I=this.config;this.levels&&I.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(I.startPosition)},o.onMediaDetaching=function(){var g=this.media;g!=null&&g.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),g&&(g.removeEventListener("seeking",this.onvseeking),g.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},o.onMediaSeeking=function(){var g=this.config,S=this.fragCurrent,R=this.media,I=this.mediaBuffer,_=this.state,B=R?R.currentTime:0,F=b.BufferHelper.bufferInfo(I||R,B,g.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+_),_===c.ENDED)this.resetLoadingState();else if(S&&!F.len){var U=g.maxFragLookUpTolerance,w=S.start-U,K=S.start+S.duration+U,H=B>K;(B<w||H)&&(H&&S.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),S.loader.abort()),this.resetLoadingState())}R&&(this.lastCurrentTime=B),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},o.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},o.onKeyLoaded=function(g,S){if(!(this.state!==c.KEY_LOADING||S.frag!==this.fragCurrent||!this.levels)){this.state=c.IDLE;var R=this.levels[S.frag.level].details;R&&this.loadFragment(S.frag,R,S.frag.start)}},o.onHandlerDestroying=function(){this.stopLoad(),u.prototype.onHandlerDestroying.call(this)},o.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(O.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,u.prototype.onHandlerDestroyed.call(this)},o.loadKey=function(g,S){this.log("Loading key for "+g.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+g.level),this.state=c.KEY_LOADING,this.fragCurrent=g,this.hls.trigger(O.Events.KEY_LOADING,{frag:g})},o.loadFragment=function(g,S,R){this._loadFragForPlayback(g,S,R)},o._loadFragForPlayback=function(g,S,R){var I=this,_=function(F){if(I.fragContextChanged(g)){I.warn("Fragment "+g.sn+(F.part?" p: "+F.part.index:"")+" of level "+g.level+" was dropped during download."),I.fragmentTracker.removeFragment(g);return}g.stats.chunkCount++,I._handleFragmentLoadProgress(F)};this._doFragLoad(g,S,R,_).then(function(B){if(!!B){I.fragLoadError=0;var F=I.state;if(I.fragContextChanged(g)){(F===c.FRAG_LOADING||F===c.BACKTRACKING||!I.fragCurrent&&F===c.PARSING)&&(I.fragmentTracker.removeFragment(g),I.state=c.IDLE);return}if("payload"in B&&(I.log("Loaded fragment "+g.sn+" of level "+g.level),I.hls.trigger(O.Events.FRAG_LOADED,B),I.state===c.BACKTRACKING)){I.fragmentTracker.backtrack(g,B),I.resetFragmentLoading(g);return}I._handleFragmentLoadComplete(B)}}).catch(function(B){I.warn(B),I.resetFragmentLoading(g)})},o.flushMainBuffer=function(g,S,R){if(R===void 0&&(R=null),!!(g-S)){var I={startOffset:g,endOffset:S,type:R};this.fragLoadError=0,this.hls.trigger(O.Events.BUFFER_FLUSHING,I)}},o._loadInitSegment=function(g){var S=this;this._doFragLoad(g).then(function(R){if(!R||S.fragContextChanged(g)||!S.levels)throw new Error("init load aborted");return R}).then(function(R){var I=S.hls,_=R.payload,B=g.decryptdata;if(_&&_.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var F=self.performance.now();return S.decrypter.webCryptoDecrypt(new Uint8Array(_),B.key.buffer,B.iv.buffer).then(function(U){var w=self.performance.now();return I.trigger(O.Events.FRAG_DECRYPTED,{frag:g,payload:U,stats:{tstart:F,tdecrypt:w}}),R.payload=U,R})}return R}).then(function(R){var I=S.fragCurrent,_=S.hls,B=S.levels;if(!B)throw new Error("init load aborted, missing levels");var F=B[g.level].details;console.assert(F,"Level details are defined when init segment is loaded");var U=g.stats;S.state=c.IDLE,S.fragLoadError=0,g.data=new Uint8Array(R.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),R.frag===I&&_.trigger(O.Events.FRAG_BUFFERED,{stats:U,frag:I,part:null,id:g.type}),S.tick()}).catch(function(R){S.warn(R),S.resetFragmentLoading(g)})},o.fragContextChanged=function(g){var S=this.fragCurrent;return!g||!S||g.level!==S.level||g.sn!==S.sn||g.urlId!==S.urlId},o.fragBufferedComplete=function(g,S){var R=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+g.type+" sn: "+g.sn+(S?" part: "+S.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+g.level+" "+e.default.toString(b.BufferHelper.getBuffered(R))),this.state=c.IDLE,this.tick()},o._handleFragmentLoadComplete=function(g){var S=this.transmuxer;if(!!S){var R=g.frag,I=g.part,_=g.partsLoaded,B=!_||_.length===0||_.some(function(U){return!U}),F=new m.ChunkMetadata(R.level,R.sn,R.stats.chunkCount+1,0,I?I.index:-1,!B);S.flush(F)}},o._handleFragmentLoadProgress=function(g){},o._doFragLoad=function(g,S,R,I){var _=this;if(R===void 0&&(R=null),!this.levels)throw new Error("frag load aborted, missing levels");if(R=Math.max(g.start,R||0),this.config.lowLatencyMode&&S){var B=S.partList;if(B&&I){R>g.end&&S.fragmentHint&&(g=S.fragmentHint);var F=this.getNextPart(B,g,R);if(F>-1){var U=B[F];return this.log("Loading part sn: "+g.sn+" p: "+U.index+" cc: "+g.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+F+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+g.level+", target: "+parseFloat(R.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=c.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:g,part:B[F],targetBufferTime:R}),this.doFragPartsLoad(g,B,F,I).catch(function(w){return _.handleFragLoadError(w)})}else if(!g.url||this.loadedEndOfParts(B,R))return Promise.resolve(null)}}return this.log("Loading fragment "+g.sn+" cc: "+g.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+g.level+", target: "+parseFloat(R.toFixed(3))),Object(M.isFiniteNumber)(g.sn)&&!this.bitrateTest&&(this.nextLoadPosition=g.start+g.duration),this.state=c.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:g,targetBufferTime:R}),this.fragmentLoader.load(g,I).catch(function(w){return _.handleFragLoadError(w)})},o.doFragPartsLoad=function(g,S,R,I){var _=this;return new Promise(function(B,F){var U=[],w=function K(H){var j=S[H];_.fragmentLoader.loadPart(g,j,I).then(function(Y){U[j.index]=Y;var z=Y.part;_.hls.trigger(O.Events.FRAG_LOADED,Y);var V=S[H+1];if(V&&V.fragment===g)K(H+1);else return B({frag:g,part:z,partsLoaded:U})}).catch(F)};w(R)})},o.handleFragLoadError=function(g){var S=g.data;return S&&S.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(S.frag,S.part):this.hls.trigger(O.Events.ERROR,S),null},o._handleTransmuxerFlush=function(g){var S=this.getCurrentContext(g);if(!S||this.state!==c.PARSING){this.fragCurrent||(this.state=c.IDLE);return}var R=S.frag,I=S.part,_=S.level,B=self.performance.now();R.stats.parsing.end=B,I&&(I.stats.parsing.end=B),this.updateLevelTiming(R,I,_,g.partial)},o.getCurrentContext=function(g){var S=this.levels,R=g.level,I=g.sn,_=g.part;if(!S||!S[R])return this.warn("Levels object was unset while buffering fragment "+I+" of level "+R+". The current chunk will not be buffered."),null;var B=S[R],F=_>-1?Object(E.getPartWith)(B,I,_):null,U=F?F.fragment:Object(E.getFragmentWithSN)(B,I,this.fragCurrent);return U?{frag:U,part:F,level:B}:null},o.bufferFragmentData=function(g,S,R,I){if(!(!g||this.state!==c.PARSING)){var _=g.data1,B=g.data2,F=_;if(_&&B&&(F=Object(x.appendUint8Array)(_,B)),!(!F||!F.length)){var U={type:g.type,frag:S,part:R,chunkMeta:I,parent:S.type,data:F};this.hls.trigger(O.Events.BUFFER_APPENDING,U),g.dropped&&g.independent&&!R&&this.flushBufferGap(S)}}},o.flushBufferGap=function(g){var S=this.media;if(!!S){if(!b.BufferHelper.isBuffered(S,S.currentTime)){this.flushMainBuffer(0,g.start);return}var R=S.currentTime,I=b.BufferHelper.bufferInfo(S,R,0),_=g.duration,B=Math.min(this.config.maxFragLookUpTolerance*2,_*.25),F=Math.max(Math.min(g.start-B,I.end-B),R+B);g.start-F>B&&this.flushMainBuffer(F,g.start)}},o.getFwdBufferInfo=function(g,S){var R=this.config,I=this.getLoadPosition();if(!Object(M.isFiniteNumber)(I))return null;var _=b.BufferHelper.bufferInfo(g,I,R.maxBufferHole);if(_.len===0&&_.nextStart!==void 0){var B=this.fragmentTracker.getBufferedFrag(I,S);if(B&&_.nextStart<B.end)return b.BufferHelper.bufferInfo(g,I,Math.max(_.nextStart,R.maxBufferHole))}return _},o.getMaxBufferLength=function(g){var S=this.config,R;return g?R=Math.max(8*S.maxBufferSize/g,S.maxBufferLength):R=S.maxBufferLength,Math.min(R,S.maxMaxBufferLength)},o.reduceMaxBufferLength=function(g){var S=this.config,R=g||S.maxBufferLength;return S.maxMaxBufferLength>=R?(S.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+S.maxMaxBufferLength+"s"),!0):!1},o.getNextFragment=function(g,S){var R,I,_=S.fragments,B=_.length;if(!B)return null;var F=this.config,U=_[0].start,w;if(S.live){var K=F.initialLiveManifestSize;if(B<K)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+K+")"),null;!S.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(w=this.getInitialLiveFragment(S,_),this.startPosition=w?this.hls.liveSyncPosition||w.start:g)}else g<=U&&(w=_[0]);if(!w){var H=F.lowLatencyMode?S.partEnd:S.fragmentEnd;w=this.getFragmentAtPosition(g,H,S)}return(R=w)!==null&&R!==void 0&&R.initSegment&&!((I=w)!==null&&I!==void 0&&I.initSegment.data)&&!this.bitrateTest&&(w=w.initSegment),w},o.getNextPart=function(g,S,R){for(var I=-1,_=!1,B=!0,F=0,U=g.length;F<U;F++){var w=g[F];if(B=B&&!w.independent,I>-1&&R<w.start)break;var K=w.loaded;!K&&(_||w.independent||B)&&w.fragment===S&&(I=F),_=K}return I},o.loadedEndOfParts=function(g,S){var R=g[g.length-1];return R&&S>R.start&&R.loaded},o.getInitialLiveFragment=function(g,S){var R=this.fragPrevious,I=null;if(R){if(g.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+R.programDateTime),I=Object(T.findFragmentByPDT)(S,R.endProgramDateTime,this.config.maxFragLookUpTolerance)),!I){var _=R.sn+1;if(_>=g.startSN&&_<=g.endSN){var B=S[_-g.startSN];R.cc===B.cc&&(I=B,this.log("Live playlist, switching playlist, load frag with next SN: "+I.sn))}I||(I=Object(T.findFragWithCC)(S,R.cc),I&&this.log("Live playlist, switching playlist, load frag with same CC: "+I.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(I=this.getFragmentAtPosition(F,this.bitrateTest?g.fragmentEnd:g.edge,g))}return I},o.getFragmentAtPosition=function(g,S,R){var I=this.config,_=this.fragPrevious,B=R.fragments,F=R.endSN,U=R.fragmentHint,w=I.maxFragLookUpTolerance,K=!!(I.lowLatencyMode&&R.partList&&U);K&&U&&!this.bitrateTest&&(B=B.concat(U),F=U.sn);var H;if(g<S){var j=g>S-w?0:w;H=Object(T.findFragmentByPTS)(_,B,g,j)}else H=B[B.length-1];if(H){var Y=H.sn-R.startSN,z=_&&H.level===_.level,V=B[Y+1],Q=this.fragmentTracker.getState(H);if(Q===L.FragmentState.BACKTRACKED){H=null;for(var X=Y;B[X]&&this.fragmentTracker.getState(B[X])===L.FragmentState.BACKTRACKED;)_?H=B[X--]:H=B[--X];H||(H=V)}else _&&H.sn===_.sn&&!K&&z&&(H.sn<F&&this.fragmentTracker.getState(V)!==L.FragmentState.OK?(this.log("SN "+H.sn+" just loaded, load next one: "+V.sn),H=V):H=null)}return H},o.synchronizeToLiveEdge=function(g){var S=this.config,R=this.media;if(!!R){var I=this.hls.liveSyncPosition,_=R.currentTime,B=g.fragments[0].start,F=g.edge,U=_>=B-S.maxFragLookUpTolerance&&_<=F;if(I!==null&&R.duration>I&&(_<I||!U)){var w=S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:S.liveMaxLatencyDurationCount*g.targetduration;(!U&&R.readyState<4||_<F-w)&&(this.loadedmetadata||(this.nextLoadPosition=I),R.readyState&&(this.warn("Playback: "+_.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+I.toFixed(3)),R.currentTime=I))}}},o.alignPlaylists=function(g,S){var R=this.levels,I=this.levelLastLoaded,_=this.fragPrevious,B=I!==null?R[I]:null,F=g.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var U=g.fragments[0].start,w=!S,K=g.alignedSliding&&Object(M.isFiniteNumber)(U);if(w||!K&&!U){Object(y.alignStream)(_,B,g);var H=g.fragments[0].start;return this.log("Live playlist sliding: "+H.toFixed(2)+" start-sn: "+(S?S.startSN:"na")+"->"+g.startSN+" prev-sn: "+(_?_.sn:"na")+" fragments: "+F),H}return U},o.waitForCdnTuneIn=function(g){var S=3;return g.live&&g.canBlockReload&&g.tuneInGoal>Math.max(g.partHoldBack,g.partTarget*S)},o.setStartPosition=function(g,S){var R=this.startPosition;if(R<S&&(R=-1),R===-1||this.lastCurrentTime===-1){var I=g.startTimeOffset;Object(M.isFiniteNumber)(I)?(R=S+I,I<0&&(R+=g.totalduration),R=Math.min(Math.max(S,R),S+g.totalduration),this.log("Start time offset "+I+" found in playlist, adjust startPosition to "+R),this.startPosition=R):g.live?R=this.hls.liveSyncPosition||S:this.startPosition=R=0,this.lastCurrentTime=R}this.nextLoadPosition=R},o.getLoadPosition=function(){var g=this.media,S=0;return this.loadedmetadata&&g?S=g.currentTime:this.nextLoadPosition&&(S=this.nextLoadPosition),S},o.handleFragLoadAborted=function(g,S){this.transmuxer&&g.sn!=="initSegment"&&g.stats.aborted&&(this.warn("Fragment "+g.sn+(S?" part"+S.index:"")+" of level "+g.level+" was aborted"),this.resetFragmentLoading(g))},o.resetFragmentLoading=function(g){(!this.fragCurrent||!this.fragContextChanged(g))&&(this.state=c.IDLE)},o.onFragmentOrKeyLoadError=function(g,S){if(!S.fatal){var R=S.frag;if(!(!R||R.type!==g)){var I=this.fragCurrent;console.assert(I&&R.sn===I.sn&&R.level===I.level&&R.urlId===I.urlId,"Frag load error must match current frag to retry");var _=this.config;if(this.fragLoadError+1<=_.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(R.level))return;var B=Math.min(Math.pow(2,this.fragLoadError)*_.fragLoadingRetryDelay,_.fragLoadingMaxRetryTimeout);this.warn("Fragment "+R.sn+" of "+g+" "+R.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else S.levelRetry?(g===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(P.logger.error(S.details+" reaches max retry, redispatch as fatal ..."),S.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}}},o.afterBufferFlushed=function(g,S,R){if(!!g){var I=b.BufferHelper.getBuffered(g);this.fragmentTracker.detectEvictedFragments(S,I,R),this.state===c.ENDED&&this.resetLoadingState()}},o.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},o.resetLiveStartWhenNotLoaded=function(g){if(!this.loadedmetadata){this.startFragRequested=!1;var S=this.levels?this.levels[g].details:null;if(S!=null&&S.live)return this.startPosition=-1,this.setStartPosition(S,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},o.updateLevelTiming=function(g,S,R,I){var _=this,B=R.details;console.assert(!!B,"level.details must be defined");var F=Object.keys(g.elementaryStreams).reduce(function(U,w){var K=g.elementaryStreams[w];if(K){var H=K.endPTS-K.startPTS;if(H<=0)return _.warn("Could not parse fragment "+g.sn+" "+w+" duration reliably ("+H+") resetting transmuxer to fallback to playlist timing"),_.resetTransmuxer(),U||!1;var j=I?0:Object(E.updateFragPTSDTS)(B,g,K.startPTS,K.endPTS,K.startDTS,K.endDTS);return _.hls.trigger(O.Events.LEVEL_PTS_UPDATED,{details:B,level:R,drift:j,type:w,frag:g,start:K.startPTS,end:K.endPTS}),!0}return U},!1);F?(this.state=c.PARSED,this.hls.trigger(O.Events.FRAG_PARSED,{frag:g,part:S})):this.resetLoadingState()},o.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(s,[{key:"state",get:function(){return this._state},set:function(g){var S=this._state;S!==g&&(this._state=g,this.log(S+"->"+g))}}]),s}(D.default)},"./src/controller/buffer-controller.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return T});var M=p("./src/polyfills/number.ts"),D=p("./src/events.ts"),L=p("./src/utils/logger.ts"),b=p("./src/errors.ts"),P=p("./src/utils/buffer-helper.ts"),O=p("./src/utils/mediasource-helper.ts"),A=p("./src/loader/fragment.ts"),m=p("./src/controller/buffer-operation-queue.ts"),x=Object(O.getMediaSource)(),y=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function E(n){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=e.hls,t=e.media,f=e.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),t&&(e.updateMediaElementDuration(),r.trigger(D.Events.MEDIA_ATTACHED,{media:t})),f&&f.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var v=E.prototype;return v.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},v.destroy=function(){this.unregisterListeners(),this.details=null},v.registerListeners=function(){var e=this.hls;e.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(D.Events.BUFFER_RESET,this.onBufferReset,this),e.on(D.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(D.Events.BUFFER_EOS,this.onBufferEos,this),e.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(D.Events.FRAG_PARSED,this.onFragParsed,this),e.on(D.Events.FRAG_CHANGED,this.onFragChanged,this)},v.unregisterListeners=function(){var e=this.hls;e.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(D.Events.BUFFER_RESET,this.onBufferReset,this),e.off(D.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(D.Events.BUFFER_EOS,this.onBufferEos,this),e.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(D.Events.FRAG_PARSED,this.onFragParsed,this),e.off(D.Events.FRAG_CHANGED,this.onFragChanged,this)},v._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new m.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},v.onManifestParsed=function(e,r){var t=2;(r.audio&&!r.video||!r.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},v.onMediaAttaching=function(e,r){var t=this.media=r.media;if(t&&x){var f=this.mediaSource=new x;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(f),this._objectUrl=t.src}},v.onMediaDetaching=function(){var e=this.media,r=this.mediaSource,t=this._objectUrl;if(r){if(L.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(f){L.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(D.Events.MEDIA_DETACHED,void 0)},v.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(r){var t=e.sourceBuffer[r];try{t&&(e.removeBufferListeners(r),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[r]=void 0)}catch(f){L.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",f)}}),this._initSourceBuffer()},v.onBufferCodecs=function(e,r){var t=this,f=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(a){if(f){var i=t.tracks[a];if(i&&typeof i.buffer.changeType=="function"){var l=r[a],c=l.codec,h=l.levelCodec,u=l.container,s=(i.levelCodec||i.codec).replace(y,"$1"),o=(h||c).replace(y,"$1");if(s!==o){var d=u+";codecs="+(h||c);t.appendChangeType(a,d)}}}else t.pendingTracks[a]=r[a]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},v.appendChangeType=function(e,r){var t=this,f=this.operationQueue,a={execute:function(){var l=t.sourceBuffer[e];l&&(L.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+r),l.changeType(r)),f.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(l){L.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",l)}};f.append(a,e)},v.onBufferAppending=function(e,r){var t=this,f=this.hls,a=this.operationQueue,i=this.tracks,l=r.data,c=r.type,h=r.frag,u=r.part,s=r.chunkMeta,o=s.buffering[c],d=self.performance.now();o.start=d;var g=h.stats.buffering,S=u?u.stats.buffering:null;g.start===0&&(g.start=d),S&&S.start===0&&(S.start=d);var R=i.audio,I=c==="audio"&&s.id===1&&(R==null?void 0:R.container)==="audio/mpeg",_={execute:function(){if(o.executeStart=self.performance.now(),I){var F=t.sourceBuffer[c];if(F){var U=h.start-F.timestampOffset;Math.abs(U)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+U+") sn: "+h.sn+")"),F.timestampOffset=h.start)}}t.appendExecutor(l,c)},onStart:function(){},onComplete:function(){var F=self.performance.now();o.executeEnd=o.end=F,g.first===0&&(g.first=F),S&&S.first===0&&(S.first=F);var U=t.sourceBuffer,w={};for(var K in U)w[K]=P.BufferHelper.getBuffered(U[K]);t.appendError=0,t.hls.trigger(D.Events.BUFFER_APPENDED,{type:c,frag:h,part:u,chunkMeta:s,parent:h.type,timeRanges:w})},onError:function(F){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",F);var U={type:b.ErrorTypes.MEDIA_ERROR,parent:h.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:F,fatal:!1};F.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=b.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,U.details=b.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>f.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0)),f.trigger(D.Events.ERROR,U)}};a.append(_,c)},v.onBufferFlushing=function(e,r){var t=this,f=this.operationQueue,a=function(l){return{execute:t.removeExecutor.bind(t,l,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(D.Events.BUFFER_FLUSHED,{type:l})},onError:function(h){L.logger.warn("[buffer-controller]: Failed to remove from "+l+" SourceBuffer",h)}}};r.type?f.append(a(r.type),r.type):this.getSourceBufferTypes().forEach(function(i){f.append(a(i),i)})},v.onFragParsed=function(e,r){var t=this,f=r.frag,a=r.part,i=[],l=a?a.elementaryStreams:f.elementaryStreams;l[A.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(l[A.ElementaryStreamTypes.AUDIO]&&i.push("audio"),l[A.ElementaryStreamTypes.VIDEO]&&i.push("video"));var c=function(){var u=self.performance.now();f.stats.buffering.end=u,a&&(a.stats.buffering.end=u);var s=a?a.stats:f.stats;t.hls.trigger(D.Events.FRAG_BUFFERED,{frag:f,part:a,stats:s,id:f.type})};i.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(c,i)},v.onFragChanged=function(e,r){this.flushBackBuffer()},v.onBufferEos=function(e,r){var t=this,f=this.getSourceBufferTypes().reduce(function(a,i){var l=t.sourceBuffer[i];return(!r.type||r.type===i)&&l&&!l.ended&&(l.ended=!0,L.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS")),a&&!!(!l||l.ended)},!0);f&&this.blockBuffers(function(){var a=t.mediaSource;!a||a.readyState!=="open"||a.endOfStream()})},v.onLevelUpdated=function(e,r){var t=r.details;!t.fragments.length||(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},v.flushBackBuffer=function(){var e=this.hls,r=this.details,t=this.media,f=this.sourceBuffer;if(!(!t||r===null)){var a=this.getSourceBufferTypes();if(!!a.length){var i=r.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(i)||i<0)){var l=t.currentTime,c=r.levelTargetDuration,h=Math.max(i,c),u=Math.floor(l/c)*c-h;a.forEach(function(s){var o=f[s];if(o){var d=P.BufferHelper.getBuffered(o);d.length>0&&u>d.start(0)&&(e.trigger(D.Events.BACK_BUFFER_REACHED,{bufferEnd:u}),r.live&&e.trigger(D.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u}),e.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:s}))}})}}}},v.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,r=this.hls,t=this.media,f=this.mediaSource,a=e.fragments[0].start+e.totalduration,i=t.duration,l=Object(M.isFiniteNumber)(f.duration)?f.duration:0;e.live&&r.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(e)):(a>l&&a>i||!Object(M.isFiniteNumber)(i))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),f.duration=a)}},v.updateSeekableRange=function(e){var r=this.mediaSource,t=e.fragments,f=t.length;if(f&&e.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var a=Math.max(0,t[0].start),i=Math.max(a,a+e.totalduration);r.setLiveSeekableRange(a,i)}},v.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,r=this.operationQueue,t=this.pendingTracks,f=Object.keys(t).length;if(f&&!e||f===2){this.createSourceBuffers(t),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length===0){this.hls.trigger(D.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}a.forEach(function(i){r.executeNext(i)})}},v.createSourceBuffers=function(e){var r=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var a in e)if(!r[a]){var i=e[a];if(!i)throw Error("source buffer exists for track "+a+", however track does not");var l=i.levelCodec||i.codec,c=i.container+";codecs="+l;L.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var h=r[a]=t.addSourceBuffer(c),u=a;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[a]={buffer:h,codec:l,container:i.container,levelCodec:i.levelCodec,id:i.id},f++}catch(s){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+s.message),this.hls.trigger(D.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,mimeType:c})}}f&&this.hls.trigger(D.Events.BUFFER_CREATED,{tracks:this.tracks})},v._onSBUpdateStart=function(e){var r=this.operationQueue,t=r.current(e);t.onStart()},v._onSBUpdateEnd=function(e){var r=this.operationQueue,t=r.current(e);t.onComplete(),r.shiftAndExecuteNext(e)},v._onSBUpdateError=function(e,r){L.logger.error("[buffer-controller]: "+e+" SourceBuffer error",r),this.hls.trigger(D.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(r)},v.removeExecutor=function(e,r,t){var f=this.media,a=this.mediaSource,i=this.operationQueue,l=this.sourceBuffer,c=l[e];if(!f||!a||!c){L.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(e);return}var h=Object(M.isFiniteNumber)(f.duration)?f.duration:1/0,u=Object(M.isFiniteNumber)(a.duration)?a.duration:1/0,s=Math.max(0,r),o=Math.min(t,h,u);o>s?(L.logger.log("[buffer-controller]: Removing ["+s+","+o+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(s,o)):i.shiftAndExecuteNext(e)},v.appendExecutor=function(e,r){var t=this.operationQueue,f=this.sourceBuffer,a=f[r];if(!a){L.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(r);return}a.ended=!1,console.assert(!a.updating,r+" sourceBuffer must not be updating"),a.appendBuffer(e)},v.blockBuffers=function(e,r){var t=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(e);return}var f=this.operationQueue,a=r.map(function(i){return f.appendBlocker(i)});Promise.all(a).then(function(){e(),r.forEach(function(i){var l=t.sourceBuffer[i];(!l||!l.updating)&&f.shiftAndExecuteNext(i)})})},v.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},v.addBufferListener=function(e,r,t){var f=this.sourceBuffer[e];if(!!f){var a=t.bind(this,e);this.listeners[e].push({event:r,listener:a}),f.addEventListener(r,a)}},v.removeBufferListeners=function(e){var r=this.sourceBuffer[e];!r||this.listeners[e].forEach(function(t){r.removeEventListener(t.event,t.listener)})},E}()},"./src/controller/buffer-operation-queue.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return D});var M=p("./src/utils/logger.ts"),D=function(){function L(P){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=P}var b=L.prototype;return b.append=function(O,A){var m=this.queues[A];m.push(O),m.length===1&&this.buffers[A]&&this.executeNext(A)},b.insertAbort=function(O,A){var m=this.queues[A];m.unshift(O),this.executeNext(A)},b.appendBlocker=function(O){var A,m=new Promise(function(y){A=y}),x={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(x,O),m},b.executeNext=function(O){var A=this.buffers,m=this.queues,x=A[O],y=m[O];if(y.length){var T=y[0];try{T.execute()}catch(E){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),T.onError(E),(!x||!x.updating)&&(y.shift(),this.executeNext(O))}}},b.shiftAndExecuteNext=function(O){this.queues[O].shift(),this.executeNext(O)},b.current=function(O){return this.queues[O][0]},L}()},"./src/controller/cap-level-controller.ts":function(k,C,p){p.r(C);var M=p("./src/events.ts");function D(P,O){for(var A=0;A<O.length;A++){var m=O[A];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(P,m.key,m)}}function L(P,O,A){return O&&D(P.prototype,O),A&&D(P,A),P}var b=function(){function P(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var O=P.prototype;return O.setStreamController=function(m){this.streamController=m},O.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},O.registerListeners=function(){var m=this.hls;m.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.unregisterListener=function(){var m=this.hls;m.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.onFpsDropLevelCapping=function(m,x){P.isLevelAllowed(x.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(x.droppedLevel)},O.onMediaAttaching=function(m,x){this.media=x.media instanceof HTMLVideoElement?x.media:null},O.onManifestParsed=function(m,x){var y=this.hls;this.restrictedLevels=[],this.firstLevel=x.firstLevel,y.config.capLevelToPlayerSize&&x.video&&this.startCapping()},O.onBufferCodecs=function(m,x){var y=this.hls;y.config.capLevelToPlayerSize&&x.video&&this.startCapping()},O.onMediaDetaching=function(){this.stopCapping()},O.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var x=this.hls;x.autoLevelCapping=this.getMaxLevel(m.length-1),x.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=x.autoLevelCapping}}},O.getMaxLevel=function(m){var x=this,y=this.hls.levels;if(!y.length)return-1;var T=y.filter(function(E,v){return P.isLevelAllowed(v,x.restrictedLevels)&&v<=m});return this.clientRect=null,P.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},O.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},O.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},O.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,x={width:0,height:0};if(m){var y=m.getBoundingClientRect();x.width=y.width,x.height=y.height,!x.width&&!x.height&&(x.width=y.right-y.left||m.width||0,x.height=y.bottom-y.top||m.height||0)}return this.clientRect=x,x},P.isLevelAllowed=function(m,x){return x===void 0&&(x=[]),x.indexOf(m)===-1},P.getMaxLevelByMediaSize=function(m,x,y){if(!m||!m.length)return-1;for(var T=function(r,t){return t?r.width!==t.width||r.height!==t.height:!0},E=m.length-1,v=0;v<m.length;v+=1){var n=m[v];if((n.width>=x||n.height>=y)&&T(n,m[v+1])){E=v;break}}return E},L(P,[{key:"mediaWidth",get:function(){return this.getDimensions().width*P.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*P.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var m=1;try{m=self.devicePixelRatio}catch{}return m}}]),P}();C.default=b},"./src/controller/cmcd-controller.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return T});var M=p("./src/events.ts"),D=p("./src/types/cmcd.ts"),L=p("./src/utils/buffer-helper.ts"),b=p("./src/utils/logger.ts");function P(E,v){for(var n=0;n<v.length;n++){var e=v[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(E,e.key,e)}}function O(E,v,n){return v&&P(E.prototype,v),n&&P(E,n),E}function A(E,v){var n=typeof Symbol!="undefined"&&E[Symbol.iterator]||E["@@iterator"];if(n)return(n=n.call(E)).next.bind(n);if(Array.isArray(E)||(n=m(E))||v&&E&&typeof E.length=="number"){n&&(E=n);var e=0;return function(){return e>=E.length?{done:!0}:{done:!1,value:E[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function m(E,v){if(!!E){if(typeof E=="string")return x(E,v);var n=Object.prototype.toString.call(E).slice(8,-1);if(n==="Object"&&E.constructor&&(n=E.constructor.name),n==="Map"||n==="Set")return Array.from(E);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(E,v)}}function x(E,v){(v==null||v>E.length)&&(v=E.length);for(var n=0,e=new Array(v);n<v;n++)e[n]=E[n];return e}function y(){return y=Object.assign||function(E){for(var v=1;v<arguments.length;v++){var n=arguments[v];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(E[e]=n[e])}return E},y.apply(this,arguments)}var T=function(){function E(n){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(f){try{e.apply(f,{ot:D.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(a){b.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=function(f){try{var a=f.frag,i=e.hls.levels[a.level],l=e.getObjectType(a),c={d:a.duration*1e3,ot:l};(l===D.CMCDObjectType.VIDEO||l===D.CMCDObjectType.AUDIO||l==D.CMCDObjectType.MUXED)&&(c.br=i.bitrate/1e3,c.tb=e.getTopBandwidth(l)/1e3,c.bl=e.getBufferLength(l)),e.apply(f,c)}catch(h){b.logger.warn("Could not generate segment CMCD data.",h)}},this.hls=n;var r=this.config=n.config,t=r.cmcd;t!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=t.sessionId||E.uuid(),this.cid=t.contentId,this.useHeaders=t.useHeaders===!0,this.registerListeners())}var v=E.prototype;return v.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},v.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},v.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},v.onMediaAttached=function(e,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},v.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},v.onBufferCreated=function(e,r){var t,f;this.audioBuffer=(t=r.tracks.audio)===null||t===void 0?void 0:t.buffer,this.videoBuffer=(f=r.tracks.video)===null||f===void 0?void 0:f.buffer},v.createData=function(){var e;return{v:D.CMCDVersion,sf:D.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},v.apply=function(e,r){r===void 0&&(r={}),y(r,this.createData());var t=r.ot===D.CMCDObjectType.INIT||r.ot===D.CMCDObjectType.VIDEO||r.ot===D.CMCDObjectType.MUXED;if(this.starved&&t&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering),this.useHeaders){var f=E.toHeaders(r);if(!Object.keys(f).length)return;e.headers||(e.headers={}),y(e.headers,f)}else{var a=E.toQuery(r);if(!a)return;e.url=E.appendQueryToUri(e.url,a)}},v.getObjectType=function(e){var r=e.type;if(r==="subtitle")return D.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return D.CMCDObjectType.INIT;if(r==="audio")return D.CMCDObjectType.AUDIO;if(r==="main")return this.hls.audioTracks.length?D.CMCDObjectType.VIDEO:D.CMCDObjectType.MUXED},v.getTopBandwidth=function(e){var r=0,t,f=this.hls;if(e===D.CMCDObjectType.AUDIO)t=f.audioTracks;else{var a=f.maxAutoLevel,i=a>-1?a+1:f.levels.length;t=f.levels.slice(0,i)}for(var l=A(t),c;!(c=l()).done;){var h=c.value;h.bitrate>r&&(r=h.bitrate)}return r>0?r:NaN},v.getBufferLength=function(e){var r=this.hls.media,t=e===D.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!t||!r)return NaN;var f=L.BufferHelper.bufferInfo(t,r.currentTime,this.config.maxBufferHole);return f.len*1e3},v.createPlaylistLoader=function(){var e=this.config.pLoader,r=this.applyPlaylistData,t=e||this.config.loader;return function(){function f(i){this.loader=void 0,this.loader=new t(i)}var a=f.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(l,c,h){r(l),this.loader.load(l,c,h)},O(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},v.createFragmentLoader=function(){var e=this.config.fLoader,r=this.applyFragmentData,t=e||this.config.loader;return function(){function f(i){this.loader=void 0,this.loader=new t(i)}var a=f.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(l,c,h){r(l),this.loader.load(l,c,h)},O(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},E.uuid=function(){var e=URL.createObjectURL(new Blob),r=e.toString();return URL.revokeObjectURL(e),r.substr(r.lastIndexOf("/")+1)},E.serialize=function(e){for(var r=[],t=function(I){return!Number.isNaN(I)&&I!=null&&I!==""&&I!==!1},f=function(I){return Math.round(I)},a=function(I){return f(I/100)*100},i=function(I){return encodeURIComponent(I)},l={br:f,d:f,bl:a,dl:a,mtp:a,nor:i,rtp:a,tb:f},c=Object.keys(e||{}).sort(),h=A(c),u;!(u=h()).done;){var s=u.value,o=e[s];if(!!t(o)&&!(s==="v"&&o===1)&&!(s=="pr"&&o===1)){var d=l[s];d&&(o=d(o));var g=typeof o,S=void 0;s==="ot"||s==="sf"||s==="st"?S=s+"="+o:g==="boolean"?S=s:g==="number"?S=s+"="+o:S=s+"="+JSON.stringify(o),r.push(S)}}return r.join(",")},E.toHeaders=function(e){for(var r=Object.keys(e),t={},f=["Object","Request","Session","Status"],a=[{},{},{},{}],i={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},l=0,c=r;l<c.length;l++){var h=c[l],u=i[h]!=null?i[h]:1;a[u][h]=e[h]}for(var s=0;s<a.length;s++){var o=E.serialize(a[s]);o&&(t["CMCD-"+f[s]]=o)}return t},E.toQuery=function(e){return"CMCD="+encodeURIComponent(E.serialize(e))},E.appendQueryToUri=function(e,r){if(!r)return e;var t=e.includes("?")?"&":"?";return""+e+t+r},E}()},"./src/controller/eme-controller.ts":function(k,C,p){p.r(C);var M=p("./src/events.ts"),D=p("./src/errors.ts"),L=p("./src/utils/logger.ts"),b=p("./src/utils/mediakeys-helper.ts");function P(T,E){for(var v=0;v<E.length;v++){var n=E[v];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(T,n.key,n)}}function O(T,E,v){return E&&P(T.prototype,E),v&&P(T,v),T}var A=3,m=function(E,v,n){var e={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(r){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+r+'"',robustness:n.audioRobustness||""})}),v.forEach(function(r){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+r+'"',robustness:n.videoRobustness||""})}),[e]},x=function(E,v,n,e){switch(E){case b.KeySystems.WIDEVINE:return m(v,n,e);default:throw new Error("Unknown key-system: "+E)}},y=function(){function T(v){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=v,this._config=v.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var E=T.prototype;return E.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},E._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E.getLicenseServerUrl=function(n){switch(n){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},E._attemptKeySystemAccess=function(n,e,r){var t=this,f=x(n,e,r,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(n,f);this.mediaKeysPromise=a.then(function(i){return t._onMediaKeySystemAccessObtained(n,i)}),a.catch(function(i){L.logger.error('Failed to obtain key-system "'+n+'" access:',i)})},E._onMediaKeySystemAccessObtained=function(n,e){var r=this;L.logger.log('Access for key-system "'+n+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:n};this._mediaKeysList.push(t);var f=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(a){return t.mediaKeys=a,L.logger.log('Media-keys created for key-system "'+n+'"'),r._onMediaKeysCreated(),a});return f.catch(function(a){L.logger.error("Failed to create media-keys:",a)}),f},E._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),n._onNewMediaKeySession(e.mediaKeysSession))})},E._onNewMediaKeySession=function(n){var e=this;L.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(r){e._onKeySessionMessage(n,r.message)},!1)},E._onKeySessionMessage=function(n,e){L.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(r){L.logger.log("Received license data (length: "+(r&&r.byteLength)+"), updating key-session"),n.update(r)})},E.onMediaEncrypted=function(n){var e=this;if(L.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var r=function(f){!e._media||(e._attemptSetMediaKeys(f),e._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(r).catch(r)},E._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},E._generateRequestWithPreferredKeySession=function(n,e){var r=this,t=this._mediaKeysList[0];if(!t){L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(t.mediaKeysSessionInitialized){L.logger.warn("Key-Session already initialized but requested again");return}var f=t.mediaKeysSession;if(!f){L.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){L.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}L.logger.log('Generating key-session request for "'+n+'" init data type'),t.mediaKeysSessionInitialized=!0,f.generateRequest(n,e).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(a){L.logger.error("Error generating key-session request:",a),r.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},E._createLicenseXhr=function(n,e,r){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,n,e,r);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,t,n),f=void 0}catch(a){L.logger.error(a)}try{t.readyState||t.open("POST",n,!0),f&&f.call(this.hls,t,n)}catch(a){throw new Error("issue setting up KeySystem license XHR "+a)}return t},E._onLicenseRequestReadyStageChange=function(n,e,r,t){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var f=n.response,a=this._licenseResponseCallback;if(a)try{f=a.call(this.hls,n,e)}catch(l){L.logger.error(l)}t(f)}else{if(L.logger.error("License Request XHR failed ("+e+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>A){this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var i=A-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(r,t)}break}},E._generateLicenseRequestChallenge=function(n,e){switch(n.mediaKeySystemDomain){case b.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},E._requestLicense=function(n,e){L.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r){L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var t=this.getLicenseServerUrl(r.mediaKeySystemDomain),f=this._createLicenseXhr(t,n,e);L.logger.log("Sending license request to URL: "+t);var a=this._generateLicenseRequestChallenge(r,n);f.send(a)}catch(i){L.logger.error("Failure requesting DRM license: "+i),this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},E.onMediaAttached=function(n,e){if(!!this._emeEnabled){var r=e.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},E.onMediaDetached=function(){var n=this._media,e=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(r){if(r.mediaKeysSession)return r.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},E.onManifestParsed=function(n,e){if(!!this._emeEnabled){var r=e.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),t=e.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,r,t)}},O(T,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),T}();C.default=y},"./src/controller/fps-controller.ts":function(k,C,p){p.r(C);var M=p("./src/events.ts"),D=p("./src/utils/logger.ts"),L=function(){function b(O){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=O,this.registerListeners()}var P=b.prototype;return P.setStreamController=function(A){this.streamController=A},P.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},P.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},P.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},P.onMediaAttaching=function(A,m){var x=this.hls.config;if(x.capLevelOnFPSDrop){var y=m.media instanceof self.HTMLVideoElement?m.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),x.fpsDroppedMonitoringPeriod)}},P.checkFPS=function(A,m,x){var y=performance.now();if(m){if(this.lastTime){var T=y-this.lastTime,E=x-this.lastDroppedFrames,v=m-this.lastDecodedFrames,n=1e3*E/T,e=this.hls;if(e.trigger(M.Events.FPS_DROP,{currentDropped:E,currentDecoded:v,totalDroppedFrames:x}),n>0&&E>e.config.fpsDroppedMonitoringThreshold*v){var r=e.currentLevel;D.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+r),r>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=r)&&(r=r-1,e.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:r,droppedLevel:e.currentLevel}),e.autoLevelCapping=r,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=x,this.lastDecodedFrames=m}},P.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var m=A.getVideoPlaybackQuality();this.checkFPS(A,m.totalVideoFrames,m.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},b}();C.default=L},"./src/controller/fragment-finders.ts":function(k,C,p){p.r(C),p.d(C,"findFragmentByPDT",function(){return L}),p.d(C,"findFragmentByPTS",function(){return b}),p.d(C,"fragmentWithinToleranceTest",function(){return P}),p.d(C,"pdtWithinToleranceTest",function(){return O}),p.d(C,"findFragWithCC",function(){return A});var M=p("./src/polyfills/number.ts"),D=p("./src/utils/binary-search.ts");function L(m,x,y){if(x===null||!Array.isArray(m)||!m.length||!Object(M.isFiniteNumber)(x))return null;var T=m[0].programDateTime;if(x<(T||0))return null;var E=m[m.length-1].endProgramDateTime;if(x>=(E||0))return null;y=y||0;for(var v=0;v<m.length;++v){var n=m[v];if(O(x,y,n))return n}return null}function b(m,x,y,T){y===void 0&&(y=0),T===void 0&&(T=0);var E=null;if(m?E=x[m.sn-x[0].sn+1]||null:y===0&&x[0].start===0&&(E=x[0]),E&&P(y,T,E)===0)return E;var v=D.default.search(x,P.bind(null,y,T));return v||E}function P(m,x,y){m===void 0&&(m=0),x===void 0&&(x=0);var T=Math.min(x,y.duration+(y.deltaPTS?y.deltaPTS:0));return y.start+y.duration-T<=m?1:y.start-T>m&&y.start?-1:0}function O(m,x,y){var T=Math.min(x,y.duration+(y.deltaPTS?y.deltaPTS:0))*1e3,E=y.endProgramDateTime||0;return E-T>m}function A(m,x){return D.default.search(m,function(y){return y.cc<x?1:y.cc>x?-1:0})}},"./src/controller/fragment-tracker.ts":function(k,C,p){p.r(C),p.d(C,"FragmentState",function(){return L}),p.d(C,"FragmentTracker",function(){return b});var M=p("./src/events.ts"),D=p("./src/types/loader.ts"),L;(function(A){A.NOT_LOADED="NOT_LOADED",A.BACKTRACKED="BACKTRACKED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(L||(L={}));var b=function(){function A(x){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=x,this._registerListeners()}var m=A.prototype;return m._registerListeners=function(){var y=this.hls;y.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var y=this.hls;y.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(y,T){if(T===D.PlaylistLevelType.MAIN){var E=this.activeFragment,v=this.activeParts;if(!E)return null;if(v)for(var n=v.length;n--;){var e=v[n],r=e?e.end:E.appendedPTS;if(e.start<=y&&r!==void 0&&y<=r)return n>9&&(this.activeParts=v.slice(n-9)),e}else if(E.start<=y&&E.appendedPTS!==void 0&&y<=E.appendedPTS)return E}return this.getBufferedFrag(y,T)},m.getBufferedFrag=function(y,T){for(var E=this.fragments,v=Object.keys(E),n=v.length;n--;){var e=E[v[n]];if((e==null?void 0:e.body.type)===T&&e.buffered){var r=e.body;if(r.start<=y&&y<=r.end)return r}}return null},m.detectEvictedFragments=function(y,T,E){var v=this;Object.keys(this.fragments).forEach(function(n){var e=v.fragments[n];if(!!e){if(!e.buffered){e.body.type===E&&v.removeFragment(e.body);return}var r=e.range[y];!r||r.time.some(function(t){var f=!v.isTimeBuffered(t.startPTS,t.endPTS,T);return f&&v.removeFragment(e.body),f})}})},m.detectPartialFragments=function(y){var T=this,E=this.timeRanges,v=y.frag,n=y.part;if(!(!E||v.sn==="initSegment")){var e=O(v),r=this.fragments[e];!r||(Object.keys(E).forEach(function(t){var f=v.elementaryStreams[t];if(!!f){var a=E[t],i=n!==null||f.partial===!0;r.range[t]=T.getBufferedTimes(v,n,i,a)}}),r.backtrack=r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},m.fragBuffered=function(y){var T=O(y),E=this.fragments[T];E&&(E.backtrack=E.loaded=null,E.buffered=!0)},m.getBufferedTimes=function(y,T,E,v){for(var n={time:[],partial:E},e=T?T.start:y.start,r=T?T.end:y.end,t=y.minEndPTS||r,f=y.maxStartPTS||e,a=0;a<v.length;a++){var i=v.start(a)-this.bufferPadding,l=v.end(a)+this.bufferPadding;if(f>=i&&t<=l){n.time.push({startPTS:Math.max(e,v.start(a)),endPTS:Math.min(r,v.end(a))});break}else if(e<l&&r>i)n.partial=!0,n.time.push({startPTS:Math.max(e,v.start(a)),endPTS:Math.min(r,v.end(a))});else if(r<=i)break}return n},m.getPartialFragment=function(y){var T=null,E,v,n,e=0,r=this.bufferPadding,t=this.fragments;return Object.keys(t).forEach(function(f){var a=t[f];!a||P(a)&&(v=a.body.start-r,n=a.body.end+r,y>=v&&y<=n&&(E=Math.min(y-v,n-y),e<=E&&(T=a.body,e=E)))}),T},m.getState=function(y){var T=O(y),E=this.fragments[T];return E?E.buffered?P(E)?L.PARTIAL:L.OK:E.backtrack?L.BACKTRACKED:L.APPENDING:L.NOT_LOADED},m.backtrack=function(y,T){var E=O(y),v=this.fragments[E];if(!v||v.backtrack)return null;var n=v.backtrack=T||v.loaded;return v.loaded=null,n},m.getBacktrackData=function(y){var T=O(y),E=this.fragments[T];if(E){var v,n=E.backtrack;if(n!=null&&(v=n.payload)!==null&&v!==void 0&&v.byteLength)return n;this.removeFragment(y)}return null},m.isTimeBuffered=function(y,T,E){for(var v,n,e=0;e<E.length;e++){if(v=E.start(e)-this.bufferPadding,n=E.end(e)+this.bufferPadding,y>=v&&T<=n)return!0;if(T<=v)return!1}return!1},m.onFragLoaded=function(y,T){var E=T.frag,v=T.part;if(!(E.sn==="initSegment"||E.bitrateTest||v)){var n=O(E);this.fragments[n]={body:E,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(y,T){var E=this,v=T.frag,n=T.part,e=T.timeRanges;if(v.type===D.PlaylistLevelType.MAIN)if(this.activeFragment=v,n){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(n)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(t){var f=e[t];if(E.detectEvictedFragments(t,f),!n)for(var a=0;a<f.length;a++)v.appendedPTS=Math.max(f.end(a),v.appendedPTS||0)})},m.onFragBuffered=function(y,T){this.detectPartialFragments(T)},m.hasFragment=function(y){var T=O(y);return!!this.fragments[T]},m.removeFragmentsInRange=function(y,T,E){var v=this;Object.keys(this.fragments).forEach(function(n){var e=v.fragments[n];if(!!e&&e.buffered){var r=e.body;r.type===E&&r.start<T&&r.end>y&&v.removeFragment(r)}})},m.removeFragment=function(y){var T=O(y);y.stats.loaded=0,y.clearElementaryStreamInfo(),delete this.fragments[T]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function P(A){var m,x;return A.buffered&&(((m=A.range.video)===null||m===void 0?void 0:m.partial)||((x=A.range.audio)===null||x===void 0?void 0:x.partial))}function O(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(k,C,p){p.r(C),p.d(C,"STALL_MINIMUM_DURATION_MS",function(){return P}),p.d(C,"MAX_START_GAP_JUMP",function(){return O}),p.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return A}),p.d(C,"SKIP_BUFFER_RANGE_START",function(){return m}),p.d(C,"default",function(){return x});var M=p("./src/utils/buffer-helper.ts"),D=p("./src/errors.ts"),L=p("./src/events.ts"),b=p("./src/utils/logger.ts"),P=250,O=2,A=.1,m=.05,x=function(){function y(E,v,n,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=E,this.media=v,this.fragmentTracker=n,this.hls=e}var T=y.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(v){var n=this.config,e=this.media,r=this.stalled,t=e.currentTime,f=e.seeking,a=this.seeking&&!f,i=!this.seeking&&f;if(this.seeking=f,t!==v){if(this.moved=!0,r!==null){if(this.stallReported){var l=self.performance.now()-r;b.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(l)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||a)&&(this.stalled=null),!(e.paused||e.ended||e.playbackRate===0||!M.BufferHelper.getBuffered(e).length)){var c=M.BufferHelper.bufferInfo(e,t,0),h=c.len>0,u=c.nextStart||0;if(!(!h&&!u)){if(f){var s=c.len>O,o=!u||u-t>O&&!this.fragmentTracker.getPartialFragment(t);if(s||o)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d,g=Math.max(u,c.start||0)-t,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,R=S==null||(d=S.details)===null||d===void 0?void 0:d.live,I=R?S.details.targetduration*2:O;if(g>0&&g<=I){this._trySkipBufferHole(null);return}}var _=self.performance.now();if(r===null){this.stalled=_;return}var B=_-r;!f&&B>=P&&this._reportStall(c.len);var F=M.BufferHelper.bufferInfo(e,t,n.maxBufferHole);this._tryFixBufferStall(F,B)}}},T._tryFixBufferStall=function(v,n){var e=this.config,r=this.fragmentTracker,t=this.media,f=t.currentTime,a=r.getPartialFragment(f);if(a){var i=this._trySkipBufferHole(a);if(i)return}v.len>e.maxBufferHole&&n>e.highBufferWatchdogPeriod*1e3&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(v){var n=this.hls,e=this.media,r=this.stallReported;r||(this.stallReported=!0,b.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+v+")"),n.trigger(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:v}))},T._trySkipBufferHole=function(v){for(var n=this.config,e=this.hls,r=this.media,t=r.currentTime,f=0,a=M.BufferHelper.getBuffered(r),i=0;i<a.length;i++){var l=a.start(i);if(t+n.maxBufferHole>=f&&t<l){var c=Math.max(l+m,r.currentTime+A);return b.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+c),this.moved=!0,this.stalled=null,r.currentTime=c,v&&e.trigger(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+c,frag:v}),c}f=a.end(i)}return 0},T._tryNudgeBuffer=function(){var v=this.config,n=this.hls,e=this.media,r=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<v.nudgeMaxRetry){var f=r+t*v.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+r+" to "+f),e.currentTime=f,n.trigger(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+v.nudgeMaxRetry+" nudges"),n.trigger(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},y}()},"./src/controller/id3-track-controller.ts":function(k,C,p){p.r(C);var M=p("./src/events.ts"),D=p("./src/utils/texttrack-utils.ts"),L=p("./src/demux/id3.ts"),b=.25,P=function(){function O(m){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=m,this._registerListeners()}var A=O.prototype;return A.destroy=function(){this._unregisterListeners()},A._registerListeners=function(){var x=this.hls;x.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.on(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),x.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A._unregisterListeners=function(){var x=this.hls;x.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.off(M.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),x.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A.onMediaAttached=function(x,y){this.media=y.media},A.onMediaDetaching=function(){!this.id3Track||(Object(D.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},A.getID3Track=function(x){if(!!this.media){for(var y=0;y<x.length;y++){var T=x[y];if(T.kind==="metadata"&&T.label==="id3")return Object(D.sendAddTrackEvent)(T,this.media),T}return this.media.addTextTrack("metadata","id3")}},A.onFragParsingMetadata=function(x,y){if(!!this.media){var T=y.frag,E=y.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var v=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,n=0;n<E.length;n++){var e=L.getID3Frames(E[n].data);if(e){var r=E[n].pts,t=n<E.length-1?E[n+1].pts:T.end,f=t-r;f<=0&&(t=r+b);for(var a=0;a<e.length;a++){var i=e[a];if(!L.isTimeStampFrame(i)){var l=new v(r,t,"");l.value=i,this.id3Track.addCue(l)}}}}}},A.onBufferFlushing=function(x,y){var T=y.startOffset,E=y.endOffset,v=y.type;if(!v||v==="audio"){var n=this.id3Track;n&&Object(D.removeCuesInRange)(n,T,E)}},O}();C.default=P},"./src/controller/latency-controller.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return O});var M=p("./src/errors.ts"),D=p("./src/events.ts"),L=p("./src/utils/logger.ts");function b(A,m){for(var x=0;x<m.length;x++){var y=m[x];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(A,y.key,y)}}function P(A,m,x){return m&&b(A.prototype,m),x&&b(A,x),A}var O=function(){function A(x){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=x,this.config=x.config,this.registerListeners()}var m=A.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(D.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(D.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(D.Events.ERROR,this.onError)},m.onMediaAttached=function(y,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(y,T){var E=T.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(y,T){T.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var y=this.media,T=this.levelDetails;if(!(!y||!T)){this.currentTime=y.currentTime;var E=this.computeLatency();if(E!==null){this._latency=E;var v=this.config,n=v.lowLatencyMode,e=v.maxLiveSyncPlaybackRate;if(!(!n||e===1)){var r=this.targetLatency;if(r!==null){var t=E-r,f=Math.min(this.maxLatency,r+T.targetduration),a=t<f;if(T.live&&a&&t>.05&&this.forwardBufferLength>1){var i=Math.min(2,Math.max(1,e)),l=Math.round(2/(1+Math.exp(-.75*t-this.edgeStalled))*20)/20;y.playbackRate=Math.min(i,Math.max(1,l))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},m.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},P(A,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,T=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:T?y.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var T=y.holdBack,E=y.partHoldBack,v=y.targetduration,n=this.config,e=n.liveSyncDuration,r=n.liveSyncDurationCount,t=n.lowLatencyMode,f=this.hls.userConfig,a=t&&E||T;(f.liveSyncDuration||f.liveSyncDurationCount||a===0)&&(a=e!==void 0?e:r*v);var i=v,l=1;return a+Math.min(this.stallCount*l,i)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),T=this.targetLatency,E=this.levelDetails;if(y===null||T===null||E===null)return null;var v=E.edge,n=y-T-this.edgeStalled,e=v-E.totalduration,r=v-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(e,n),r)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var T=(this.config.lowLatencyMode&&y.partTarget||y.targetduration)*3;return Math.max(y.age-T,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,T=this.levelDetails;if(!y||!T)return 0;var E=y.buffered.length;return E?y.buffered.end(E-1):T.edge-this.currentTime}}]),A}()},"./src/controller/level-controller.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return n});var M=p("./src/types/level.ts"),D=p("./src/events.ts"),L=p("./src/errors.ts"),b=p("./src/utils/codecs.ts"),P=p("./src/controller/level-helper.ts"),O=p("./src/controller/base-playlist-controller.ts"),A=p("./src/types/loader.ts");function m(){return m=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(e[f]=t[f])}return e},m.apply(this,arguments)}function x(e,r){for(var t=0;t<r.length;t++){var f=r[t];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(e,f.key,f)}}function y(e,r,t){return r&&x(e.prototype,r),t&&x(e,t),e}function T(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,E(e,r)}function E(e,r){return E=Object.setPrototypeOf||function(f,a){return f.__proto__=a,f},E(e,r)}var v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(e){T(r,e);function r(f){var a;return a=e.call(this,f,"[level-controller]")||this,a._levels=[],a._firstLevel=-1,a._startLevel=void 0,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.onParsedComplete=void 0,a._registerListeners(),a}var t=r.prototype;return t._registerListeners=function(){var a=this.hls;a.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(D.Events.ERROR,this.onError,this)},t._unregisterListeners=function(){var a=this.hls;a.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(D.Events.ERROR,this.onError,this)},t.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},t.startLoad=function(){var a=this._levels;a.forEach(function(i){i.loadError=0}),e.prototype.startLoad.call(this)},t.onManifestLoaded=function(a,i){var l=[],c=[],h=[],u,s={},o,d=!1,g=!1,S=!1;if(i.levels.forEach(function(B){var F=B.attrs;d=d||!!(B.width&&B.height),g=g||!!B.videoCodec,S=S||!!B.audioCodec,v&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0);var U=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;o=s[U],o?o.url.push(B.url):(o=new M.Level(B),s[U]=o,l.push(o)),F&&(F.AUDIO&&Object(P.addGroupId)(o,"audio",F.AUDIO),F.SUBTITLES&&Object(P.addGroupId)(o,"text",F.SUBTITLES))}),(d||g)&&S&&(l=l.filter(function(B){var F=B.videoCodec,U=B.width,w=B.height;return!!F||!!(U&&w)})),l=l.filter(function(B){var F=B.audioCodec,U=B.videoCodec;return(!F||Object(b.isCodecSupportedInMp4)(F,"audio"))&&(!U||Object(b.isCodecSupportedInMp4)(U,"video"))}),i.audioTracks&&(c=i.audioTracks.filter(function(B){return!B.audioCodec||Object(b.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(P.assignTrackIdsByGroup)(c)),i.subtitles&&(h=i.subtitles,Object(P.assignTrackIdsByGroup)(h)),l.length>0){u=l[0].bitrate,l.sort(function(B,F){return B.bitrate-F.bitrate}),this._levels=l;for(var R=0;R<l.length;R++)if(l[R].bitrate===u){this._firstLevel=R,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+u);break}var I=S&&!g,_={levels:l,audioTracks:c,subtitleTracks:h,firstLevel:this._firstLevel,stats:i.stats,audio:S,video:g,altAudio:!I&&c.some(function(B){return!!B.url})};this.hls.trigger(D.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(D.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:i.url,reason:"no level with compatible codecs found in manifest"})},t.onError=function(a,i){if(e.prototype.onError.call(this,a,i),!i.fatal){var l=i.context,c=this._levels[this.currentLevelIndex];if(l&&(l.type===A.PlaylistContextType.AUDIO_TRACK&&c.audioGroupIds&&l.groupId===c.audioGroupIds[c.urlId]||l.type===A.PlaylistContextType.SUBTITLE_TRACK&&c.textGroupIds&&l.groupId===c.textGroupIds[c.urlId])){this.redundantFailover(this.currentLevelIndex);return}var h=!1,u=!0,s;switch(i.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(i.frag){var o=this._levels[i.frag.level];o?(o.fragmentError++,o.fragmentError>this.hls.config.fragLoadingMaxRetry&&(s=i.frag.level)):s=i.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:l&&(l.deliveryDirectives&&(u=!1),s=l.level),h=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:s=i.level,h=!0;break}s!==void 0&&this.recoverLevel(i,s,h,u)}},t.recoverLevel=function(a,i,l,c){var h=a.details,u=this._levels[i];if(u.loadError++,l){var s=this.retryLoadingOrFail(a);if(s)a.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(c){var o=u.url.length;if(o>1&&u.loadError<o)a.levelRetry=!0,this.redundantFailover(i);else if(this.manualLevelIndex===-1){var d=i===0?this._levels.length-1:i-1;this.currentLevelIndex!==d&&this._levels[d].loadError===0&&(this.warn(h+": switch to "+d),a.levelRetry=!0,this.hls.nextAutoLevel=d)}}},t.redundantFailover=function(a){var i=this._levels[a],l=i.url.length;if(l>1){var c=(i.urlId+1)%l;this.warn("Switching to redundant URL-id "+c),this._levels.forEach(function(h){h.urlId=c}),this.level=a}},t.onFragLoaded=function(a,i){var l=i.frag;if(l!==void 0&&l.type===A.PlaylistLevelType.MAIN){var c=this._levels[l.level];c!==void 0&&(c.fragmentError=0,c.loadError=0)}},t.onLevelLoaded=function(a,i){var l,c=i.level,h=i.details,u=this._levels[c];if(!u){var s;this.warn("Invalid level index "+c),(s=i.deliveryDirectives)!==null&&s!==void 0&&s.skip&&(h.deltaUpdateFailed=!0);return}c===this.currentLevelIndex?(u.fragmentError===0&&(u.loadError=0,this.retryCount=0),this.playlistLoaded(c,i,u.details)):(l=i.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(h.deltaUpdateFailed=!0)},t.onAudioTrackSwitched=function(a,i){var l=this.hls.levels[this.currentLevelIndex];if(!!l&&l.audioGroupIds){for(var c=-1,h=this.hls.audioTracks[i.id].groupId,u=0;u<l.audioGroupIds.length;u++)if(l.audioGroupIds[u]===h){c=u;break}c!==l.urlId&&(l.urlId=c,this.startLoad())}},t.loadPlaylist=function(a){var i=this.currentLevelIndex,l=this._levels[i];if(this.canLoad&&l&&l.url.length>0){var c=l.urlId,h=l.url[c];if(a)try{h=a.addDirectives(h)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Attempt loading level index "+i+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+c+" "+h),this.clearTimer(),this.hls.trigger(D.Events.LEVEL_LOADING,{url:h,level:i,id:c,deliveryDirectives:a||null})}},t.removeLevel=function(a,i){var l=function(u,s){return s!==i},c=this._levels.filter(function(h,u){return u!==a?!0:h.url.length>1&&i!==void 0?(h.url=h.url.filter(l),h.audioGroupIds&&(h.audioGroupIds=h.audioGroupIds.filter(l)),h.textGroupIds&&(h.textGroupIds=h.textGroupIds.filter(l)),h.urlId=0,!0):!1}).map(function(h,u){var s=h.details;return s!=null&&s.fragments&&s.fragments.forEach(function(o){o.level=u}),h});this._levels=c,this.hls.trigger(D.Events.LEVELS_UPDATED,{levels:c})},y(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var i,l=this._levels;if(l.length!==0&&!(this.currentLevelIndex===a&&(i=l[a])!==null&&i!==void 0&&i.details)){if(a<0||a>=l.length){var c=a<0;if(this.hls.trigger(D.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:c,reason:"invalid level idx"}),c)return;a=Math.min(a,l.length-1)}this.clearTimer();var h=this.currentLevelIndex,u=l[h],s=l[a];this.log("switching to level "+a+" from "+h),this.currentLevelIndex=a;var o=m({},s,{level:a,maxBitrate:s.maxBitrate,uri:s.uri,urlId:s.urlId});delete o._urlId,this.hls.trigger(D.Events.LEVEL_SWITCHING,o);var d=s.details;if(!d||d.live){var g=this.switchParams(s.uri,u==null?void 0:u.details);this.loadPlaylist(g)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,this._startLevel===void 0&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var a=this.hls.config.startLevel;return a!==void 0?a:this._firstLevel}else return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=a)}}]),r}(O.default)},"./src/controller/level-helper.ts":function(k,C,p){p.r(C),p.d(C,"addGroupId",function(){return L}),p.d(C,"assignTrackIdsByGroup",function(){return b}),p.d(C,"updatePTS",function(){return P}),p.d(C,"updateFragPTSDTS",function(){return A}),p.d(C,"mergeDetails",function(){return m}),p.d(C,"mapPartIntersection",function(){return x}),p.d(C,"mapFragmentIntersection",function(){return y}),p.d(C,"adjustSliding",function(){return T}),p.d(C,"addSliding",function(){return E}),p.d(C,"computeReloadInterval",function(){return v}),p.d(C,"getFragmentWithSN",function(){return n}),p.d(C,"getPartWith",function(){return e});var M=p("./src/polyfills/number.ts"),D=p("./src/utils/logger.ts");function L(r,t,f){switch(t){case"audio":r.audioGroupIds||(r.audioGroupIds=[]),r.audioGroupIds.push(f);break;case"text":r.textGroupIds||(r.textGroupIds=[]),r.textGroupIds.push(f);break}}function b(r){var t={};r.forEach(function(f){var a=f.groupId||"";f.id=t[a]=t[a]||0,t[a]++})}function P(r,t,f){var a=r[t],i=r[f];O(a,i)}function O(r,t){var f=t.startPTS;if(Object(M.isFiniteNumber)(f)){var a=0,i;t.sn>r.sn?(a=f-r.start,i=r):(a=r.start-f,i=t),i.duration!==a&&(i.duration=a)}else if(t.sn>r.sn){var l=r.cc===t.cc;l&&r.minEndPTS?t.start=r.start+(r.minEndPTS-r.start):t.start=r.start+r.duration}else t.start=Math.max(r.start-t.duration,0)}function A(r,t,f,a,i,l){var c=a-f;c<=0&&(D.logger.warn("Fragment should have a positive duration",t),a=f+t.duration,l=i+t.duration);var h=f,u=a,s=t.startPTS,o=t.endPTS;if(Object(M.isFiniteNumber)(s)){var d=Math.abs(s-f);Object(M.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,h=Math.max(f,s),f=Math.min(f,s),i=Math.min(i,t.startDTS),u=Math.min(a,o),a=Math.max(a,o),l=Math.max(l,t.endDTS)}t.duration=a-f;var g=f-t.start;t.appendedPTS=a,t.start=t.startPTS=f,t.maxStartPTS=h,t.startDTS=i,t.endPTS=a,t.minEndPTS=u,t.endDTS=l;var S=t.sn;if(!r||S<r.startSN||S>r.endSN)return 0;var R,I=S-r.startSN,_=r.fragments;for(_[I]=t,R=I;R>0;R--)O(_[R],_[R-1]);for(R=I;R<_.length-1;R++)O(_[R],_[R+1]);return r.fragmentHint&&O(_[_.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,g}function m(r,t){for(var f=null,a=r.fragments,i=a.length-1;i>=0;i--){var l=a[i].initSegment;if(l){f=l;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;var c=0,h;if(y(r,t,function(R,I){R.relurl&&(c=R.cc-I.cc),Object(M.isFiniteNumber)(R.startPTS)&&Object(M.isFiniteNumber)(R.endPTS)&&(I.start=I.startPTS=R.startPTS,I.startDTS=R.startDTS,I.appendedPTS=R.appendedPTS,I.maxStartPTS=R.maxStartPTS,I.endPTS=R.endPTS,I.endDTS=R.endDTS,I.minEndPTS=R.minEndPTS,I.duration=R.endPTS-R.startPTS,I.duration&&(h=I),t.PTSKnown=t.alignedSliding=!0),I.elementaryStreams=R.elementaryStreams,I.loader=R.loader,I.stats=R.stats,I.urlId=R.urlId,R.initSegment&&(I.initSegment=R.initSegment,f=R.initSegment)}),f){var u=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;u.forEach(function(R){var I;(!R.initSegment||R.initSegment.relurl===((I=f)===null||I===void 0?void 0:I.relurl))&&(R.initSegment=f)})}if(t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some(function(R){return!R}),t.deltaUpdateFailed)){D.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var s=t.skippedSegments;s--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var o=t.fragments;if(c){D.logger.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<o.length;d++)o[d].cc+=c}t.skippedSegments&&(t.startCC=t.fragments[0].cc),x(r.partList,t.partList,function(R,I){I.elementaryStreams=R.elementaryStreams,I.stats=R.stats}),h?A(t,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):T(r,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=r.driftStartTime,t.driftStart=r.driftStart;var g=t.advancedDateTime;if(t.advanced&&g){var S=t.edge;t.driftStart||(t.driftStartTime=g,t.driftStart=S),t.driftEndTime=g,t.driftEnd=S}else t.driftEndTime=r.driftEndTime,t.driftEnd=r.driftEnd,t.advancedDateTime=r.advancedDateTime}function x(r,t,f){if(r&&t)for(var a=0,i=0,l=r.length;i<=l;i++){var c=r[i],h=t[i+a];c&&h&&c.index===h.index&&c.fragment.sn===h.fragment.sn?f(c,h):a--}}function y(r,t,f){for(var a=t.skippedSegments,i=Math.max(r.startSN,t.startSN)-t.startSN,l=(r.fragmentHint?1:0)+(a?t.endSN:Math.min(r.endSN,t.endSN))-t.startSN,c=t.startSN-r.startSN,h=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,s=i;s<=l;s++){var o=u[c+s],d=h[s];a&&!d&&s<a&&(d=t.fragments[s]=o),o&&d&&f(o,d)}}function T(r,t){var f=t.startSN+t.skippedSegments-r.startSN,a=r.fragments;f<0||f>=a.length||E(t,a[f].start)}function E(r,t){if(t){for(var f=r.fragments,a=r.skippedSegments;a<f.length;a++)f[a].start+=t;r.fragmentHint&&(r.fragmentHint.start+=t)}}function v(r,t){var f=1e3*r.levelTargetDuration,a=f/2,i=r.age,l=i>0&&i<f*3,c=t.loading.end-t.loading.start,h,u=r.availabilityDelay;if(r.updated===!1)if(l){var s=333*r.misses;h=Math.max(Math.min(a,c*2),s),r.availabilityDelay=(r.availabilityDelay||0)+h}else h=a;else l?(u=Math.min(u||f/2,i),r.availabilityDelay=u,h=u+f-i):h=f-c;return Math.round(h)}function n(r,t,f){if(!r||!r.details)return null;var a=r.details,i=a.fragments[t-a.startSN];return i||(i=a.fragmentHint,i&&i.sn===t)?i:t<a.startSN&&f&&f.sn===t?f:null}function e(r,t,f){if(!r||!r.details)return null;var a=r.details.partList;if(a)for(var i=a.length;i--;){var l=a[i];if(l.index===f&&l.fragment.sn===t)return l}return null}},"./src/controller/stream-controller.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return a});var M=p("./src/polyfills/number.ts"),D=p("./src/controller/base-stream-controller.ts"),L=p("./src/is-supported.ts"),b=p("./src/events.ts"),P=p("./src/utils/buffer-helper.ts"),O=p("./src/controller/fragment-tracker.ts"),A=p("./src/types/loader.ts"),m=p("./src/loader/fragment.ts"),x=p("./src/demux/transmuxer-interface.ts"),y=p("./src/types/transmuxer.ts"),T=p("./src/controller/gap-controller.ts"),E=p("./src/errors.ts"),v=p("./src/utils/logger.ts");function n(i,l){for(var c=0;c<l.length;c++){var h=l[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function e(i,l,c){return l&&n(i.prototype,l),c&&n(i,c),i}function r(i,l){i.prototype=Object.create(l.prototype),i.prototype.constructor=i,t(i,l)}function t(i,l){return t=Object.setPrototypeOf||function(h,u){return h.__proto__=u,h},t(i,l)}var f=100,a=function(i){r(l,i);function l(h,u){var s;return s=i.call(this,h,u,"[stream-controller]")||this,s.audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.stalled=!1,s.couldBacktrack=!1,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}var c=l.prototype;return c._registerListeners=function(){var u=this.hls;u.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.on(b.Events.ERROR,this.onError,this),u.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c._unregisterListeners=function(){var u=this.hls;u.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.off(b.Events.ERROR,this.onError,this),u.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},c.startLoad=function(u){if(this.levels){var s=this.lastCurrentTime,o=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=o.startLevel;d===-1&&(o.config.testBandwidth?(d=0,this.bitrateTest=!0):d=o.nextAutoLevel),this.level=o.nextLoadLevel=d,this.loadedmetadata=!1}s>0&&u===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),u=s),this.state=D.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()}else this._forceStartLoad=!0,this.state=D.State.STOPPED},c.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},c.doTick=function(){switch(this.state){case D.State.IDLE:this.doTickIdle();break;case D.State.WAITING_LEVEL:{var u,s=this.levels,o=this.level,d=s==null||(u=s[o])===null||u===void 0?void 0:u.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=D.State.IDLE;break}break}case D.State.FRAG_LOADING_WAITING_RETRY:{var g,S=self.performance.now(),R=this.retryDate;(!R||S>=R||(g=this.media)!==null&&g!==void 0&&g.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=D.State.IDLE)}break}this.onTickEnd()},c.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},c.doTickIdle=function(){var u,s,o=this.hls,d=this.levelLastLoaded,g=this.levels,S=this.media,R=o.config,I=o.nextLoadLevel;if(!(d===null||!S&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!g||!g[I])){var _=g[I];this.level=o.nextLoadLevel=I;var B=_.details;if(!B||this.state===D.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==I){this.state=D.State.WAITING_LEVEL;return}var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:S,A.PlaylistLevelType.MAIN);if(F!==null){var U=F.len,w=this.getMaxBufferLength(_.maxBitrate);if(!(U>=w)){if(this._streamEnded(F,B)){var K={};this.altAudio&&(K.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,K),this.state=D.State.ENDED;return}var H=F.end,j=this.getNextFragment(H,B);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"){var Y=j.sn-B.startSN;Y>1&&(j=B.fragments[Y-1],this.fragmentTracker.removeFragment(j))}if(j&&this.fragmentTracker.getState(j)===O.FragmentState.OK&&this.nextLoadPosition>H){var z=this.audioOnly&&!this.altAudio?m.ElementaryStreamTypes.AUDIO:m.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(S,z,A.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,B)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((u=j.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((s=j.decryptdata)!==null&&s!==void 0&&s.key)?this.loadKey(j,B):this.loadFragment(j,B,H))}}}},c.loadFragment=function(u,s,o){var d,g=this.fragmentTracker.getState(u);if(this.fragCurrent=u,g===O.FragmentState.BACKTRACKED){var S=this.fragmentTracker.getBacktrackData(u);if(S){this._handleFragmentLoadProgress(S),this._handleFragmentLoadComplete(S);return}else g=O.FragmentState.NOT_LOADED}g===O.FragmentState.NOT_LOADED||g===O.FragmentState.PARTIAL?u.sn==="initSegment"?this._loadInitSegment(u):this.bitrateTest?(u.bitrateTest=!0,this.log("Fragment "+u.sn+" of level "+u.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(u)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,u,s,o)):g===O.FragmentState.APPENDING?this.reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u):((d=this.media)===null||d===void 0?void 0:d.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},c.getAppendedFrag=function(u){var s=this.fragmentTracker.getAppendedFrag(u,A.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},c.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,A.PlaylistLevelType.MAIN)},c.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.end+.5):null},c.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},c.nextLevelSwitch=function(){var u=this.levels,s=this.media;if(s!=null&&s.readyState){var o,d=this.getAppendedFrag(s.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!s.paused&&u){var g=this.hls.nextLoadLevel,S=u[g],R=this.fragLastKbps;R&&this.fragCurrent?o=this.fragCurrent.duration*S.maxBitrate/(1e3*R)+1:o=0}else o=0;var I=this.getBufferedFrag(s.currentTime+o);if(I){var _=this.followingBufferedFrag(I);if(_){this.abortCurrentFrag();var B=_.maxStartPTS?_.maxStartPTS:_.start,F=_.duration,U=Math.max(I.end,B+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},c.abortCurrentFrag=function(){var u=this.fragCurrent;this.fragCurrent=null,u!=null&&u.loader&&u.loader.abort(),this.state===D.State.KEY_LOADING&&(this.state=D.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},c.flushMainBuffer=function(u,s){i.prototype.flushMainBuffer.call(this,u,s,this.altAudio?"video":null)},c.onMediaAttached=function(u,s){i.prototype.onMediaAttached.call(this,u,s);var o=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),o.addEventListener("playing",this.onvplaying),o.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,o,this.fragmentTracker,this.hls)},c.onMediaDetaching=function(){var u=this.media;u&&(u.removeEventListener("playing",this.onvplaying),u.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},c.onMediaPlaying=function(){this.tick()},c.onMediaSeeked=function(){var u=this.media,s=u?u.currentTime:null;Object(M.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},c.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},c.onManifestParsed=function(u,s){var o=!1,d=!1,g;s.levels.forEach(function(S){g=S.audioCodec,g&&(g.indexOf("mp4a.40.2")!==-1&&(o=!0),g.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=o&&d&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},c.onLevelLoading=function(u,s){var o=this.levels;if(!(!o||this.state!==D.State.IDLE)){var d=o[s.level];(!d.details||d.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(d.details))&&(this.state=D.State.WAITING_LEVEL)}},c.onLevelLoaded=function(u,s){var o,d=this.levels,g=s.level,S=s.details,R=S.totalduration;if(!d){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+S.startSN+","+S.endSN+"], cc ["+S.startCC+", "+S.endCC+"] duration:"+R);var I=this.fragCurrent;I&&(this.state===D.State.FRAG_LOADING||this.state===D.State.FRAG_LOADING_WAITING_RETRY)&&I.level!==s.level&&I.loader&&(this.state=D.State.IDLE,I.loader.abort());var _=d[g],B=0;if(S.live||(o=_.details)!==null&&o!==void 0&&o.live){if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed)return;B=this.alignPlaylists(S,_.details)}if(_.details=S,this.levelLastLoaded=g,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:S,level:g}),this.state===D.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(S))return;this.state=D.State.IDLE}this.startFragRequested?S.live&&this.synchronizeToLiveEdge(S):this.setStartPosition(S,B),this.tick()},c._handleFragmentLoadProgress=function(u){var s,o=u.frag,d=u.part,g=u.payload,S=this.levels;if(!S){this.warn("Levels were reset while fragment load was in progress. Fragment "+o.sn+" of level "+o.level+" will not be buffered");return}var R=S[o.level],I=R.details;if(!I){this.warn("Dropping fragment "+o.sn+" of level "+o.level+" after level details were reset");return}var _=R.videoCodec,B=I.PTSKnown||!I.live,F=(s=o.initSegment)===null||s===void 0?void 0:s.data,U=this._getAudioCodec(R),w=this.transmuxer=this.transmuxer||new x.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=d?d.index:-1,H=K!==-1,j=new y.ChunkMetadata(o.level,o.sn,o.stats.chunkCount,g.byteLength,K,H),Y=this.initPTS[o.cc];w.push(g,F,U,_,o,d,I.totalduration,B,j,Y)},c.onAudioTrackSwitching=function(u,s){var o=this.altAudio,d=!!s.url,g=s.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var S=this.fragCurrent;S!=null&&S.loader&&(this.log("Switching to main audio track, cancel main fragment load"),S.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;o&&R.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:g})}},c.onAudioTrackSwitched=function(u,s){var o=s.id,d=!!this.hls.audioTracks[o].url;if(d){var g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=d,this.tick()},c.onBufferCreated=function(u,s){var o=s.tracks,d,g,S=!1;for(var R in o){var I=o[R];if(I.id==="main"){if(g=R,d=I,R==="video"){var _=o[R];_&&(this.videoBuffer=_.buffer)}}else S=!0}S&&d?(this.log("Alternate track found, use "+g+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},c.onFragBuffered=function(u,s){var o=s.frag,d=s.part;if(!(o&&o.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(o)){this.warn("Fragment "+o.sn+(d?" p: "+d.index:"")+" of level "+o.level+" finished buffering, but was aborted. state: "+this.state),this.state===D.State.PARSED&&(this.state=D.State.IDLE);return}var g=d?d.stats:o.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),o.sn!=="initSegment"&&(this.fragPrevious=o),this.fragBufferedComplete(o,d)}},c.onError=function(u,s){switch(s.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,s);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==D.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=D.State.ERROR):!s.levelRetry&&this.state===D.State.WAITING_LEVEL&&(this.state=D.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===D.State.PARSING||this.state===D.State.PARSED)){var o=!0,d=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);d&&d.len>.5&&(o=!this.reduceMaxBufferLength(d.len)),o&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},c.checkBuffer=function(){var u=this.media,s=this.gapController;if(!(!u||!s||!u.readyState)){var o=P.BufferHelper.getBuffered(u);!this.loadedmetadata&&o.length?(this.loadedmetadata=!0,this.seekToStartPos()):s.poll(this.lastCurrentTime),this.lastCurrentTime=u.currentTime}},c.onFragLoadEmergencyAborted=function(){this.state=D.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},c.onBufferFlushed=function(u,s){var o=s.type;if(o!==m.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(o===m.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,o,A.PlaylistLevelType.MAIN)}},c.onLevelsUpdated=function(u,s){this.levels=s.levels},c.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},c.seekToStartPos=function(){var u=this.media,s=u.currentTime,o=this.startPosition;if(o>=0&&s<o){if(u.seeking){v.logger.log("could not seek to "+o+", already seeking at "+s);return}var d=P.BufferHelper.getBuffered(u),g=d.length?d.start(0):0,S=g-o;S>0&&(S<this.config.maxBufferHole||S<this.config.maxFragLookUpTolerance)&&(v.logger.log("adjusting start position by "+S+" to match buffer start"),o+=S,this.startPosition=o),this.log("seek to target start position "+o+" from current time "+s),u.currentTime=o}},c._getAudioCodec=function(u){var s=this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s},c._loadBitrateTestFrag=function(u){var s=this;this._doFragLoad(u).then(function(o){var d=s.hls;if(!(!o||d.nextLoadLevel||s.fragContextChanged(u))){s.fragLoadError=0,s.state=D.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var g=u.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),d.trigger(b.Events.FRAG_LOADED,o)}})},c._handleTransmuxComplete=function(u){var s,o="main",d=this.hls,g=u.remuxResult,S=u.chunkMeta,R=this.getCurrentContext(S);if(!R){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(S.level);return}var I=R.frag,_=R.part,B=R.level,F=g.video,U=g.text,w=g.id3,K=g.initSegment,H=this.altAudio?void 0:g.audio;if(!this.fragContextChanged(I)){if(this.state=D.State.PARSING,K){K.tracks&&(this._bufferInitSegment(B,K.tracks,I,S),d.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:o,tracks:K.tracks}));var j=K.initPTS,Y=K.timescale;Object(M.isFiniteNumber)(j)&&(this.initPTS[I.cc]=j,d.trigger(b.Events.INIT_PTS_FOUND,{frag:I,id:o,initPTS:j,timescale:Y}))}if(F&&g.independent!==!1){if(B.details){var z=F.startPTS,V=F.endPTS,Q=F.startDTS,X=F.endDTS;if(_)_.elementaryStreams[F.type]={startPTS:z,endPTS:V,startDTS:Q,endDTS:X};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var $=this.getLoadPosition()+this.config.maxBufferHole;if($<z){this.backtrack(I);return}I.setElementaryStreamInfo(F.type,I.start,V,I.start,X,!0)}I.setElementaryStreamInfo(F.type,z,V,Q,X),this.bufferFragmentData(F,I,_,S)}}else if(g.independent===!1){this.backtrack(I);return}if(H){var Z=H.startPTS,J=H.endPTS,q=H.startDTS,ee=H.endDTS;_&&(_.elementaryStreams[m.ElementaryStreamTypes.AUDIO]={startPTS:Z,endPTS:J,startDTS:q,endDTS:ee}),I.setElementaryStreamInfo(m.ElementaryStreamTypes.AUDIO,Z,J,q,ee),this.bufferFragmentData(H,I,_,S)}if(w!=null&&(s=w.samples)!==null&&s!==void 0&&s.length){var ie={frag:I,id:o,samples:w.samples};d.trigger(b.Events.FRAG_PARSING_METADATA,ie)}if(U){var te={frag:I,id:o,samples:U.samples};d.trigger(b.Events.FRAG_PARSING_USERDATA,te)}}},c._bufferInitSegment=function(u,s,o,d){var g=this;if(this.state===D.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var S=s.audio,R=s.video,I=s.audiovideo;if(S){var _=u.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(_&&(_.indexOf("mp4a.40.5")!==-1?_="mp4a.40.2":_="mp4a.40.5"),S.metadata.channelCount!==1&&B.indexOf("firefox")===-1&&(_="mp4a.40.5")),B.indexOf("android")!==-1&&S.container!=="audio/mpeg"&&(_="mp4a.40.2",this.log("Android: force audio codec to "+_)),u.audioCodec&&u.audioCodec!==_&&this.log('Swapping manifest audio codec "'+u.audioCodec+'" for "'+_+'"'),S.levelCodec=_,S.id="main",this.log("Init audio buffer, container:"+S.container+", codecs[selected/level/parsed]=["+(_||"")+"/"+(u.audioCodec||"")+"/"+S.codec+"]")}R&&(R.levelCodec=u.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(u.videoCodec||"")+"/"+R.codec+"]")),I&&this.log("Init audiovideo buffer, container:"+I.container+", codecs[level/parsed]=["+(u.attrs.CODECS||"")+"/"+I.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(F){var U=s[F],w=U.initSegment;w!=null&&w.byteLength&&g.hls.trigger(b.Events.BUFFER_APPENDING,{type:F,data:w,frag:o,part:null,chunkMeta:d,parent:o.type})}),this.tick()}},c.backtrack=function(u){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(u);var s=this.fragmentTracker.backtrack(u);this.fragPrevious=null,this.nextLoadPosition=u.start,s?this.resetFragmentLoading(u):this.state=D.State.BACKTRACKING},c.checkFragmentChanged=function(){var u=this.media,s=null;if(u&&u.readyState>1&&u.seeking===!1){var o=u.currentTime;if(P.BufferHelper.isBuffered(u,o)?s=this.getAppendedFrag(o):P.BufferHelper.isBuffered(u,o+.1)&&(s=this.getAppendedFrag(o+.1)),s){var d=this.fragPlaying,g=s.level;(!d||s.sn!==d.sn||d.level!==g||s.urlId!==d.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:s}),(!d||d.level!==g)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:g}),this.fragPlaying=s)}}},e(l,[{key:"nextLevel",get:function(){var u=this.nextBufferedFrag;return u?u.level:-1}},{key:"currentLevel",get:function(){var u=this.media;if(u){var s=this.getAppendedFrag(u.currentTime);if(s)return s.level}return-1}},{key:"nextBufferedFrag",get:function(){var u=this.media;if(u){var s=this.getAppendedFrag(u.currentTime);return this.followingBufferedFrag(s)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),l}(D.default)},"./src/controller/subtitle-stream-controller.ts":function(k,C,p){p.r(C),p.d(C,"SubtitleStreamController",function(){return e});var M=p("./src/events.ts"),D=p("./src/utils/buffer-helper.ts"),L=p("./src/controller/fragment-finders.ts"),b=p("./src/utils/discontinuities.ts"),P=p("./src/controller/level-helper.ts"),O=p("./src/controller/fragment-tracker.ts"),A=p("./src/controller/base-stream-controller.ts"),m=p("./src/types/loader.ts"),x=p("./src/types/level.ts");function y(r,t){for(var f=0;f<t.length;f++){var a=t[f];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,a.key,a)}}function T(r,t,f){return t&&y(r.prototype,t),f&&y(r,f),r}function E(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,v(r,t)}function v(r,t){return v=Object.setPrototypeOf||function(a,i){return a.__proto__=i,a},v(r,t)}var n=500,e=function(r){E(t,r);function t(a,i){var l;return l=r.call(this,a,i,"[subtitle-stream-controller]")||this,l.levels=[],l.currentTrackId=-1,l.tracksBuffered=[],l.mainDetails=null,l._registerListeners(),l}var f=t.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var i=this.hls;i.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(M.Events.ERROR,this.onError,this),i.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f._unregisterListeners=function(){var i=this.hls;i.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(M.Events.ERROR,this.onError,this),i.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(n),this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},f.onLevelLoaded=function(i,l){this.mainDetails=l.details},f.onSubtitleFragProcessed=function(i,l){var c=l.frag,h=l.success;if(this.fragPrevious=c,this.state=A.State.IDLE,!!h){var u=this.tracksBuffered[this.currentTrackId];if(!!u){for(var s,o=c.start,d=0;d<u.length;d++)if(o>=u[d].start&&o<=u[d].end){s=u[d];break}var g=c.start+c.duration;s?s.end=g:(s={start:o,end:g},u.push(s)),this.fragmentTracker.fragBuffered(c)}}},f.onBufferFlushing=function(i,l){var c=l.startOffset,h=l.endOffset;if(c===0&&h!==Number.POSITIVE_INFINITY){var u=this.currentTrackId,s=this.levels;if(!s.length||!s[u]||!s[u].details)return;var o=s[u].details,d=o.targetduration,g=h-d;if(g<=0)return;l.endOffsetSubtitles=Math.max(0,g),this.tracksBuffered.forEach(function(S){for(var R=0;R<S.length;){if(S[R].end<=g){S.shift();continue}else if(S[R].start<g)S[R].start=g;else break;R++}}),this.fragmentTracker.removeFragmentsInRange(c,g,m.PlaylistLevelType.SUBTITLE)}},f.onError=function(i,l){var c,h=l.frag;!h||h.type!==m.PlaylistLevelType.SUBTITLE||((c=this.fragCurrent)!==null&&c!==void 0&&c.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},f.onSubtitleTracksUpdated=function(i,l){var c=this,h=l.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(u){return new x.Level(u)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(u){c.tracksBuffered[u.id]=[]}),this.mediaBuffer=null},f.onSubtitleTrackSwitch=function(i,l){if(this.currentTrackId=l.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var c=this.levels[this.currentTrackId];c!=null&&c.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,c&&this.setInterval(n)},f.onSubtitleTrackLoaded=function(i,l){var c,h=l.details,u=l.id,s=this.currentTrackId,o=this.levels;if(!!o.length){var d=o[s];if(!(u>=o.length||u!==s||!d)){if(this.mediaBuffer=this.mediaBufferTimeRanges,h.live||(c=d.details)!==null&&c!==void 0&&c.live){var g=this.mainDetails;if(h.deltaUpdateFailed||!g)return;var S=g.fragments[0];if(!d.details)h.hasProgramDateTime&&g.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(h,g):S&&Object(P.addSliding)(h,S.start);else{var R=this.alignPlaylists(h,d.details);R===0&&S&&Object(P.addSliding)(h,S.start)}}if(d.details=h,this.levelLastLoaded=u,this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE){var I=Object(L.findFragmentByPTS)(null,h.fragments,this.media.currentTime,0);I||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)}}}},f._handleFragmentLoadComplete=function(i){var l=i.frag,c=i.payload,h=l.decryptdata,u=this.hls;if(!this.fragContextChanged(l)&&c&&c.byteLength>0&&h&&h.key&&h.iv&&h.method==="AES-128"){var s=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(c),h.key.buffer,h.iv.buffer).then(function(o){var d=performance.now();u.trigger(M.Events.FRAG_DECRYPTED,{frag:l,payload:o,stats:{tstart:s,tdecrypt:d}})})}},f.doTick=function(){if(!this.media){this.state=A.State.IDLE;return}if(this.state===A.State.IDLE){var i,l=this.currentTrackId,c=this.levels;if(!c.length||!c[l]||!c[l].details)return;var h=c[l].details,u=h.targetduration,s=this.config,o=this.media,d=D.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,o.currentTime-u,s.maxBufferHole),g=d.end,S=d.len,R=this.getMaxBufferLength()+u;if(S>R)return;console.assert(h,"Subtitle track details are defined on idle subtitle stream controller tick");var I=h.fragments,_=I.length,B=h.edge,F,U=this.fragPrevious;if(g<B){var w=s.maxFragLookUpTolerance;F=Object(L.findFragmentByPTS)(U,I,g,w),!F&&U&&U.start<I[0].start&&(F=I[0])}else F=I[_-1];(i=F)!==null&&i!==void 0&&i.encrypted?this.loadKey(F,h):F&&this.fragmentTracker.getState(F)===O.FragmentState.NOT_LOADED&&this.loadFragment(F,h,g)}},f.loadFragment=function(i,l,c){this.fragCurrent=i,r.prototype.loadFragment.call(this,i,l,c)},T(t,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),t}(A.default)},"./src/controller/subtitle-track-controller.ts":function(k,C,p){p.r(C);var M=p("./src/events.ts"),D=p("./src/utils/texttrack-utils.ts"),L=p("./src/controller/base-playlist-controller.ts"),b=p("./src/types/loader.ts");function P(T,E){for(var v=0;v<E.length;v++){var n=E[v];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(T,n.key,n)}}function O(T,E,v){return E&&P(T.prototype,E),v&&P(T,v),T}function A(T,E){T.prototype=Object.create(E.prototype),T.prototype.constructor=T,m(T,E)}function m(T,E){return m=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n},m(T,E)}var x=function(T){A(E,T);function E(n){var e;return e=T.call(this,n,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}var v=E.prototype;return v.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,T.prototype.destroy.call(this)},v.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.Events.ERROR,this.onError,this)},v.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.Events.ERROR,this.onError,this)},v.onMediaAttached=function(e,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},v.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},v.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=y(this.media.textTracks);e.forEach(function(r){Object(D.clearCurrentCues)(r)}),this.subtitleTrack=-1,this.media=null}},v.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},v.onManifestParsed=function(e,r){this.tracks=r.subtitleTracks},v.onSubtitleTrackLoaded=function(e,r){var t=r.id,f=r.details,a=this.trackId,i=this.tracksInGroup[a];if(!i){this.warn("Invalid subtitle track id "+t);return}var l=i.details;i.details=r.details,this.log("subtitle track "+t+" loaded ["+f.startSN+"-"+f.endSN+"]"),t===this.trackId&&(this.retryCount=0,this.playlistLoaded(t,r,l))},v.onLevelLoading=function(e,r){this.switchLevel(r.level)},v.onLevelSwitching=function(e,r){this.switchLevel(r.level)},v.switchLevel=function(e){var r=this.hls.levels[e];if(!!(r!=null&&r.textGroupIds)){var t=r.textGroupIds[r.urlId];if(this.groupId!==t){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter(function(c){return!t||c.groupId===t});this.tracksInGroup=a;var i=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=t;var l={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+t+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,l),i!==-1&&this.setSubtitleTrack(i,f)}}},v.findTrackId=function(e){for(var r=this.tracksInGroup,t=0;t<r.length;t++){var f=r[t];if((!this.selectDefaultTrack||f.default)&&(!e||e===f.name))return f.id}return-1},v.onError=function(e,r){T.prototype.onError.call(this,e,r),!(r.fatal||!r.context)&&r.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},v.loadPlaylist=function(e){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var t=r.id,f=r.groupId,a=r.url;if(e)try{a=e.addDirectives(a)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Loading subtitle playlist for id "+t),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:a,id:t,groupId:f,deliveryDirectives:e||null})}},v.toggleTrackModes=function(e){var r=this,t=this.media,f=this.subtitleDisplay,a=this.trackId;if(!!t){var i=y(t.textTracks),l=i.filter(function(u){return u.groupId===r.groupId});if(e===-1)[].slice.call(i).forEach(function(u){u.mode="disabled"});else{var c=l[a];c&&(c.mode="disabled")}var h=l[e];h&&(h.mode=f?"showing":"hidden")}},v.setSubtitleTrack=function(e,r){var t,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(t=f[e])!==null&&t!==void 0&&t.details)||e<-1||e>=f.length)){this.clearTimer();var a=f[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,a){var i=a.id,l=a.groupId,c=l===void 0?"":l,h=a.name,u=a.type,s=a.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:i,groupId:c,name:h,type:u,url:s});var o=this.switchParams(a.url,r==null?void 0:r.details);this.loadPlaylist(o)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},v.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,r=y(this.media.textTracks),t=0;t<r.length;t++)if(r[t].mode==="hidden")e=t;else if(r[t].mode==="showing"){e=t;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},O(E,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,r)}}]),E}(L.default);function y(T){for(var E=[],v=0;v<T.length;v++){var n=T[v];n.kind==="subtitles"&&n.label&&E.push(T[v])}return E}C.default=x},"./src/controller/timeline-controller.ts":function(k,C,p){p.r(C),p.d(C,"TimelineController",function(){return y});var M=p("./src/polyfills/number.ts"),D=p("./src/events.ts"),L=p("./src/utils/cea-608-parser.ts"),b=p("./src/utils/output-filter.ts"),P=p("./src/utils/webvtt-parser.ts"),O=p("./src/utils/texttrack-utils.ts"),A=p("./src/utils/imsc1-ttml-parser.ts"),m=p("./src/types/loader.ts"),x=p("./src/utils/logger.ts"),y=function(){function n(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new b.default(this,"textTrack1"),f=new b.default(this,"textTrack2"),a=new b.default(this,"textTrack3"),i=new b.default(this,"textTrack4");this.cea608Parser1=new L.default(1,t,f),this.cea608Parser2=new L.default(3,a,i)}r.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(D.Events.FRAG_LOADING,this.onFragLoading,this),r.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(D.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(D.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(D.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=n.prototype;return e.destroy=function(){var t=this.hls;t.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.Events.FRAG_LOADING,this.onFragLoading,this),t.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(D.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(D.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,f,a,i,l){for(var c=!1,h=l.length;h--;){var u=l[h],s=E(u[0],u[1],f,a);if(s>=0&&(u[0]=Math.min(u[0],f),u[1]=Math.max(u[1],a),c=!0,s/(a-f)>.5))return}if(c||l.push([f,a]),this.config.renderTextTracksNatively){var o=this.captionsTracks[t];this.Cues.newCue(o,f,a,i)}else{var d=this.Cues.newCue(null,f,a,i);this.hls.trigger(D.Events.CUES_PARSED,{type:"captions",cues:d,track:t})}},e.onInitPtsFound=function(t,f){var a=this,i=f.frag,l=f.id,c=f.initPTS,h=f.timescale,u=this.unparsedVttFrags;l==="main"&&(this.initPTS[i.cc]=c,this.timescale[i.cc]=h),u.length&&(this.unparsedVttFrags=[],u.forEach(function(s){a.onFragLoaded(D.Events.FRAG_LOADED,s)}))},e.getExistingTrack=function(t){var f=this.media;if(f)for(var a=0;a<f.textTracks.length;a++){var i=f.textTracks[a];if(i[t])return i}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var f=this.captionsProperties,a=this.captionsTracks,i=this.media,l=f[t],c=l.label,h=l.languageCode,u=this.getExistingTrack(t);if(u)a[t]=u,Object(O.clearCurrentCues)(a[t]),Object(O.sendAddTrackEvent)(a[t],i);else{var s=this.createTextTrack("captions",c,h);s&&(s[t]=!0,a[t]=s)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var f=this.captionsProperties[t];if(!!f){var a=f.label,i={_id:t,label:a,kind:"captions",default:f.media?!!f.media.default:!1,closedCaptions:f.media};this.nonNativeCaptionsTracks[t]=i,this.hls.trigger(D.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},e.createTextTrack=function(t,f,a){var i=this.media;if(!!i)return i.addTextTrack(t,f,a)},e.onMediaAttaching=function(t,f){this.media=f.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(f){Object(O.clearCurrentCues)(t[f]),delete t[f]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(!!t){var f=t.textTracks;if(f)for(var a=0;a<f.length;a++)Object(O.clearCurrentCues)(f[a])}},e.onSubtitleTracksUpdated=function(t,f){var a=this;this.textTracks=[];var i=f.subtitleTracks||[],l=i.some(function(s){return s.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||l&&this.config.enableIMSC1){var c=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(s,o){var d;if(o<h.length){for(var g=null,S=0;S<h.length;S++)if(T(h[S],s)){g=h[S];break}g&&(d=g)}d?Object(O.clearCurrentCues)(d):(d=a.createTextTrack("subtitles",s.name,s.lang),d&&(d.mode="disabled")),d&&(d.groupId=s.groupId,a.textTracks.push(d))})}else if(!c&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(s){return{label:s.name,kind:s.type.toLowerCase(),default:s.default,subtitleTrack:s}});this.hls.trigger(D.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},e.onManifestLoaded=function(t,f){var a=this;this.config.enableCEA708Captions&&f.captions&&f.captions.forEach(function(i){var l=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!l){var c="textTrack"+l[1],h=a.captionsProperties[c];!h||(h.label=i.name,i.lang&&(h.languageCode=i.lang),h.media=i)}})},e.onFragLoading=function(t,f){var a=this.cea608Parser1,i=this.cea608Parser2,l=this.lastSn,c=this.lastPartIndex;if(!(!this.enabled||!(a&&i))&&f.frag.type===m.PlaylistLevelType.MAIN){var h,u,s=f.frag.sn,o=(h=f==null||(u=f.part)===null||u===void 0?void 0:u.index)!=null?h:-1;s===l+1||s===l&&o===c+1||(a.reset(),i.reset()),this.lastSn=s,this.lastPartIndex=o}},e.onFragLoaded=function(t,f){var a=f.frag,i=f.payload,l=this.initPTS,c=this.unparsedVttFrags;if(a.type===m.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!Object(M.isFiniteNumber)(l[a.cc])){c.push(f),l.length&&this.hls.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")});return}var h=a.decryptdata,u="stats"in f;if(h==null||h.key==null||h.method!=="AES-128"||u){var s=this.tracks[a.level],o=this.vttCCs;o[a.cc]||(o[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),s&&s.textCodec===A.IMSC1_CODEC?this._parseIMSC1(a,i):this._parseVTTs(a,i,o)}}else this.hls.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,f){var a=this,i=this.hls;Object(A.parseIMSC1)(f,this.initPTS[t.cc],this.timescale[t.cc],function(l){a._appendCues(l,t.level),i.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(l){x.logger.log("Failed to parse IMSC1: "+l),i.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:l})})},e._parseVTTs=function(t,f,a){var i=this,l=this.hls;Object(P.parseWebVTT)(f,this.initPTS[t.cc],this.timescale[t.cc],a,t.cc,t.start,function(c){i._appendCues(c,t.level),l.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(c){i._fallbackToIMSC1(t,f),x.logger.log("Failed to parse VTT cue: "+c),l.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:c})})},e._fallbackToIMSC1=function(t,f){var a=this,i=this.tracks[t.level];i.textCodec||Object(A.parseIMSC1)(f,this.initPTS[t.cc],this.timescale[t.cc],function(){i.textCodec=A.IMSC1_CODEC,a._parseIMSC1(t,f)},function(){i.textCodec="wvtt"})},e._appendCues=function(t,f){var a=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[f];if(i.mode==="disabled")return;t.forEach(function(h){return Object(O.addCueToTrack)(i,h)})}else{var l=this.tracks[f],c=l.default?"default":"subtitles"+f;a.trigger(D.Events.CUES_PARSED,{type:"subtitles",cues:t,track:c})}},e.onFragDecrypted=function(t,f){var a=f.frag;if(a.type===m.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[a.cc])){this.unparsedVttFrags.push(f);return}this.onFragLoaded(D.Events.FRAG_LOADED,f)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,f){var a=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(a&&i)))for(var l=0;l<f.samples.length;l++){var c=f.samples[l].bytes;if(c){var h=this.extractCea608Data(c);a.addData(f.samples[l].pts,h[0]),i.addData(f.samples[l].pts,h[1])}}},e.onBufferFlushing=function(t,f){var a=f.startOffset,i=f.endOffset,l=f.endOffsetSubtitles,c=f.type,h=this.media;if(!(!h||h.currentTime<i)){if(!c||c==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(o){return Object(O.removeCuesInRange)(u[o],a,i)})}if(this.config.renderTextTracksNatively&&a===0&&l!==void 0){var s=this.textTracks;Object.keys(s).forEach(function(o){return Object(O.removeCuesInRange)(s[o],a,l)})}}},e.extractCea608Data=function(t){for(var f=t[0]&31,a=2,i=[[],[]],l=0;l<f;l++){var c=t[a++],h=127&t[a++],u=127&t[a++],s=(4&c)!==0,o=3&c;h===0&&u===0||s&&(o===0||o===1)&&(i[o].push(h),i[o].push(u))}return i},n}();function T(n,e){return n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function E(n,e,r,t){return Math.min(e,t)-Math.max(n,r)}function v(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return M});var M=function(){function D(b,P){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=P}var L=D.prototype;return L.decrypt=function(P,O){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},O,P)},D}()},"./src/crypt/aes-decryptor.ts":function(k,C,p){p.r(C),p.d(C,"removePadding",function(){return D}),p.d(C,"default",function(){return L});var M=p("./src/utils/typed-array.ts");function D(b){var P=b.byteLength,O=P&&new DataView(b.buffer).getUint8(P-1);return O?Object(M.sliceUint8)(b,0,P-O):b}var L=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var P=b.prototype;return P.uint8ArrayToUint32Array_=function(A){for(var m=new DataView(A),x=new Uint32Array(4),y=0;y<4;y++)x[y]=m.getUint32(y*4);return x},P.initTable=function(){var A=this.sBox,m=this.invSBox,x=this.subMix,y=x[0],T=x[1],E=x[2],v=x[3],n=this.invSubMix,e=n[0],r=n[1],t=n[2],f=n[3],a=new Uint32Array(256),i=0,l=0,c=0;for(c=0;c<256;c++)c<128?a[c]=c<<1:a[c]=c<<1^283;for(c=0;c<256;c++){var h=l^l<<1^l<<2^l<<3^l<<4;h=h>>>8^h&255^99,A[i]=h,m[h]=i;var u=a[i],s=a[u],o=a[s],d=a[h]*257^h*16843008;y[i]=d<<24|d>>>8,T[i]=d<<16|d>>>16,E[i]=d<<8|d>>>24,v[i]=d,d=o*16843009^s*65537^u*257^i*16843008,e[h]=d<<24|d>>>8,r[h]=d<<16|d>>>16,t[h]=d<<8|d>>>24,f[h]=d,i?(i=u^a[a[a[o^u]]],l^=a[a[l]]):i=l=1}},P.expandKey=function(A){for(var m=this.uint8ArrayToUint32Array_(A),x=!0,y=0;y<m.length&&x;)x=m[y]===this.key[y],y++;if(!x){this.key=m;var T=this.keySize=m.length;if(T!==4&&T!==6&&T!==8)throw new Error("Invalid aes key size="+T);var E=this.ksRows=(T+6+1)*4,v,n,e=this.keySchedule=new Uint32Array(E),r=this.invKeySchedule=new Uint32Array(E),t=this.sBox,f=this.rcon,a=this.invSubMix,i=a[0],l=a[1],c=a[2],h=a[3],u,s;for(v=0;v<E;v++){if(v<T){u=e[v]=m[v];continue}s=u,v%T===0?(s=s<<8|s>>>24,s=t[s>>>24]<<24|t[s>>>16&255]<<16|t[s>>>8&255]<<8|t[s&255],s^=f[v/T|0]<<24):T>6&&v%T===4&&(s=t[s>>>24]<<24|t[s>>>16&255]<<16|t[s>>>8&255]<<8|t[s&255]),e[v]=u=(e[v-T]^s)>>>0}for(n=0;n<E;n++)v=E-n,n&3?s=e[v]:s=e[v-4],n<4||v<=4?r[n]=s:r[n]=i[t[s>>>24]]^l[t[s>>>16&255]]^c[t[s>>>8&255]]^h[t[s&255]],r[n]=r[n]>>>0}},P.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},P.decrypt=function(A,m,x){for(var y=this.keySize+6,T=this.invKeySchedule,E=this.invSBox,v=this.invSubMix,n=v[0],e=v[1],r=v[2],t=v[3],f=this.uint8ArrayToUint32Array_(x),a=f[0],i=f[1],l=f[2],c=f[3],h=new Int32Array(A),u=new Int32Array(h.length),s,o,d,g,S,R,I,_,B,F,U,w,K,H,j=this.networkToHostOrderSwap;m<h.length;){for(B=j(h[m]),F=j(h[m+1]),U=j(h[m+2]),w=j(h[m+3]),S=B^T[0],R=w^T[1],I=U^T[2],_=F^T[3],K=4,H=1;H<y;H++)s=n[S>>>24]^e[R>>16&255]^r[I>>8&255]^t[_&255]^T[K],o=n[R>>>24]^e[I>>16&255]^r[_>>8&255]^t[S&255]^T[K+1],d=n[I>>>24]^e[_>>16&255]^r[S>>8&255]^t[R&255]^T[K+2],g=n[_>>>24]^e[S>>16&255]^r[R>>8&255]^t[I&255]^T[K+3],S=s,R=o,I=d,_=g,K=K+4;s=E[S>>>24]<<24^E[R>>16&255]<<16^E[I>>8&255]<<8^E[_&255]^T[K],o=E[R>>>24]<<24^E[I>>16&255]<<16^E[_>>8&255]<<8^E[S&255]^T[K+1],d=E[I>>>24]<<24^E[_>>16&255]<<16^E[S>>8&255]<<8^E[R&255]^T[K+2],g=E[_>>>24]<<24^E[S>>16&255]<<16^E[R>>8&255]<<8^E[I&255]^T[K+3],u[m]=j(s^a),u[m+1]=j(g^i),u[m+2]=j(d^l),u[m+3]=j(o^c),a=B,i=F,l=U,c=w,m=m+4}return u.buffer},b}()},"./src/crypt/decrypter.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return m});var M=p("./src/crypt/aes-crypto.ts"),D=p("./src/crypt/fast-aes-key.ts"),L=p("./src/crypt/aes-decryptor.ts"),b=p("./src/utils/logger.ts"),P=p("./src/utils/mp4-tools.ts"),O=p("./src/utils/typed-array.ts"),A=16,m=function(){function x(T,E,v){var n=v===void 0?{}:v,e=n.removePKCS7Padding,r=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=T,this.config=E,this.removePKCS7Padding=r,r)try{var t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=x.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var E=this.currentResult;if(!E){this.reset();return}var v=new Uint8Array(E);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(v):v},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(E,v,n,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(E),v,n);var r=this.flush();r&&e(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(E),v,n).then(e)},y.softwareDecrypt=function(E,v,n){var e=this.currentIV,r=this.currentResult,t=this.remainderData;this.logOnce("JS AES decrypt"),t&&(E=Object(P.appendUint8Array)(t,E),this.remainderData=null);var f=this.getValidChunk(E);if(!f.length)return null;e&&(n=e);var a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new L.default),a.expandKey(v);var i=r;return this.currentResult=a.decrypt(f.buffer,0,n),this.currentIV=Object(O.sliceUint8)(f,-16).buffer,i||null},y.webCryptoDecrypt=function(E,v,n){var e=this,r=this.subtle;return(this.key!==v||!this.fastAesKey)&&(this.key=v,this.fastAesKey=new D.default(r,v)),this.fastAesKey.expandKey().then(function(t){if(!r)return Promise.reject(new Error("web crypto not initialized"));var f=new M.default(r,n);return f.decrypt(E.buffer,t)}).catch(function(t){return e.onWebCryptoError(t,E,v,n)})},y.onWebCryptoError=function(E,v,n,e){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",E),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(v,n,e)},y.getValidChunk=function(E){var v=E,n=E.length-E.length%A;return n!==E.length&&(v=Object(O.sliceUint8)(E,0,n),this.remainderData=Object(O.sliceUint8)(E,n)),v},y.logOnce=function(E){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+E),this.logEnabled=!1)},x}()},"./src/crypt/fast-aes-key.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return M});var M=function(){function D(b,P){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=P}var L=D.prototype;return L.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},D}()},"./src/demux/aacdemuxer.ts":function(k,C,p){p.r(C);var M=p("./src/demux/base-audio-demuxer.ts"),D=p("./src/demux/adts.ts"),L=p("./src/utils/logger.ts"),b=p("./src/demux/id3.ts");function P(m,x){m.prototype=Object.create(x.prototype),m.prototype.constructor=m,O(m,x)}function O(m,x){return O=Object.setPrototypeOf||function(T,E){return T.__proto__=E,T},O(m,x)}var A=function(m){P(x,m);function x(T,E){var v;return v=m.call(this)||this,v.observer=void 0,v.config=void 0,v.observer=T,v.config=E,v}var y=x.prototype;return y.resetInitSegment=function(E,v,n){m.prototype.resetInitSegment.call(this,E,v,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:E,duration:n,inputTimeScale:9e4,dropped:0}},x.probe=function(E){if(!E)return!1;for(var v=b.getID3Data(E,0)||[],n=v.length,e=E.length;n<e;n++)if(D.probe(E,n))return L.logger.log("ADTS sync word found !"),!0;return!1},y.canParse=function(E,v){return D.canParse(E,v)},y.appendFrame=function(E,v,n){D.initTrackConfig(E,this.observer,v,n,E.manifestCodec);var e=D.appendFrame(E,v,n,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},x}(M.default);A.minProbeByteLength=9,C.default=A},"./src/demux/adts.ts":function(k,C,p){p.r(C),p.d(C,"getAudioConfig",function(){return b}),p.d(C,"isHeaderPattern",function(){return P}),p.d(C,"getHeaderLength",function(){return O}),p.d(C,"getFullFrameLength",function(){return A}),p.d(C,"canGetFrameLength",function(){return m}),p.d(C,"isHeader",function(){return x}),p.d(C,"canParse",function(){return y}),p.d(C,"probe",function(){return T}),p.d(C,"initTrackConfig",function(){return E}),p.d(C,"getFrameDuration",function(){return v}),p.d(C,"parseFrameHeader",function(){return n}),p.d(C,"appendFrame",function(){return e});var M=p("./src/utils/logger.ts"),D=p("./src/errors.ts"),L=p("./src/events.ts");function b(r,t,f,a){var i,l,c,h,u=navigator.userAgent.toLowerCase(),s=a,o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((t[f+2]&192)>>>6)+1;var d=(t[f+2]&60)>>>2;if(d>o.length-1){r.trigger(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d});return}return c=(t[f+2]&1)<<2,c|=(t[f+3]&192)>>>6,M.logger.log("manifest codec:"+a+", ADTS type:"+i+", samplingIndex:"+d),/firefox/i.test(u)?d>=6?(i=5,h=new Array(4),l=d-3):(i=2,h=new Array(2),l=d):u.indexOf("android")!==-1?(i=2,h=new Array(2),l=d):(i=5,h=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&d>=6?l=d-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(d>=6&&c===1||/vivaldi/i.test(u))||!a&&c===1)&&(i=2,h=new Array(2)),l=d)),h[0]=i<<3,h[0]|=(d&14)>>1,h[1]|=(d&1)<<7,h[1]|=c<<3,i===5&&(h[1]|=(l&14)>>1,h[2]=(l&1)<<7,h[2]|=2<<2,h[3]=0),{config:h,samplerate:o[d],channelCount:c,codec:"mp4a.40."+i,manifestCodec:s}}function P(r,t){return r[t]===255&&(r[t+1]&246)===240}function O(r,t){return r[t+1]&1?7:9}function A(r,t){return(r[t+3]&3)<<11|r[t+4]<<3|(r[t+5]&224)>>>5}function m(r,t){return t+5<r.length}function x(r,t){return t+1<r.length&&P(r,t)}function y(r,t){return m(r,t)&&P(r,t)&&A(r,t)<=r.length-t}function T(r,t){if(x(r,t)){var f=O(r,t);if(t+f>=r.length)return!1;var a=A(r,t);if(a<=f)return!1;var i=t+a;return i===r.length||x(r,i)}return!1}function E(r,t,f,a,i){if(!r.samplerate){var l=b(t,f,a,i);if(!l)return;r.config=l.config,r.samplerate=l.samplerate,r.channelCount=l.channelCount,r.codec=l.codec,r.manifestCodec=l.manifestCodec,M.logger.log("parsed codec:"+r.codec+", rate:"+l.samplerate+", channels:"+l.channelCount)}}function v(r){return 1024*9e4/r}function n(r,t,f,a,i){var l=O(r,t),c=A(r,t);if(c-=l,c>0){var h=f+a*i;return{headerLength:l,frameLength:c,stamp:h}}}function e(r,t,f,a,i){var l=v(r.samplerate),c=n(t,f,a,i,l);if(c){var h=c.frameLength,u=c.headerLength,s=c.stamp,o=u+h,d=Math.max(0,f+o-t.length),g;d?(g=new Uint8Array(o-u),g.set(t.subarray(f+u,t.length),0)):g=t.subarray(f+u,f+o);var S={unit:g,pts:s};return d||r.samples.push(S),{sample:S,length:o,missing:d}}}},"./src/demux/base-audio-demuxer.ts":function(k,C,p){p.r(C),p.d(C,"initPTSFn",function(){return A});var M=p("./src/polyfills/number.ts"),D=p("./src/demux/id3.ts"),L=p("./src/demux/dummy-demuxed-track.ts"),b=p("./src/utils/mp4-tools.ts"),P=p("./src/utils/typed-array.ts"),O=function(){function m(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var x=m.prototype;return x.resetInitSegment=function(T,E,v){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},x.resetTimeStamp=function(){},x.resetContiguity=function(){},x.canParse=function(T,E){return!1},x.appendFrame=function(T,E,v){},x.demux=function(T,E){this.cachedData&&(T=Object(b.appendUint8Array)(this.cachedData,T),this.cachedData=null);var v=D.getID3Data(T,0),n=v?v.length:0,e,r,t=this._audioTrack,f=this._id3Track,a=v?D.getTimeStamp(v):void 0,i=T.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=A(a,E)),v&&v.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:v}),r=this.initPTS;n<i;){if(this.canParse(T,n)){var l=this.appendFrame(t,T,n);l?(this.frameIndex++,r=l.sample.pts,n+=l.length,e=n):n=i}else D.canParse(T,n)?(v=D.getID3Data(T,n),f.samples.push({pts:r,dts:r,data:v}),n+=v.length,e=n):n++;if(n===i&&e!==i){var c=Object(P.sliceUint8)(T,e);this.cachedData?this.cachedData=Object(b.appendUint8Array)(this.cachedData,c):this.cachedData=c}}return{audioTrack:t,avcTrack:Object(L.dummyTrack)(),id3Track:f,textTrack:Object(L.dummyTrack)()}},x.demuxSampleAes=function(T,E,v){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},x.flush=function(T){var E=this.cachedData;return E&&(this.cachedData=null,this.demux(E,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},x.destroy=function(){},m}(),A=function(x,y){return Object(M.isFiniteNumber)(x)?x*90:y*9e4};C.default=O},"./src/demux/chunk-cache.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return M});var M=function(){function L(){this.chunks=[],this.dataLength=0}var b=L.prototype;return b.push=function(O){this.chunks.push(O),this.dataLength+=O.length},b.flush=function(){var O=this.chunks,A=this.dataLength,m;if(O.length)O.length===1?m=O[0]:m=D(O,A);else return new Uint8Array(0);return this.reset(),m},b.reset=function(){this.chunks.length=0,this.dataLength=0},L}();function D(L,b){for(var P=new Uint8Array(b),O=0,A=0;A<L.length;A++){var m=L[A];P.set(m,O),O+=m.length}return P}},"./src/demux/dummy-demuxed-track.ts":function(k,C,p){p.r(C),p.d(C,"dummyTrack",function(){return M});function M(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(k,C,p){p.r(C);var M=p("./src/utils/logger.ts"),D=function(){function L(P){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=P,this.bytesAvailable=P.byteLength,this.word=0,this.bitsAvailable=0}var b=L.prototype;return b.loadWord=function(){var O=this.data,A=this.bytesAvailable,m=O.byteLength-A,x=new Uint8Array(4),y=Math.min(4,A);if(y===0)throw new Error("no bytes available");x.set(O.subarray(m,m+y)),this.word=new DataView(x.buffer).getUint32(0),this.bitsAvailable=y*8,this.bytesAvailable-=y},b.skipBits=function(O){var A;this.bitsAvailable>O?(this.word<<=O,this.bitsAvailable-=O):(O-=this.bitsAvailable,A=O>>3,O-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=O,this.bitsAvailable-=O)},b.readBits=function(O){var A=Math.min(this.bitsAvailable,O),m=this.word>>>32-A;return O>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=O-A,A>0&&this.bitsAvailable?m<<A|this.readBits(A):m},b.skipLZ=function(){var O;for(O=0;O<this.bitsAvailable;++O)if((this.word&2147483648>>>O)!==0)return this.word<<=O,this.bitsAvailable-=O,O;return this.loadWord(),O+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var O=this.skipLZ();return this.readBits(O+1)-1},b.readEG=function(){var O=this.readUEG();return 1&O?1+O>>>1:-1*(O>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(O){for(var A=8,m=8,x,y=0;y<O;y++)m!==0&&(x=this.readEG(),m=(A+x+256)%256),A=m===0?A:m},b.readSPS=function(){var O=0,A=0,m=0,x=0,y,T,E,v=this.readUByte.bind(this),n=this.readBits.bind(this),e=this.readUEG.bind(this),r=this.readBoolean.bind(this),t=this.skipBits.bind(this),f=this.skipEG.bind(this),a=this.skipUEG.bind(this),i=this.skipScalingList.bind(this);v();var l=v();if(n(5),t(3),v(),a(),l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128){var c=e();if(c===3&&t(1),a(),a(),t(1),r())for(T=c!==3?8:12,E=0;E<T;E++)r()&&(E<6?i(16):i(64))}a();var h=e();if(h===0)e();else if(h===1)for(t(1),f(),f(),y=e(),E=0;E<y;E++)f();a(),t(1);var u=e(),s=e(),o=n(1);o===0&&t(1),t(1),r()&&(O=e(),A=e(),m=e(),x=e());var d=[1,1];if(r()&&r()){var g=v();switch(g){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:{d=[v()<<8|v(),v()<<8|v()];break}}}return{width:Math.ceil((u+1)*16-O*2-A*2),height:(2-o)*(s+1)*16-(o?2:4)*(m+x),pixelRatio:d}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();C.default=D},"./src/demux/id3.ts":function(k,C,p){p.r(C),p.d(C,"isHeader",function(){return M}),p.d(C,"isFooter",function(){return D}),p.d(C,"getID3Data",function(){return L}),p.d(C,"canParse",function(){return P}),p.d(C,"getTimeStamp",function(){return O}),p.d(C,"isTimeStampFrame",function(){return A}),p.d(C,"getID3Frames",function(){return x}),p.d(C,"decodeFrame",function(){return y}),p.d(C,"utf8ArrayToStr",function(){return e}),p.d(C,"testables",function(){return r});var M=function(i,l){return l+10<=i.length&&i[l]===73&&i[l+1]===68&&i[l+2]===51&&i[l+3]<255&&i[l+4]<255&&i[l+6]<128&&i[l+7]<128&&i[l+8]<128&&i[l+9]<128},D=function(i,l){return l+10<=i.length&&i[l]===51&&i[l+1]===68&&i[l+2]===73&&i[l+3]<255&&i[l+4]<255&&i[l+6]<128&&i[l+7]<128&&i[l+8]<128&&i[l+9]<128},L=function(i,l){for(var c=l,h=0;M(i,l);){h+=10;var u=b(i,l+6);h+=u,D(i,l+10)&&(h+=10),l+=h}if(h>0)return i.subarray(c,c+h)},b=function(i,l){var c=0;return c=(i[l]&127)<<21,c|=(i[l+1]&127)<<14,c|=(i[l+2]&127)<<7,c|=i[l+3]&127,c},P=function(i,l){return M(i,l)&&b(i,l+6)+10<=i.length-l},O=function(i){for(var l=x(i),c=0;c<l.length;c++){var h=l[c];if(A(h))return n(h)}},A=function(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"},m=function(i){var l=String.fromCharCode(i[0],i[1],i[2],i[3]),c=b(i,4),h=10;return{type:l,size:c,data:i.subarray(h,h+c)}},x=function(i){for(var l=0,c=[];M(i,l);){var h=b(i,l+6);l+=10;for(var u=l+h;l+8<u;){var s=m(i.subarray(l)),o=y(s);o&&c.push(o),l+=s.size+10}D(i,l)&&(l+=10)}return c},y=function(i){return i.type==="PRIV"?T(i):i.type[0]==="W"?v(i):E(i)},T=function(i){if(!(i.size<2)){var l=e(i.data,!0),c=new Uint8Array(i.data.subarray(l.length+1));return{key:i.type,info:l,data:c.buffer}}},E=function(i){if(!(i.size<2)){if(i.type==="TXXX"){var l=1,c=e(i.data.subarray(l),!0);l+=c.length+1;var h=e(i.data.subarray(l));return{key:i.type,info:c,data:h}}var u=e(i.data.subarray(1));return{key:i.type,data:u}}},v=function(i){if(i.type==="WXXX"){if(i.size<2)return;var l=1,c=e(i.data.subarray(l),!0);l+=c.length+1;var h=e(i.data.subarray(l));return{key:i.type,info:c,data:h}}var u=e(i.data);return{key:i.type,data:u}},n=function(i){if(i.data.byteLength===8){var l=new Uint8Array(i.data),c=l[3]&1,h=(l[4]<<23)+(l[5]<<15)+(l[6]<<7)+l[7];return h/=45,c&&(h+=4772185884e-2),Math.round(h)}},e=function(i,l){l===void 0&&(l=!1);var c=f();if(c){var h=c.decode(i);if(l){var u=h.indexOf("\0");return u!==-1?h.substring(0,u):h}return h.replace(/\0/g,"")}for(var s=i.length,o,d,g,S="",R=0;R<s;){if(o=i[R++],o===0&&l)return S;if(o===0||o===3)continue;switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(o);break;case 12:case 13:d=i[R++],S+=String.fromCharCode((o&31)<<6|d&63);break;case 14:d=i[R++],g=i[R++],S+=String.fromCharCode((o&15)<<12|(d&63)<<6|(g&63)<<0);break}}return S},r={decodeTextFrame:E},t;function f(){return!t&&typeof self.TextDecoder!="undefined"&&(t=new self.TextDecoder("utf-8")),t}},"./src/demux/mp3demuxer.ts":function(k,C,p){p.r(C);var M=p("./src/demux/base-audio-demuxer.ts"),D=p("./src/demux/id3.ts"),L=p("./src/utils/logger.ts"),b=p("./src/demux/mpegaudio.ts");function P(m,x){m.prototype=Object.create(x.prototype),m.prototype.constructor=m,O(m,x)}function O(m,x){return O=Object.setPrototypeOf||function(T,E){return T.__proto__=E,T},O(m,x)}var A=function(m){P(x,m);function x(){return m.apply(this,arguments)||this}var y=x.prototype;return y.resetInitSegment=function(E,v,n){m.prototype.resetInitSegment.call(this,E,v,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:E,duration:n,inputTimeScale:9e4,dropped:0}},x.probe=function(E){if(!E)return!1;for(var v=D.getID3Data(E,0)||[],n=v.length,e=E.length;n<e;n++)if(b.probe(E,n))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},y.canParse=function(E,v){return b.canParse(E,v)},y.appendFrame=function(E,v,n){if(this.initPTS!==null)return b.appendFrame(E,v,n,this.initPTS,this.frameIndex)},x}(M.default);A.minProbeByteLength=4,C.default=A},"./src/demux/mp4demuxer.ts":function(k,C,p){p.r(C);var M=p("./src/utils/mp4-tools.ts"),D=p("./src/demux/dummy-demuxed-track.ts"),L=function(){function b(O,A){this.remainderData=null,this.config=void 0,this.config=A}var P=b.prototype;return P.resetTimeStamp=function(){},P.resetInitSegment=function(){},P.resetContiguity=function(){},b.probe=function(A){return Object(M.findBox)({data:A,start:0,end:Math.min(A.length,16384)},["moof"]).length>0},P.demux=function(A){var m=A,x=Object(D.dummyTrack)();if(this.config.progressive){this.remainderData&&(m=Object(M.appendUint8Array)(this.remainderData,A));var y=Object(M.segmentValidRange)(m);this.remainderData=y.remainder,x.samples=y.valid||new Uint8Array}else x.samples=m;return{audioTrack:Object(D.dummyTrack)(),avcTrack:x,id3Track:Object(D.dummyTrack)(),textTrack:Object(D.dummyTrack)()}},P.flush=function(){var A=Object(D.dummyTrack)();return A.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(D.dummyTrack)(),avcTrack:A,id3Track:Object(D.dummyTrack)(),textTrack:Object(D.dummyTrack)()}},P.demuxSampleAes=function(A,m,x){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},P.destroy=function(){},b}();L.minProbeByteLength=1024,C.default=L},"./src/demux/mpegaudio.ts":function(k,C,p){p.r(C),p.d(C,"appendFrame",function(){return O}),p.d(C,"parseHeader",function(){return A}),p.d(C,"isHeaderPattern",function(){return m}),p.d(C,"isHeader",function(){return x}),p.d(C,"canParse",function(){return y}),p.d(C,"probe",function(){return T});var M=null,D=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],P=[0,1,1,4];function O(E,v,n,e,r){if(!(n+24>v.length)){var t=A(v,n);if(t&&n+t.frameLength<=v.length){var f=t.samplesPerFrame*9e4/t.sampleRate,a=e+r*f,i={unit:v.subarray(n,n+t.frameLength),pts:a,dts:a};return E.config=[],E.channelCount=t.channelCount,E.samplerate=t.sampleRate,E.samples.push(i),{sample:i,length:t.frameLength,missing:0}}}}function A(E,v){var n=E[v+1]>>3&3,e=E[v+1]>>1&3,r=E[v+2]>>4&15,t=E[v+2]>>2&3;if(n!==1&&r!==0&&r!==15&&t!==3){var f=E[v+2]>>1&1,a=E[v+3]>>6,i=n===3?3-e:e===3?3:4,l=D[i*14+r-1]*1e3,c=n===3?0:n===2?1:2,h=L[c*3+t],u=a===3?1:2,s=b[n][e],o=P[e],d=s*8*o,g=Math.floor(s*l/h+f)*o;if(M===null){var S=navigator.userAgent||"",R=S.match(/Chrome\/(\d+)/i);M=R?parseInt(R[1]):0}var I=!!M&&M<=87;return I&&e===2&&l>=224e3&&a===0&&(E[v+3]=E[v+3]|128),{sampleRate:h,channelCount:u,frameLength:g,samplesPerFrame:d}}}function m(E,v){return E[v]===255&&(E[v+1]&224)===224&&(E[v+1]&6)!==0}function x(E,v){return v+1<E.length&&m(E,v)}function y(E,v){var n=4;return m(E,v)&&n<=E.length-v}function T(E,v){if(v+1<E.length&&m(E,v)){var n=4,e=A(E,v),r=n;e!=null&&e.frameLength&&(r=e.frameLength);var t=v+r;return t===E.length||x(E,t)}return!1}},"./src/demux/sample-aes.ts":function(k,C,p){p.r(C);var M=p("./src/crypt/decrypter.ts"),D=p("./src/demux/tsdemuxer.ts"),L=function(){function b(O,A,m){this.keyData=void 0,this.decrypter=void 0,this.keyData=m,this.decrypter=new M.default(O,A,{removePKCS7Padding:!1})}var P=b.prototype;return P.decryptBuffer=function(A,m){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,m)},P.decryptAacSample=function(A,m,x,y){var T=A[m].unit,E=T.subarray(16,T.length-T.length%16),v=E.buffer.slice(E.byteOffset,E.byteOffset+E.length),n=this;this.decryptBuffer(v,function(e){var r=new Uint8Array(e);T.set(r,16),y||n.decryptAacSamples(A,m+1,x)})},P.decryptAacSamples=function(A,m,x){for(;;m++){if(m>=A.length){x();return}if(!(A[m].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(A,m,x,y),!y)return}}},P.getAvcEncryptedData=function(A){for(var m=Math.floor((A.length-48)/160)*16+16,x=new Int8Array(m),y=0,T=32;T<A.length-16;T+=160,y+=16)x.set(A.subarray(T,T+16),y);return x},P.getAvcDecryptedUnit=function(A,m){for(var x=new Uint8Array(m),y=0,T=32;T<A.length-16;T+=160,y+=16)A.set(x.subarray(y,y+16),T);return A},P.decryptAvcSample=function(A,m,x,y,T,E){var v=Object(D.discardEPB)(T.data),n=this.getAvcEncryptedData(v),e=this;this.decryptBuffer(n.buffer,function(r){T.data=e.getAvcDecryptedUnit(v,r),E||e.decryptAvcSamples(A,m,x+1,y)})},P.decryptAvcSamples=function(A,m,x,y){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;m++,x=0){if(m>=A.length){y();return}for(var T=A[m].units;!(x>=T.length);x++){var E=T[x];if(!(E.data.length<=48||E.type!==1&&E.type!==5)){var v=this.decrypter.isSync();if(this.decryptAvcSample(A,m,x,y,E,v),!v)return}}}},b}();C.default=L},"./src/demux/transmuxer-interface.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return x});var M=p("./node_modules/webworkify-webpack/index.js"),D=p("./src/events.ts"),L=p("./src/demux/transmuxer.ts"),b=p("./src/utils/logger.ts"),P=p("./src/errors.ts"),O=p("./src/utils/mediasource-helper.ts"),A=p("./node_modules/eventemitter3/index.js"),m=Object(O.getMediaSource)()||{isTypeSupported:function(){return!1}},x=function(){function y(E,v,n,e){var r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=E,this.id=v,this.onTransmuxComplete=n,this.onFlush=e;var t=E.config,f=function(h,u){u=u||{},u.frag=r.frag,u.id=r.id,E.trigger(h,u)};this.observer=new A.EventEmitter,this.observer.on(D.Events.FRAG_DECRYPTED,f),this.observer.on(D.Events.ERROR,f);var a={mp4:m.isTypeSupported("video/mp4"),mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"')},i=navigator.vendor;if(t.enableWorker&&typeof Worker!="undefined"){b.logger.log("demuxing in webworker");var l;try{l=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(c){E.trigger(D.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},l.postMessage({cmd:"init",typeSupported:a,vendor:i,id:v,config:JSON.stringify(t)})}catch(c){b.logger.warn("Error in worker:",c),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new L.default(this.observer,a,t,i,v),this.worker=null}}else this.transmuxer=new L.default(this.observer,a,t,i,v)}var T=y.prototype;return T.destroy=function(){var v=this.worker;if(v)v.removeEventListener("message",this.onwmsg),v.terminate(),this.worker=null;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},T.push=function(v,n,e,r,t,f,a,i,l,c){var h,u,s=this;l.transmuxing.start=self.performance.now();var o=this.transmuxer,d=this.worker,g=f?f.start:t.start,S=t.decryptdata,R=this.frag,I=!(R&&t.cc===R.cc),_=!(R&&l.level===R.level),B=R?l.sn-R.sn:-1,F=this.part?l.part-this.part.index:1,U=!_&&(B===1||B===0&&F===1),w=self.performance.now();(_||B||t.stats.parsing.start===0)&&(t.stats.parsing.start=w),f&&(F||!U)&&(f.stats.parsing.start=w);var K=!(R&&((h=t.initSegment)===null||h===void 0?void 0:h.url)===((u=R.initSegment)===null||u===void 0?void 0:u.url)),H=new L.TransmuxState(I,U,i,_,g,K);if(!U||I||K){b.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+I+`
        trackSwitch: `+_+`
        contiguous: `+U+`
        accurateTimeOffset: `+i+`
        timeOffset: `+g+`
        initSegmentChange: `+K);var j=new L.TransmuxConfig(e,r,n,a,c);this.configureTransmuxer(j)}if(this.frag=t,this.part=f,d)d.postMessage({cmd:"demux",data:v,decryptdata:S,chunkMeta:l,state:H},v instanceof ArrayBuffer?[v]:[]);else if(o){var Y=o.push(v,S,l,H);Object(L.isPromise)(Y)?Y.then(function(z){s.handleTransmuxComplete(z)}):this.handleTransmuxComplete(Y)}},T.flush=function(v){var n=this;v.transmuxing.start=self.performance.now();var e=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:v});else if(e){var t=e.flush(v);Object(L.isPromise)(t)?t.then(function(f){n.handleFlushResult(f,v)}):this.handleFlushResult(t,v)}},T.handleFlushResult=function(v,n){var e=this;v.forEach(function(r){e.handleTransmuxComplete(r)}),this.onFlush(n)},T.onWorkerMessage=function(v){var n=v.data,e=this.hls;switch(n.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(n.data);break}case"flush":{this.onFlush(n.data);break}default:{n.data=n.data||{},n.data.frag=this.frag,n.data.id=this.id,e.trigger(n.event,n.data);break}}},T.configureTransmuxer=function(v){var n=this.worker,e=this.transmuxer;n?n.postMessage({cmd:"configure",config:v}):e&&e.configure(v)},T.handleTransmuxComplete=function(v){v.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(v)},y}()},"./src/demux/transmuxer-worker.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return P});var M=p("./src/demux/transmuxer.ts"),D=p("./src/events.ts"),L=p("./src/utils/logger.ts"),b=p("./node_modules/eventemitter3/index.js");function P(y){var T=new b.EventEmitter,E=function(n,e){y.postMessage({event:n,data:e})};T.on(D.Events.FRAG_DECRYPTED,E),T.on(D.Events.ERROR,E),y.addEventListener("message",function(v){var n=v.data;switch(n.cmd){case"init":{var e=JSON.parse(n.config);y.transmuxer=new M.default(T,n.typeSupported,e,n.vendor,n.id),Object(L.enableLogs)(e.debug),E("init",null);break}case"configure":{y.transmuxer.configure(n.config);break}case"demux":{var r=y.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);Object(M.isPromise)(r)?r.then(function(a){O(y,a)}):O(y,r);break}case"flush":{var t=n.chunkMeta,f=y.transmuxer.flush(t);Object(M.isPromise)(f)?f.then(function(a){m(y,a,t)}):m(y,f,t);break}}})}function O(y,T){if(!x(T.remuxResult)){var E=[],v=T.remuxResult,n=v.audio,e=v.video;n&&A(E,n),e&&A(E,e),y.postMessage({event:"transmuxComplete",data:T},E)}}function A(y,T){T.data1&&y.push(T.data1.buffer),T.data2&&y.push(T.data2.buffer)}function m(y,T,E){T.forEach(function(v){O(y,v)}),y.postMessage({event:"flush",data:E})}function x(y){return!y.audio&&!y.video&&!y.text&&!y.id3&&!y.initSegment}},"./src/demux/transmuxer.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return r}),p.d(C,"isPromise",function(){return a}),p.d(C,"TransmuxConfig",function(){return i}),p.d(C,"TransmuxState",function(){return l});var M=p("./src/events.ts"),D=p("./src/errors.ts"),L=p("./src/crypt/decrypter.ts"),b=p("./src/demux/aacdemuxer.ts"),P=p("./src/demux/mp4demuxer.ts"),O=p("./src/demux/tsdemuxer.ts"),A=p("./src/demux/mp3demuxer.ts"),m=p("./src/remux/mp4-remuxer.ts"),x=p("./src/remux/passthrough-remuxer.ts"),y=p("./src/demux/chunk-cache.ts"),T=p("./src/utils/mp4-tools.ts"),E=p("./src/utils/logger.ts"),v;try{v=self.performance.now.bind(self.performance)}catch{E.logger.debug("Unable to use Performance API on this environment"),v=self.Date.now}var n=[{demux:O.default,remux:m.default},{demux:P.default,remux:x.default},{demux:b.default,remux:m.default},{demux:A.default,remux:m.default}],e=1024;n.forEach(function(c){var h=c.demux;e=Math.max(e,h.minProbeByteLength)});var r=function(){function c(u,s,o,d,g){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new y.default,this.observer=u,this.typeSupported=s,this.config=o,this.vendor=d,this.id=g}var h=c.prototype;return h.configure=function(s){this.transmuxConfig=s,this.decrypter&&this.decrypter.reset()},h.push=function(s,o,d,g){var S=this,R=d.transmuxing;R.executeStart=v();var I=new Uint8Array(s),_=this.cache,B=this.config,F=this.currentTransmuxState,U=this.transmuxConfig;g&&(this.currentTransmuxState=g);var w=t(I,o);if(w&&w.method==="AES-128"){var K=this.getDecrypter();if(B.enableSoftwareAES){var H=K.softwareDecrypt(I,w.key.buffer,w.iv.buffer);if(!H)return R.executeEnd=v(),f(d);I=new Uint8Array(H)}else return this.decryptionPromise=K.webCryptoDecrypt(I,w.key.buffer,w.iv.buffer).then(function(se){var ue=S.push(se,null,d);return S.decryptionPromise=null,ue}),this.decryptionPromise}var j=g||F,Y=j.contiguous,z=j.discontinuity,V=j.trackSwitch,Q=j.accurateTimeOffset,X=j.timeOffset,$=j.initSegmentChange,Z=U.audioCodec,J=U.videoCodec,q=U.defaultInitPts,ee=U.duration,ie=U.initSegmentData;if((z||V||$)&&this.resetInitSegment(ie,Z,J,ee),(z||$)&&this.resetInitialTimestamp(q),Y||this.resetContiguity(),this.needsProbing(I,z,V)){if(_.dataLength){var te=_.flush();I=Object(T.appendUint8Array)(te,I)}this.configureTransmuxer(I,U)}var ne=this.transmux(I,w,X,Q,d),le=this.currentTransmuxState;return le.contiguous=!0,le.discontinuity=!1,le.trackSwitch=!1,R.executeEnd=v(),ne},h.flush=function(s){var o=this,d=s.transmuxing;d.executeStart=v();var g=this.decrypter,S=this.cache,R=this.currentTransmuxState,I=this.decryptionPromise;if(I)return I.then(function(){return o.flush(s)});var _=[],B=R.timeOffset;if(g){var F=g.flush();F&&_.push(this.push(F,null,s))}var U=S.dataLength;S.reset();var w=this.demuxer,K=this.remuxer;if(!w||!K)return U>=e&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),d.executeEnd=v(),[f(s)];var H=w.flush(B);return a(H)?H.then(function(j){return o.flushRemux(_,j,s),_}):(this.flushRemux(_,H,s),_)},h.flushRemux=function(s,o,d){var g=o.audioTrack,S=o.avcTrack,R=o.id3Track,I=o.textTrack,_=this.currentTransmuxState,B=_.accurateTimeOffset,F=_.timeOffset;E.logger.log("[transmuxer.ts]: Flushed fragment "+d.sn+(d.part>-1?" p: "+d.part:"")+" of level "+d.level);var U=this.remuxer.remux(g,S,R,I,F,B,!0,this.id);s.push({remuxResult:U,chunkMeta:d}),d.transmuxing.executeEnd=v()},h.resetInitialTimestamp=function(s){var o=this.demuxer,d=this.remuxer;!o||!d||(o.resetTimeStamp(s),d.resetTimeStamp(s))},h.resetContiguity=function(){var s=this.demuxer,o=this.remuxer;!s||!o||(s.resetContiguity(),o.resetNextTimestamp())},h.resetInitSegment=function(s,o,d,g){var S=this.demuxer,R=this.remuxer;!S||!R||(S.resetInitSegment(o,d,g),R.resetInitSegment(s,o,d))},h.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},h.transmux=function(s,o,d,g,S){var R;return o&&o.method==="SAMPLE-AES"?R=this.transmuxSampleAes(s,o,d,g,S):R=this.transmuxUnencrypted(s,d,g,S),R},h.transmuxUnencrypted=function(s,o,d,g){var S=this.demuxer.demux(s,o,!1,!this.config.progressive),R=S.audioTrack,I=S.avcTrack,_=S.id3Track,B=S.textTrack,F=this.remuxer.remux(R,I,_,B,o,d,!1,this.id);return{remuxResult:F,chunkMeta:g}},h.transmuxSampleAes=function(s,o,d,g,S){var R=this;return this.demuxer.demuxSampleAes(s,o,d).then(function(I){var _=R.remuxer.remux(I.audioTrack,I.avcTrack,I.id3Track,I.textTrack,d,g,!1,R.id);return{remuxResult:_,chunkMeta:S}})},h.configureTransmuxer=function(s,o){for(var d=this.config,g=this.observer,S=this.typeSupported,R=this.vendor,I=o.audioCodec,_=o.defaultInitPts,B=o.duration,F=o.initSegmentData,U=o.videoCodec,w,K=0,H=n.length;K<H;K++)if(n[K].demux.probe(s)){w=n[K];break}w||(E.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),w={demux:P.default,remux:x.default});var j=this.demuxer,Y=this.remuxer,z=w.remux,V=w.demux;(!Y||!(Y instanceof z))&&(this.remuxer=new z(g,d,S,R)),(!j||!(j instanceof V))&&(this.demuxer=new V(g,d,S),this.probe=V.probe),this.resetInitSegment(F,I,U,B),this.resetInitialTimestamp(_)},h.needsProbing=function(s,o,d){return!this.demuxer||!this.remuxer||o||d},h.getDecrypter=function(){var s=this.decrypter;return s||(s=this.decrypter=new L.default(this.observer,this.config)),s},c}();function t(c,h){var u=null;return c.byteLength>0&&h!=null&&h.key!=null&&h.iv!==null&&h.method!=null&&(u=h),u}var f=function(h){return{remuxResult:{},chunkMeta:h}};function a(c){return"then"in c&&c.then instanceof Function}var i=function(h,u,s,o,d){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=h,this.videoCodec=u,this.initSegmentData=s,this.duration=o,this.defaultInitPts=d},l=function(h,u,s,o,d,g){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=h,this.contiguous=u,this.accurateTimeOffset=s,this.trackSwitch=o,this.timeOffset=d,this.initSegmentChange=g}},"./src/demux/tsdemuxer.ts":function(k,C,p){p.r(C),p.d(C,"discardEPB",function(){return f});var M=p("./src/demux/adts.ts"),D=p("./src/demux/mpegaudio.ts"),L=p("./src/demux/exp-golomb.ts"),b=p("./src/demux/id3.ts"),P=p("./src/demux/sample-aes.ts"),O=p("./src/events.ts"),A=p("./src/utils/mp4-tools.ts"),m=p("./src/utils/logger.ts"),x=p("./src/errors.ts"),y={video:1,audio:2,id3:3,text:4},T=function(){function a(l,c,h){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=l,this.config=c,this.typeSupported=h}a.probe=function(c){var h=a.syncOffset(c);return h<0?!1:(h&&m.logger.warn("MPEG2-TS detected but first sync word found @ offset "+h+", junk ahead ?"),!0)},a.syncOffset=function(c){for(var h=Math.min(1e3,c.length-564),u=0;u<h;){if(c[u]===71&&c[u+188]===71&&c[u+2*188]===71)return u;u++}return-1},a.createTrack=function(c,h){return{container:c==="video"||c==="audio"?"video/mp2t":void 0,type:c,id:y[c],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:c==="audio"?h:void 0}};var i=a.prototype;return i.resetInitSegment=function(c,h,u){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",u),this._audioTrack=a.createTrack("audio",u),this._id3Track=a.createTrack("id3",u),this._txtTrack=a.createTrack("text",u),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=h,this._duration=u},i.resetTimeStamp=function(){},i.resetContiguity=function(){var c=this._audioTrack,h=this._avcTrack,u=this._id3Track;c&&(c.pesData=null),h&&(h.pesData=null),u&&(u.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},i.demux=function(c,h,u,s){u===void 0&&(u=!1),s===void 0&&(s=!1),u||(this.sampleAes=null);var o,d=this._avcTrack,g=this._audioTrack,S=this._id3Track,R=d.pid,I=d.pesData,_=g.pid,B=S.pid,F=g.pesData,U=S.pesData,w=!1,K=this.pmtParsed,H=this._pmtId,j=c.length;if(this.remainderData&&(c=Object(A.appendUint8Array)(this.remainderData,c),j=c.length,this.remainderData=null),j<188&&!s)return this.remainderData=c,{audioTrack:g,avcTrack:d,id3Track:S,textTrack:this._txtTrack};var Y=Math.max(0,a.syncOffset(c));j-=(j+Y)%188,j<c.byteLength&&!s&&(this.remainderData=new Uint8Array(c.buffer,j,c.buffer.byteLength-j));for(var z=0,V=Y;V<j;V+=188)if(c[V]===71){var Q=!!(c[V+1]&64),X=((c[V+1]&31)<<8)+c[V+2],$=(c[V+3]&48)>>4,Z=void 0;if($>1){if(Z=V+5+c[V+4],Z===V+188)continue}else Z=V+4;switch(X){case R:Q&&(I&&(o=e(I))&&this.parseAVCPES(o,!1),I={data:[],size:0}),I&&(I.data.push(c.subarray(Z,V+188)),I.size+=V+188-Z);break;case _:Q&&(F&&(o=e(F))&&(g.isAAC?this.parseAACPES(o):this.parseMPEGPES(o)),F={data:[],size:0}),F&&(F.data.push(c.subarray(Z,V+188)),F.size+=V+188-Z);break;case B:Q&&(U&&(o=e(U))&&this.parseID3PES(o),U={data:[],size:0}),U&&(U.data.push(c.subarray(Z,V+188)),U.size+=V+188-Z);break;case 0:Q&&(Z+=c[Z]+1),H=this._pmtId=v(c,Z);break;case H:{Q&&(Z+=c[Z]+1);var J=n(c,Z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,u);R=J.avc,R>0&&(d.pid=R),_=J.audio,_>0&&(g.pid=_,g.isAAC=J.isAAC),B=J.id3,B>0&&(S.pid=B),w&&!K&&(m.logger.log("reparse from beginning"),w=!1,V=Y-188),K=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=!0;break}}else z++;z>0&&this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+z+" TS packet/s that do not start with 0x47"}),d.pesData=I,g.pesData=F,S.pesData=U;var q={audioTrack:g,avcTrack:d,id3Track:S,textTrack:this._txtTrack};return s&&this.extractRemainingSamples(q),q},i.flush=function(){var c=this.remainderData;this.remainderData=null;var h;return c?h=this.demux(c,-1,!1,!0):h={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(h),this.sampleAes?this.decrypt(h,this.sampleAes):h},i.extractRemainingSamples=function(c){var h=c.audioTrack,u=c.avcTrack,s=c.id3Track,o=u.pesData,d=h.pesData,g=s.pesData,S;o&&(S=e(o))?(this.parseAVCPES(S,!0),u.pesData=null):u.pesData=o,d&&(S=e(d))?(h.isAAC?this.parseAACPES(S):this.parseMPEGPES(S),h.pesData=null):(d!=null&&d.size&&m.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=d),g&&(S=e(g))?(this.parseID3PES(S),s.pesData=null):s.pesData=g},i.demuxSampleAes=function(c,h,u){var s=this.demux(c,u,!0,!this.config.progressive),o=this.sampleAes=new P.default(this.observer,this.config,h);return this.decrypt(s,o)},i.decrypt=function(c,h){return new Promise(function(u){var s=c.audioTrack,o=c.avcTrack;s.samples&&s.isAAC?h.decryptAacSamples(s.samples,0,function(){o.samples?h.decryptAvcSamples(o.samples,0,0,function(){u(c)}):u(c)}):o.samples&&h.decryptAvcSamples(o.samples,0,0,function(){u(c)})})},i.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},i.parseAVCPES=function(c,h){var u=this,s=this._avcTrack,o=this.parseAVCNALu(c.data),d=this.avcSample,g,S=!1;c.data=null,d&&o.length&&!s.audFound&&(r(d,s),d=this.avcSample=E(!1,c.pts,c.dts,"")),o.forEach(function(R){switch(R.type){case 1:{g=!0,d||(d=u.avcSample=E(!0,c.pts,c.dts,"")),d.frame=!0;var I=R.data;if(S&&I.length>4){var _=new L.default(I).readSliceType();(_===2||_===4||_===7||_===9)&&(d.key=!0)}break}case 5:g=!0,d||(d=u.avcSample=E(!0,c.pts,c.dts,"")),d.key=!0,d.frame=!0;break;case 6:{g=!0;var B=new L.default(f(R.data));B.readUByte();for(var F=0,U=0,w=!1,K=0;!w&&B.bytesAvailable>1;){F=0;do K=B.readUByte(),F+=K;while(K===255);U=0;do K=B.readUByte(),U+=K;while(K===255);if(F===4&&B.bytesAvailable!==0){w=!0;var H=B.readUByte();if(H===181){var j=B.readUShort();if(j===49){var Y=B.readUInt();if(Y===1195456820){var z=B.readUByte();if(z===3){for(var V=B.readUByte(),Q=B.readUByte(),X=31&V,$=[V,Q],Z=0;Z<X;Z++)$.push(B.readUByte()),$.push(B.readUByte()),$.push(B.readUByte());t(u._txtTrack.samples,{type:3,pts:c.pts,bytes:$})}}}}}else if(F===5&&B.bytesAvailable!==0){if(w=!0,U>16){for(var J=[],q=0;q<16;q++)J.push(B.readUByte().toString(16)),(q===3||q===5||q===7||q===9)&&J.push("-");for(var ee=U-16,ie=new Uint8Array(ee),te=0;te<ee;te++)ie[te]=B.readUByte();t(u._txtTrack.samples,{pts:c.pts,payloadType:F,uuid:J.join(""),userData:Object(b.utf8ArrayToStr)(ie),userDataBytes:ie})}}else if(U<B.bytesAvailable)for(var ne=0;ne<U;ne++)B.readUByte()}break}case 7:if(g=!0,S=!0,!s.sps){var le=new L.default(R.data),se=le.readSPS();s.width=se.width,s.height=se.height,s.pixelRatio=se.pixelRatio,s.sps=[R.data],s.duration=u._duration;for(var ue=R.data.subarray(1,4),oe="avc1.",fe=0;fe<3;fe++){var re=ue[fe].toString(16);re.length<2&&(re="0"+re),oe+=re}s.codec=oe}break;case 8:g=!0,s.pps||(s.pps=[R.data]);break;case 9:g=!1,s.audFound=!0,d&&r(d,s),d=u.avcSample=E(!1,c.pts,c.dts,"");break;case 12:g=!1;break;default:g=!1,d&&(d.debug+="unknown NAL "+R.type+" ");break}if(d&&g){var xe=d.units;xe.push(R)}}),h&&d&&(r(d,s),this.avcSample=null)},i.getLastNalUnit=function(){var c,h=this.avcSample,u;if(!h||h.units.length===0){var s=this._avcTrack.samples;h=s[s.length-1]}if((c=h)!==null&&c!==void 0&&c.units){var o=h.units;u=o[o.length-1]}return u},i.parseAVCNALu=function(c){var h=c.byteLength,u=this._avcTrack,s=u.naluState||0,o=s,d=[],g=0,S,R,I,_=-1,B=0;for(s===-1&&(_=0,B=c[0]&31,s=0,g=1);g<h;){if(S=c[g++],!s){s=S?0:1;continue}if(s===1){s=S?0:2;continue}if(!S)s=3;else if(S===1){if(_>=0){var F={data:c.subarray(_,g-s-1),type:B};d.push(F)}else{var U=this.getLastNalUnit();if(U&&(o&&g<=4-o&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-o)),R=g-s-1,R>0)){var w=new Uint8Array(U.data.byteLength+R);w.set(U.data,0),w.set(c.subarray(0,R),U.data.byteLength),U.data=w,U.state=0}}g<h?(I=c[g]&31,_=g,B=I,s=0):s=-1}else s=0}if(_>=0&&s>=0){var K={data:c.subarray(_,h),type:B,state:s};d.push(K)}if(d.length===0){var H=this.getLastNalUnit();if(H){var j=new Uint8Array(H.data.byteLength+c.byteLength);j.set(H.data,0),j.set(c,H.data.byteLength),H.data=j}}return u.naluState=s,d},i.parseAACPES=function(c){var h=0,u=this._audioTrack,s=this.aacOverFlow,o=c.data;if(s){this.aacOverFlow=null;var d=s.sample.unit.byteLength,g=Math.min(s.missing,d),S=d-g;s.sample.unit.set(o.subarray(0,g),S),u.samples.push(s.sample),h=s.missing}var R,I;for(R=h,I=o.length;R<I-1&&!M.isHeader(o,R);R++);if(R!==h){var _,B;if(R<I-1?(_="AAC PES did not start with ADTS header,offset:"+R,B=!1):(_="no ADTS header found in AAC PES",B=!0),m.logger.warn("parsing error:"+_),this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:_}),B)return}M.initTrackConfig(u,this.observer,o,R,this.audioCodec);var F;if(c.pts!==void 0)F=c.pts;else if(s){var U=M.getFrameDuration(u.samplerate);F=s.sample.pts+U}else{m.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var w=0;R<I;)if(M.isHeader(o,R)){if(R+5<I){var K=M.appendFrame(u,o,R,F,w);if(K)if(K.missing)this.aacOverFlow=K;else{R+=K.length,w++;continue}}break}else R++},i.parseMPEGPES=function(c){var h=c.data,u=h.length,s=0,o=0,d=c.pts;if(d===void 0){m.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<u;)if(D.isHeader(h,o)){var g=D.appendFrame(this._audioTrack,h,o,d,s);if(g)o+=g.length,s++;else break}else o++},i.parseID3PES=function(c){if(c.pts===void 0){m.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(c)},a}();T.minProbeByteLength=188;function E(a,i,l,c){return{key:a,frame:!1,pts:i,dts:l,units:[],debug:c,length:0}}function v(a,i){return(a[i+10]&31)<<8|a[i+11]}function n(a,i,l,c){var h={audio:-1,avc:-1,id3:-1,isAAC:!0},u=(a[i+1]&15)<<8|a[i+2],s=i+3+u-4,o=(a[i+10]&15)<<8|a[i+11];for(i+=12+o;i<s;){var d=(a[i+1]&31)<<8|a[i+2];switch(a[i]){case 207:if(!c){m.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:h.audio===-1&&(h.audio=d);break;case 21:h.id3===-1&&(h.id3=d);break;case 219:if(!c){m.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:h.avc===-1&&(h.avc=d);break;case 3:case 4:l?h.audio===-1&&(h.audio=d,h.isAAC=!1):m.logger.log("MPEG audio found, not supported in this browser");break;case 36:m.logger.warn("Unsupported HEVC stream type found");break}i+=((a[i+3]&15)<<8|a[i+4])+5}return h}function e(a){var i=0,l,c,h,u,s,o=a.data;if(!a||a.size===0)return null;for(;o[0].length<19&&o.length>1;){var d=new Uint8Array(o[0].length+o[1].length);d.set(o[0]),d.set(o[1],o[0].length),o[0]=d,o.splice(1,1)}l=o[0];var g=(l[0]<<16)+(l[1]<<8)+l[2];if(g===1){if(c=(l[4]<<8)+l[5],c&&c>a.size-6)return null;var S=l[7];S&192&&(u=(l[9]&14)*536870912+(l[10]&255)*4194304+(l[11]&254)*16384+(l[12]&255)*128+(l[13]&254)/2,S&64?(s=(l[14]&14)*536870912+(l[15]&255)*4194304+(l[16]&254)*16384+(l[17]&255)*128+(l[18]&254)/2,u-s>60*9e4&&(m.logger.warn(Math.round((u-s)/9e4)+"s delta between PTS and DTS, align them"),u=s)):s=u),h=l[8];var R=h+9;if(a.size<=R)return null;a.size-=R;for(var I=new Uint8Array(a.size),_=0,B=o.length;_<B;_++){l=o[_];var F=l.byteLength;if(R)if(R>F){R-=F;continue}else l=l.subarray(R),F-=R,R=0;I.set(l,i),i+=F}return c&&(c-=h+3),{data:I,pts:u,dts:s,len:c}}return null}function r(a,i){if(a.units.length&&a.frame){if(a.pts===void 0){var l=i.samples,c=l.length;if(c){var h=l[c-1];a.pts=h.pts,a.dts=h.dts}else{i.dropped++;return}}i.samples.push(a)}a.debug.length&&m.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function t(a,i){var l=a.length;if(l>0){if(i.pts>=a[l-1].pts)a.push(i);else for(var c=l-1;c>=0;c--)if(i.pts<a[c].pts){a.splice(c,0,i);break}}else a.push(i)}function f(a){for(var i=a.byteLength,l=[],c=1;c<i-2;)a[c]===0&&a[c+1]===0&&a[c+2]===3?(l.push(c+2),c+=2):c++;if(l.length===0)return a;var h=i-l.length,u=new Uint8Array(h),s=0;for(c=0;c<h;s++,c++)s===l[0]&&(s++,l.shift()),u[c]=a[s];return u}C.default=T},"./src/errors.ts":function(k,C,p){p.r(C),p.d(C,"ErrorTypes",function(){return M}),p.d(C,"ErrorDetails",function(){return D});var M;(function(L){L.NETWORK_ERROR="networkError",L.MEDIA_ERROR="mediaError",L.KEY_SYSTEM_ERROR="keySystemError",L.MUX_ERROR="muxError",L.OTHER_ERROR="otherError"})(M||(M={}));var D;(function(L){L.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",L.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",L.KEY_SYSTEM_NO_SESSION="keySystemNoSession",L.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",L.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",L.MANIFEST_LOAD_ERROR="manifestLoadError",L.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",L.MANIFEST_PARSING_ERROR="manifestParsingError",L.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",L.LEVEL_EMPTY_ERROR="levelEmptyError",L.LEVEL_LOAD_ERROR="levelLoadError",L.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",L.LEVEL_SWITCH_ERROR="levelSwitchError",L.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",L.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",L.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",L.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",L.FRAG_LOAD_ERROR="fragLoadError",L.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",L.FRAG_DECRYPT_ERROR="fragDecryptError",L.FRAG_PARSING_ERROR="fragParsingError",L.REMUX_ALLOC_ERROR="remuxAllocError",L.KEY_LOAD_ERROR="keyLoadError",L.KEY_LOAD_TIMEOUT="keyLoadTimeOut",L.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",L.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",L.BUFFER_APPEND_ERROR="bufferAppendError",L.BUFFER_APPENDING_ERROR="bufferAppendingError",L.BUFFER_STALLED_ERROR="bufferStalledError",L.BUFFER_FULL_ERROR="bufferFullError",L.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",L.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",L.INTERNAL_EXCEPTION="internalException",L.INTERNAL_ABORTED="aborted",L.UNKNOWN="unknown"})(D||(D={}))},"./src/events.ts":function(k,C,p){p.r(C),p.d(C,"Events",function(){return M});var M;(function(D){D.MEDIA_ATTACHING="hlsMediaAttaching",D.MEDIA_ATTACHED="hlsMediaAttached",D.MEDIA_DETACHING="hlsMediaDetaching",D.MEDIA_DETACHED="hlsMediaDetached",D.BUFFER_RESET="hlsBufferReset",D.BUFFER_CODECS="hlsBufferCodecs",D.BUFFER_CREATED="hlsBufferCreated",D.BUFFER_APPENDING="hlsBufferAppending",D.BUFFER_APPENDED="hlsBufferAppended",D.BUFFER_EOS="hlsBufferEos",D.BUFFER_FLUSHING="hlsBufferFlushing",D.BUFFER_FLUSHED="hlsBufferFlushed",D.MANIFEST_LOADING="hlsManifestLoading",D.MANIFEST_LOADED="hlsManifestLoaded",D.MANIFEST_PARSED="hlsManifestParsed",D.LEVEL_SWITCHING="hlsLevelSwitching",D.LEVEL_SWITCHED="hlsLevelSwitched",D.LEVEL_LOADING="hlsLevelLoading",D.LEVEL_LOADED="hlsLevelLoaded",D.LEVEL_UPDATED="hlsLevelUpdated",D.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",D.LEVELS_UPDATED="hlsLevelsUpdated",D.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",D.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",D.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",D.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",D.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",D.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",D.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",D.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",D.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",D.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",D.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",D.CUES_PARSED="hlsCuesParsed",D.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",D.INIT_PTS_FOUND="hlsInitPtsFound",D.FRAG_LOADING="hlsFragLoading",D.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",D.FRAG_LOADED="hlsFragLoaded",D.FRAG_DECRYPTED="hlsFragDecrypted",D.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",D.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",D.FRAG_PARSING_METADATA="hlsFragParsingMetadata",D.FRAG_PARSED="hlsFragParsed",D.FRAG_BUFFERED="hlsFragBuffered",D.FRAG_CHANGED="hlsFragChanged",D.FPS_DROP="hlsFpsDrop",D.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",D.ERROR="hlsError",D.DESTROYING="hlsDestroying",D.KEY_LOADING="hlsKeyLoading",D.KEY_LOADED="hlsKeyLoaded",D.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",D.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return t});var M=p("./node_modules/url-toolkit/src/url-toolkit.js"),D=p("./src/loader/playlist-loader.ts"),L=p("./src/loader/key-loader.ts"),b=p("./src/controller/id3-track-controller.ts"),P=p("./src/controller/latency-controller.ts"),O=p("./src/controller/level-controller.ts"),A=p("./src/controller/fragment-tracker.ts"),m=p("./src/controller/stream-controller.ts"),x=p("./src/is-supported.ts"),y=p("./src/utils/logger.ts"),T=p("./src/config.ts"),E=p("./node_modules/eventemitter3/index.js"),v=p("./src/events.ts"),n=p("./src/errors.ts");function e(f,a){for(var i=0;i<a.length;i++){var l=a[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(f,l.key,l)}}function r(f,a,i){return a&&e(f.prototype,a),i&&e(f,i),f}var t=function(){f.isSupported=function(){return Object(x.isSupported)()};function f(i){i===void 0&&(i={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new E.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var l=this.config=Object(T.mergeConfig)(f.DefaultConfig,i);this.userConfig=i,Object(y.enableLogs)(l.debug),this._autoLevelCapping=-1,l.progressive&&Object(T.enableStreamingMode)(l);var c=l.abrController,h=l.bufferController,u=l.capLevelController,s=l.fpsController,o=this.abrController=new c(this),d=this.bufferController=new h(this),g=this.capLevelController=new u(this),S=new s(this),R=new D.default(this),I=new L.default(this),_=new b.default(this),B=this.levelController=new O.default(this),F=new A.FragmentTracker(this),U=this.streamController=new m.default(this,F);g.setStreamController(U),S.setStreamController(U);var w=[B,U];this.networkControllers=w;var K=[R,I,o,d,g,S,_,F];this.audioTrackController=this.createController(l.audioTrackController,null,w),this.createController(l.audioStreamController,F,w),this.subtitleTrackController=this.createController(l.subtitleTrackController,null,w),this.createController(l.subtitleStreamController,F,w),this.createController(l.timelineController,null,K),this.emeController=this.createController(l.emeController,null,K),this.cmcdController=this.createController(l.cmcdController,null,K),this.latencyController=this.createController(P.default,null,K),this.coreComponents=K}var a=f.prototype;return a.createController=function(l,c,h){if(l){var u=c?new l(this,c):new l(this);return h&&h.push(u),u}return null},a.on=function(l,c,h){h===void 0&&(h=this),this._emitter.on(l,c,h)},a.once=function(l,c,h){h===void 0&&(h=this),this._emitter.once(l,c,h)},a.removeAllListeners=function(l){this._emitter.removeAllListeners(l)},a.off=function(l,c,h,u){h===void 0&&(h=this),this._emitter.off(l,c,h,u)},a.listeners=function(l){return this._emitter.listeners(l)},a.emit=function(l,c,h){return this._emitter.emit(l,c,h)},a.trigger=function(l,c){if(this.config.debug)return this.emit(l,l,c);try{return this.emit(l,l,c)}catch(h){y.logger.error("An internal error happened while handling event "+l+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(v.Events.ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:l,error:h})}return!1},a.listenerCount=function(l){return this._emitter.listenerCount(l)},a.destroy=function(){y.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(l){return l.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(l){return l.destroy()}),this.coreComponents.length=0},a.attachMedia=function(l){y.logger.log("attachMedia"),this._media=l,this.trigger(v.Events.MEDIA_ATTACHING,{media:l})},a.detachMedia=function(){y.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(l){this.stopLoad();var c=this.media,h=this.url,u=this.url=M.buildAbsoluteURL(self.location.href,l,{alwaysNormalize:!0});y.logger.log("loadSource:"+u),c&&h&&h!==u&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(c)),this.trigger(v.Events.MANIFEST_LOADING,{url:l})},a.startLoad=function(l){l===void 0&&(l=-1),y.logger.log("startLoad("+l+")"),this.networkControllers.forEach(function(c){c.startLoad(l)})},a.stopLoad=function(){y.logger.log("stopLoad"),this.networkControllers.forEach(function(l){l.stopLoad()})},a.swapAudioCodec=function(){y.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){y.logger.log("recoverMediaError");var l=this._media;this.detachMedia(),l&&this.attachMedia(l)},a.removeLevel=function(l,c){c===void 0&&(c=0),this.levelController.removeLevel(l,c)},r(f,[{key:"levels",get:function(){var l=this.levelController.levels;return l||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(l){y.logger.log("set currentLevel:"+l),this.loadLevel=l,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(l){y.logger.log("set nextLevel:"+l),this.levelController.manualLevel=l,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(l){y.logger.log("set loadLevel:"+l),this.levelController.manualLevel=l}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){y.logger.log("set firstLevel:"+l),this.levelController.firstLevel=l}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(l){y.logger.log("set startLevel:"+l),l!==-1&&(l=Math.max(l,this.minAutoLevel)),this.levelController.startLevel=l}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(l){var c=!!l;c!==this.config.capLevelToPlayerSize&&(c?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=c)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(l){this._autoLevelCapping!==l&&(y.logger.log("set autoLevelCapping:"+l),this._autoLevelCapping=l)}},{key:"bandwidthEstimate",get:function(){var l=this.abrController.bwEstimator;return l?l.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var l=this.levels,c=this.config.minAutoBitrate;if(!l)return 0;for(var h=l.length,u=0;u<h;u++)if(l[u].maxBitrate>c)return u;return 0}},{key:"maxAutoLevel",get:function(){var l=this.levels,c=this.autoLevelCapping,h;return c===-1&&l&&l.length?h=l.length-1:h=c,h}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)}},{key:"audioTracks",get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]}},{key:"audioTrack",get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var c=this.audioTrackController;c&&(c.audioTrack=l)}},{key:"subtitleTracks",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var c=this.subtitleTrackController;c&&(c.subtitleTrack=l)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var l=this.subtitleTrackController;return l?l.subtitleDisplay:!1},set:function(l){var c=this.subtitleTrackController;c&&(c.subtitleDisplay=l)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(l){this.config.lowLatencyMode=l}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return n.ErrorTypes}},{key:"ErrorDetails",get:function(){return n.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:T.hlsDefaultConfig},set:function(l){f.defaultConfig=l}}]),f}();t.defaultConfig=void 0},"./src/is-supported.ts":function(k,C,p){p.r(C),p.d(C,"isSupported",function(){return L}),p.d(C,"changeTypeSupported",function(){return b});var M=p("./src/utils/mediasource-helper.ts");function D(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var P=Object(M.getMediaSource)();if(!P)return!1;var O=D(),A=P&&typeof P.isTypeSupported=="function"&&P.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),m=!O||O.prototype&&typeof O.prototype.appendBuffer=="function"&&typeof O.prototype.remove=="function";return!!A&&!!m}function b(){var P,O=D();return typeof(O==null||(P=O.prototype)===null||P===void 0?void 0:P.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return T}),p.d(C,"LoadError",function(){return v});var M=p("./src/polyfills/number.ts"),D=p("./src/errors.ts");function L(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,m(n,e)}function b(n){var e=typeof Map=="function"?new Map:void 0;return b=function(t){if(t===null||!A(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(t))return e.get(t);e.set(t,f)}function f(){return P(t,arguments,x(this).constructor)}return f.prototype=Object.create(t.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),m(f,t)},b(n)}function P(n,e,r){return O()?P=Reflect.construct:P=function(f,a,i){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(f,l),h=new c;return i&&m(h,i.prototype),h},P.apply(null,arguments)}function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function m(n,e){return m=Object.setPrototypeOf||function(t,f){return t.__proto__=f,t},m(n,e)}function x(n){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},x(n)}var y=Math.pow(2,17),T=function(){function n(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var e=n.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,f){var a=this,i=t.url;if(!i)return Promise.reject(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var l=this.config,c=l.fLoader,h=l.loader;return new Promise(function(u,s){a.loader&&a.loader.destroy();var o=a.loader=t.loader=c?new c(l):new h(l),d=E(t),g={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:y};t.stats=o.stats,o.load(d,g,{onSuccess:function(R,I,_,B){a.resetLoader(t,o),u({frag:t,part:null,payload:R.data,networkDetails:B})},onError:function(R,I,_){a.resetLoader(t,o),s(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:R,networkDetails:_}))},onAbort:function(R,I,_){a.resetLoader(t,o),s(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:_}))},onTimeout:function(R,I,_){a.resetLoader(t,o),s(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:_}))},onProgress:function(R,I,_,B){f&&f({frag:t,part:null,payload:_,networkDetails:B})}})})},e.loadPart=function(t,f,a){var i=this;this.abort();var l=this.config,c=l.fLoader,h=l.loader;return new Promise(function(u,s){i.loader&&i.loader.destroy();var o=i.loader=t.loader=c?new c(l):new h(l),d=E(t,f),g={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:y};f.stats=o.stats,o.load(d,g,{onSuccess:function(R,I,_,B){i.resetLoader(t,o),i.updateStatsFromPart(t,f);var F={frag:t,part:f,payload:R.data,networkDetails:B};a(F),u(F)},onError:function(R,I,_){i.resetLoader(t,o),s(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:f,response:R,networkDetails:_}))},onAbort:function(R,I,_){t.stats.aborted=f.stats.aborted,i.resetLoader(t,o),s(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:f,networkDetails:_}))},onTimeout:function(R,I,_){i.resetLoader(t,o),s(new v({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:f,networkDetails:_}))}})})},e.updateStatsFromPart=function(t,f){var a=t.stats,i=f.stats,l=i.total;if(a.loaded+=i.loaded,l){var c=Math.round(t.duration/f.duration),h=Math.min(Math.round(a.loaded/l),c),u=c-h,s=u*Math.round(a.loaded/h);a.total=a.loaded+s}else a.total=Math.max(a.loaded,a.total);var o=a.loading,d=i.loading;o.start?o.first+=d.first-d.start:(o.start=d.start,o.first=d.first),o.end=d.end},e.resetLoader=function(t,f){t.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},n}();function E(n,e){e===void 0&&(e=null);var r=e||n,t={frag:n,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},f=r.byteRangeStartOffset,a=r.byteRangeEndOffset;return Object(M.isFiniteNumber)(f)&&Object(M.isFiniteNumber)(a)&&(t.rangeStart=f,t.rangeEnd=a),t}var v=function(n){L(e,n);function e(r){for(var t,f=arguments.length,a=new Array(f>1?f-1:0),i=1;i<f;i++)a[i-1]=arguments[i];return t=n.call.apply(n,[this].concat(a))||this,t.data=void 0,t.data=r,t}return e}(b(Error))},"./src/loader/fragment.ts":function(k,C,p){p.r(C),p.d(C,"ElementaryStreamTypes",function(){return y}),p.d(C,"BaseSegment",function(){return T}),p.d(C,"Fragment",function(){return E}),p.d(C,"Part",function(){return v});var M=p("./src/polyfills/number.ts"),D=p("./node_modules/url-toolkit/src/url-toolkit.js"),L=p("./src/utils/logger.ts"),b=p("./src/loader/level-key.ts"),P=p("./src/loader/load-stats.ts");function O(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,A(n,e)}function A(n,e){return A=Object.setPrototypeOf||function(t,f){return t.__proto__=f,t},A(n,e)}function m(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function x(n,e,r){return e&&m(n.prototype,e),r&&m(n,r),n}var y;(function(n){n.AUDIO="audio",n.VIDEO="video",n.AUDIOVIDEO="audiovideo"})(y||(y={}));var T=function(){function n(r){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(t={},t[y.AUDIO]=null,t[y.VIDEO]=null,t[y.AUDIOVIDEO]=null,t),this.baseurl=r}var e=n.prototype;return e.setByteRange=function(t,f){var a=t.split("@",2),i=[];a.length===1?i[0]=f?f.byteRangeEndOffset:0:i[0]=parseInt(a[1]),i[1]=parseInt(a[0])+i[0],this._byteRange=i},x(n,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(D.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),n}(),E=function(n){O(e,n);function e(t,f){var a;return a=n.call(this,f)||this,a._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkey=void 0,a.type=void 0,a.loader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new P.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.type=t,a}var r=e.prototype;return r.createInitializationVector=function(f){for(var a=new Uint8Array(16),i=12;i<16;i++)a[i]=f>>8*(15-i)&255;return a},r.setDecryptDataFromLevelKey=function(f,a){var i=f;return(f==null?void 0:f.method)==="AES-128"&&f.uri&&!f.iv&&(i=b.LevelKey.fromURI(f.uri),i.method=f.method,i.iv=this.createInitializationVector(a),i.keyFormat="identity"),i},r.setElementaryStreamInfo=function(f,a,i,l,c,h){h===void 0&&(h=!1);var u=this.elementaryStreams,s=u[f];if(!s){u[f]={startPTS:a,endPTS:i,startDTS:l,endDTS:c,partial:h};return}s.startPTS=Math.min(s.startPTS,a),s.endPTS=Math.max(s.endPTS,i),s.startDTS=Math.min(s.startDTS,l),s.endDTS=Math.max(s.endDTS,c)},r.clearElementaryStreamInfo=function(){var f=this.elementaryStreams;f[y.AUDIO]=null,f[y.VIDEO]=null,f[y.AUDIOVIDEO]=null},x(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var f=this.sn;typeof f!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&L.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),f=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,f)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var f=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+f*1e3}},{key:"encrypted",get:function(){var f;return!!((f=this.decryptdata)!==null&&f!==void 0&&f.keyFormat&&this.decryptdata.uri)}}]),e}(T),v=function(n){O(e,n);function e(r,t,f,a,i){var l;l=n.call(this,f)||this,l.fragOffset=0,l.duration=0,l.gap=!1,l.independent=!1,l.relurl=void 0,l.fragment=void 0,l.index=void 0,l.stats=new P.LoadStats,l.duration=r.decimalFloatingPoint("DURATION"),l.gap=r.bool("GAP"),l.independent=r.bool("INDEPENDENT"),l.relurl=r.enumeratedString("URI"),l.fragment=t,l.index=a;var c=r.enumeratedString("BYTERANGE");return c&&l.setByteRange(c,i),i&&(l.fragOffset=i.fragOffset+i.duration),l}return x(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(T)},"./src/loader/key-loader.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return b});var M=p("./src/events.ts"),D=p("./src/errors.ts"),L=p("./src/utils/logger.ts"),b=function(){function P(A){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=A,this._registerListeners()}var O=P.prototype;return O._registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},O._unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},O.destroy=function(){this._unregisterListeners();for(var m in this.loaders){var x=this.loaders[m];x&&x.destroy()}this.loaders={}},O.onKeyLoading=function(m,x){var y=x.frag,T=y.type,E=this.loaders[T];if(!y.decryptdata){L.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var v=y.decryptdata.uri;if(v!==this.decrypturl||this.decryptkey===null){var n=this.hls.config;if(E&&(L.logger.warn("abort previous key loader for type:"+T),E.abort()),!v){L.logger.warn("key uri is falsy");return}var e=n.loader,r=y.loader=this.loaders[T]=new e(n);this.decrypturl=v,this.decryptkey=null;var t={url:v,frag:y,responseType:"arraybuffer"},f={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},a={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(t,f,a)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:y}))},O.loadsuccess=function(m,x,y){var T=y.frag;if(!T.decryptdata){L.logger.error("after key load, decryptdata unset");return}this.decryptkey=T.decryptdata.key=new Uint8Array(m.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:T})},O.loaderror=function(m,x){var y=x.frag,T=y.loader;T&&T.abort(),delete this.loaders[y.type],this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:m})},O.loadtimeout=function(m,x){var y=x.frag,T=y.loader;T&&T.abort(),delete this.loaders[y.type],this.hls.trigger(M.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},P}()},"./src/loader/level-details.ts":function(k,C,p){p.r(C),p.d(C,"LevelDetails",function(){return P});var M=p("./src/polyfills/number.ts");function D(O,A){for(var m=0;m<A.length;m++){var x=A[m];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(O,x.key,x)}}function L(O,A,m){return A&&D(O.prototype,A),m&&D(O,m),O}var b=10,P=function(){function O(m){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=m}var A=O.prototype;return A.reloaded=function(x){if(!x){this.advanced=!0,this.updated=!0;return}var y=this.lastPartSn-x.lastPartSn,T=this.lastPartIndex-x.lastPartIndex;this.updated=this.endSN!==x.endSN||!!T||!!y,this.advanced=this.endSN>x.endSN||y>0||y===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(x.misses*.6):this.misses=x.misses+1,this.availabilityDelay=x.availabilityDelay},L(O,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var x=this.driftEndTime-this.driftStartTime;if(x>0){var y=this.driftEnd-this.driftStart;return y*1e3/x}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var x;return(x=this.fragments)!==null&&x!==void 0&&x.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var x;return(x=this.partList)!==null&&x!==void 0&&x.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),O}()},"./src/loader/level-key.ts":function(k,C,p){p.r(C),p.d(C,"LevelKey",function(){return b});var M=p("./node_modules/url-toolkit/src/url-toolkit.js");function D(P,O){for(var A=0;A<O.length;A++){var m=O[A];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(P,m.key,m)}}function L(P,O,A){return O&&D(P.prototype,O),A&&D(P,A),P}var b=function(){P.fromURL=function(A,m){return new P(A,m)},P.fromURI=function(A){return new P(A)};function P(O,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,A?this._uri=Object(M.buildAbsoluteURL)(O,A,{alwaysNormalize:!0}):this._uri=O}return L(P,[{key:"uri",get:function(){return this._uri}}]),P}()},"./src/loader/load-stats.ts":function(k,C,p){p.r(C),p.d(C,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return e});var M=p("./src/polyfills/number.ts"),D=p("./node_modules/url-toolkit/src/url-toolkit.js"),L=p("./src/loader/fragment.ts"),b=p("./src/loader/level-details.ts"),P=p("./src/loader/level-key.ts"),O=p("./src/utils/attr-list.ts"),A=p("./src/utils/logger.ts"),m=p("./src/utils/codecs.ts"),x=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),E=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i;function n(i){var l,c;return v.test((l=(c=D.parseURL(i))===null||c===void 0?void 0:c.path)!=null?l:"")}var e=function(){function i(){}return i.findGroup=function(c,h){for(var u=0;u<c.length;u++){var s=c[u];if(s.id===h)return s}},i.convertAVC1ToAVCOTI=function(c){var h=c.split(".");if(h.length>2){var u=h.shift()+".";return u+=parseInt(h.shift()).toString(16),u+=("000"+parseInt(h.shift()).toString(16)).substr(-4),u}return c},i.resolve=function(c,h){return D.buildAbsoluteURL(h,c,{alwaysNormalize:!0})},i.parseMasterPlaylist=function(c,h){var u=[],s={},o=!1;x.lastIndex=0;for(var d;(d=x.exec(c))!=null;)if(d[1]){var g=new O.AttrList(d[1]),S={attrs:g,bitrate:g.decimalInteger("AVERAGE-BANDWIDTH")||g.decimalInteger("BANDWIDTH"),name:g.NAME,url:i.resolve(d[2],h)},R=g.decimalResolution("RESOLUTION");R&&(S.width=R.width,S.height=R.height),r((g.CODECS||"").split(/[ ,]+/).filter(function(_){return _}),S),S.videoCodec&&S.videoCodec.indexOf("avc1")!==-1&&(S.videoCodec=i.convertAVC1ToAVCOTI(S.videoCodec)),u.push(S)}else if(d[3]){var I=new O.AttrList(d[3]);I["DATA-ID"]&&(o=!0,s[I["DATA-ID"]]=I)}return{levels:u,sessionData:o?s:null}},i.parseMasterPlaylistMedia=function(c,h,u,s){s===void 0&&(s=[]);var o,d=[],g=0;for(y.lastIndex=0;(o=y.exec(c))!==null;){var S=new O.AttrList(o[1]);if(S.TYPE===u){var R={attrs:S,bitrate:0,id:g++,groupId:S["GROUP-ID"],instreamId:S["INSTREAM-ID"],name:S.NAME||S.LANGUAGE||"",type:u,default:S.bool("DEFAULT"),autoselect:S.bool("AUTOSELECT"),forced:S.bool("FORCED"),lang:S.LANGUAGE,url:S.URI?i.resolve(S.URI,h):""};if(s.length){var I=i.findGroup(s,R.groupId)||s[0];t(R,I,"audioCodec"),t(R,I,"textCodec")}d.push(R)}}return d},i.parseLevelPlaylist=function(c,h,u,s,o){var d=new b.LevelDetails(h),g=d.fragments,S=null,R=0,I=0,_=0,B=0,F=null,U=new L.Fragment(s,h),w,K,H,j=-1,Y=!1;for(T.lastIndex=0,d.m3u8=c;(w=T.exec(c))!==null;){Y&&(Y=!1,U=new L.Fragment(s,h),U.start=_,U.sn=R,U.cc=B,U.level=u,S&&(U.initSegment=S,U.rawProgramDateTime=S.rawProgramDateTime));var z=w[1];if(z){U.duration=parseFloat(z);var V=(" "+w[2]).slice(1);U.title=V||null,U.tagList.push(V?["INF",z,V]:["INF",z])}else if(w[3])Object(M.isFiniteNumber)(U.duration)&&(U.start=_,H&&(U.levelkey=H),U.sn=R,U.level=u,U.cc=B,U.urlId=o,g.push(U),U.relurl=(" "+w[3]).slice(1),a(U,F),F=U,_+=U.duration,R++,I=0,Y=!0);else if(w[4]){var Q=(" "+w[4]).slice(1);F?U.setByteRange(Q,F):U.setByteRange(Q)}else if(w[5])U.rawProgramDateTime=(" "+w[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),j===-1&&(j=g.length);else{if(w=w[0].match(E),!w){A.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<w.length&&typeof w[K]=="undefined";K++);var X=(" "+w[K]).slice(1),$=(" "+w[K+1]).slice(1),Z=w[K+2]?(" "+w[K+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":d.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":R=d.startSN=parseInt($);break;case"SKIP":{var J=new O.AttrList($),q=J.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(q)){d.skippedSegments=q;for(var ee=q;ee--;)g.unshift(null);R+=q}var ie=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");ie&&(d.recentlyRemovedDateranges=ie.split("	"));break}case"TARGETDURATION":d.targetduration=parseFloat($);break;case"VERSION":d.version=parseInt($);break;case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":($||Z)&&U.tagList.push(Z?[$,Z]:[$]);break;case"DIS":B++;case"GAP":U.tagList.push([X]);break;case"BITRATE":U.tagList.push([X,$]);break;case"DISCONTINUITY-SEQ":B=parseInt($);break;case"KEY":{var te,ne=new O.AttrList($),le=ne.enumeratedString("METHOD"),se=ne.URI,ue=ne.hexadecimalInteger("IV"),oe=ne.enumeratedString("KEYFORMATVERSIONS"),fe=ne.enumeratedString("KEYID"),re=(te=ne.enumeratedString("KEYFORMAT"))!=null?te:"identity",xe=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(xe.indexOf(re)>-1){A.logger.warn("Keyformat "+re+" is not supported from the manifest");continue}else if(re!=="identity")continue;le&&(H=P.LevelKey.fromURL(h,se),se&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(le)>=0&&(H.method=le,H.keyFormat=re,fe&&(H.keyID=fe),oe&&(H.keyFormatVersions=oe),H.iv=ue));break}case"START":{var Le=new O.AttrList($),ye=Le.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(ye)&&(d.startTimeOffset=ye);break}case"MAP":{var he=new O.AttrList($);U.relurl=he.URI,he.BYTERANGE&&U.setByteRange(he.BYTERANGE),U.level=u,U.sn="initSegment",H&&(U.levelkey=H),U.initSegment=null,S=U,Y=!0;break}case"SERVER-CONTROL":{var ce=new O.AttrList($);d.canBlockReload=ce.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=ce.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&ce.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=ce.optionalFloat("PART-HOLD-BACK",0),d.holdBack=ce.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ee=new O.AttrList($);d.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ve=d.partList;ve||(ve=d.partList=[]);var de=I>0?ve[ve.length-1]:void 0,ge=I++,Ae=new L.Part(new O.AttrList($),U,h,ge,de);ve.push(Ae),U.duration+=Ae.duration;break}case"PRELOAD-HINT":{var De=new O.AttrList($);d.preloadHint=De;break}case"RENDITION-REPORT":{var Se=new O.AttrList($);d.renditionReports=d.renditionReports||[],d.renditionReports.push(Se);break}default:A.logger.warn("line parsed but not handled: "+w);break}}}F&&!F.relurl?(g.pop(),_-=F.duration,d.partList&&(d.fragmentHint=F)):d.partList&&(a(U,F),U.cc=B,d.fragmentHint=U);var Oe=g.length,Te=g[0],me=g[Oe-1];if(_+=d.skippedSegments*d.targetduration,_>0&&Oe&&me){d.averagetargetduration=_/Oe;var Me=me.sn;d.endSN=Me!=="initSegment"?Me:0,Te&&(d.startCC=Te.cc,Te.initSegment||d.fragments.every(function(_e){return _e.relurl&&n(_e.relurl)})&&(A.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new L.Fragment(s,h),U.relurl=me.relurl,U.level=u,U.sn="initSegment",Te.initSegment=U,d.needSidxRanges=!0))}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(_+=d.fragmentHint.duration),d.totalduration=_,d.endCC=B,j>0&&f(g,j),d},i}();function r(i,l){["video","audio","text"].forEach(function(c){var h=i.filter(function(s){return Object(m.isCodecType)(s,c)});if(h.length){var u=h.filter(function(s){return s.lastIndexOf("avc1",0)===0||s.lastIndexOf("mp4a",0)===0});l[c+"Codec"]=u.length>0?u[0]:h[0],i=i.filter(function(s){return h.indexOf(s)===-1})}}),l.unknownCodecs=i}function t(i,l,c){var h=l[c];h&&(i[c]=h)}function f(i,l){for(var c=i[l],h=l;h--;){var u=i[h];if(!u)return;u.programDateTime=c.programDateTime-u.duration*1e3,c=u}}function a(i,l){i.rawProgramDateTime?i.programDateTime=Date.parse(i.rawProgramDateTime):l!=null&&l.programDateTime&&(i.programDateTime=l.endProgramDateTime),Object(M.isFiniteNumber)(i.programDateTime)||(i.programDateTime=null,i.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(k,C,p){p.r(C);var M=p("./src/polyfills/number.ts"),D=p("./src/events.ts"),L=p("./src/errors.ts"),b=p("./src/utils/logger.ts"),P=p("./src/utils/mp4-tools.ts"),O=p("./src/loader/m3u8-parser.ts"),A=p("./src/types/loader.ts"),m=p("./src/utils/attr-list.ts");function x(E){var v=E.type;switch(v){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function y(E,v){var n=E.url;return(n===void 0||n.indexOf("data:")===0)&&(n=v.url),n}var T=function(){function E(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var v=E.prototype;return v.registerListeners=function(){var e=this.hls;e.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(D.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(D.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.unregisterListeners=function(){var e=this.hls;e.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(D.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(D.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.createInternalLoader=function(e){var r=this.hls.config,t=r.pLoader,f=r.loader,a=t||f,i=new a(r);return e.loader=i,this.loaders[e.type]=i,i},v.getInternalLoader=function(e){return this.loaders[e.type]},v.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},v.destroyInternalLoaders=function(){for(var e in this.loaders){var r=this.loaders[e];r&&r.destroy(),this.resetInternalLoader(e)}},v.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},v.onManifestLoading=function(e,r){var t=r.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:t,deliveryDirectives:null})},v.onLevelLoading=function(e,r){var t=r.id,f=r.level,a=r.url,i=r.deliveryDirectives;this.load({id:t,groupId:null,level:f,responseType:"text",type:A.PlaylistContextType.LEVEL,url:a,deliveryDirectives:i})},v.onAudioTrackLoading=function(e,r){var t=r.id,f=r.groupId,a=r.url,i=r.deliveryDirectives;this.load({id:t,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:a,deliveryDirectives:i})},v.onSubtitleTrackLoading=function(e,r){var t=r.id,f=r.groupId,a=r.url,i=r.deliveryDirectives;this.load({id:t,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:a,deliveryDirectives:i})},v.load=function(e){var r,t=this.hls.config,f=this.getInternalLoader(e);if(f){var a=f.context;if(a&&a.url===e.url){b.logger.trace("[playlist-loader]: playlist request ongoing");return}b.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}var i,l,c,h;switch(e.type){case A.PlaylistContextType.MANIFEST:i=t.manifestLoadingMaxRetry,l=t.manifestLoadingTimeOut,c=t.manifestLoadingRetryDelay,h=t.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:i=0,l=t.levelLoadingTimeOut;break;default:i=t.levelLoadingMaxRetry,l=t.levelLoadingTimeOut,c=t.levelLoadingRetryDelay,h=t.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(e),(r=e.deliveryDirectives)!==null&&r!==void 0&&r.part){var u;if(e.type===A.PlaylistContextType.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===A.PlaylistContextType.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===A.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){var s=u.partTarget,o=u.targetduration;s&&o&&(l=Math.min(Math.max(s*3,o*.8)*1e3,l))}}var d={timeout:l,maxRetry:i,retryDelay:c,maxRetryDelay:h,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,d,g)},v.loadsuccess=function(e,r,t,f){if(f===void 0&&(f=null),t.isSidxRequest){this.handleSidxRequest(e,t),this.handlePlaylistLoaded(e,r,t,f);return}this.resetInternalLoader(t.type);var a=e.data;if(a.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,t,"no EXTM3U delimiter",f);return}r.parsing.start=performance.now(),a.indexOf("#EXTINF:")>0||a.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,r,t,f):this.handleMasterPlaylist(e,r,t,f)},v.loaderror=function(e,r,t){t===void 0&&(t=null),this.handleNetworkError(r,t,!1,e)},v.loadtimeout=function(e,r,t){t===void 0&&(t=null),this.handleNetworkError(r,t,!0)},v.handleMasterPlaylist=function(e,r,t,f){var a=this.hls,i=e.data,l=y(e,t),c=O.default.parseMasterPlaylist(i,l),h=c.levels,u=c.sessionData;if(!h.length){this.handleManifestParsingError(e,t,"no level found in manifest",f);return}var s=h.map(function(I){return{id:I.attrs.AUDIO,audioCodec:I.audioCodec}}),o=h.map(function(I){return{id:I.attrs.SUBTITLES,textCodec:I.textCodec}}),d=O.default.parseMasterPlaylistMedia(i,l,"AUDIO",s),g=O.default.parseMasterPlaylistMedia(i,l,"SUBTITLES",o),S=O.default.parseMasterPlaylistMedia(i,l,"CLOSED-CAPTIONS");if(d.length){var R=d.some(function(I){return!I.url});!R&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new m.AttrList({}),bitrate:0,url:""}))}a.trigger(D.Events.MANIFEST_LOADED,{levels:h,audioTracks:d,subtitles:g,captions:S,url:l,stats:r,networkDetails:f,sessionData:u})},v.handleTrackOrLevelPlaylist=function(e,r,t,f){var a=this.hls,i=t.id,l=t.level,c=t.type,h=y(e,t),u=Object(M.isFiniteNumber)(i)?i:0,s=Object(M.isFiniteNumber)(l)?l:u,o=x(t),d=O.default.parseLevelPlaylist(e.data,h,s,o,u);if(!d.fragments.length){a.trigger(D.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:typeof t.level=="number"?t.level:void 0});return}if(c===A.PlaylistContextType.MANIFEST){var g={attrs:new m.AttrList({}),bitrate:0,details:d,name:"",url:h};a.trigger(D.Events.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:h,stats:r,networkDetails:f,sessionData:null})}if(r.parsing.end=performance.now(),d.needSidxRanges){var S,R=(S=d.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:R,isSidxRequest:!0,type:c,level:l,levelDetails:d,id:i,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}t.levelDetails=d,this.handlePlaylistLoaded(e,r,t,f)},v.handleSidxRequest=function(e,r){var t=Object(P.parseSegmentIndex)(new Uint8Array(e.data));if(!!t){var f=t.references,a=r.levelDetails;f.forEach(function(i,l){var c=i.info,h=a.fragments[l];h.byteRange.length===0&&h.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),h.initSegment&&h.initSegment.setByteRange(String(t.moovEndOffset)+"@0")})}},v.handleManifestParsingError=function(e,r,t,f){this.hls.trigger(D.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:r.type===A.PlaylistContextType.MANIFEST,url:e.url,reason:t,response:e,context:r,networkDetails:f})},v.handleNetworkError=function(e,r,t,f){t===void 0&&(t=!1),b.logger.warn("[playlist-loader]: A network "+(t?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var a=L.ErrorDetails.UNKNOWN,i=!1,l=this.getInternalLoader(e);switch(e.type){case A.PlaylistContextType.MANIFEST:a=t?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case A.PlaylistContextType.LEVEL:a=t?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case A.PlaylistContextType.AUDIO_TRACK:a=t?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:a=t?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1;break}l&&this.resetInternalLoader(e.type);var c={type:L.ErrorTypes.NETWORK_ERROR,details:a,fatal:i,url:e.url,loader:l,context:e,networkDetails:r};f&&(c.response=f),this.hls.trigger(D.Events.ERROR,c)},v.handlePlaylistLoaded=function(e,r,t,f){var a=t.type,i=t.level,l=t.id,c=t.groupId,h=t.loader,u=t.levelDetails,s=t.deliveryDirectives;if(!(u!=null&&u.targetduration)){this.handleManifestParsingError(e,t,"invalid target duration",f);return}if(!!h)switch(u.live&&(h.getCacheAge&&(u.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(u.ageHeader))&&(u.ageHeader=0)),a){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(D.Events.LEVEL_LOADED,{details:u,level:i||0,id:l||0,stats:r,networkDetails:f,deliveryDirectives:s});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(D.Events.AUDIO_TRACK_LOADED,{details:u,id:l||0,groupId:c||"",stats:r,networkDetails:f,deliveryDirectives:s});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADED,{details:u,id:l||0,groupId:c||"",stats:r,networkDetails:f,deliveryDirectives:s});break}},E}();C.default=T},"./src/polyfills/number.ts":function(k,C,p){p.r(C),p.d(C,"isFiniteNumber",function(){return M}),p.d(C,"MAX_SAFE_INTEGER",function(){return D});var M=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},D=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(k,C,p){p.r(C);var M=function(){function D(){}return D.getSilentFrame=function(b,P){switch(b){case"mp4a.40.2":if(P===1)return new Uint8Array([0,200,0,128,35,128]);if(P===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(P===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(P===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(P===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(P===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(P===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},D}();C.default=M},"./src/remux/mp4-generator.ts":function(k,C,p){p.r(C);var M=Math.pow(2,32)-1,D=function(){function L(){}return L.init=function(){L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var P;for(P in L.types)L.types.hasOwnProperty(P)&&(L.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var O=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:O,audio:A};var m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=x,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),E=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,y,E,y,T),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,m))},L.box=function(P){for(var O=8,A=arguments.length,m=new Array(A>1?A-1:0),x=1;x<A;x++)m[x-1]=arguments[x];for(var y=m.length,T=y;y--;)O+=m[y].byteLength;var E=new Uint8Array(O);for(E[0]=O>>24&255,E[1]=O>>16&255,E[2]=O>>8&255,E[3]=O&255,E.set(P,4),y=0,O=8;y<T;y++)E.set(m[y],O),O+=m[y].byteLength;return E},L.hdlr=function(P){return L.box(L.types.hdlr,L.HDLR_TYPES[P])},L.mdat=function(P){return L.box(L.types.mdat,P)},L.mdhd=function(P,O){O*=P;var A=Math.floor(O/(M+1)),m=Math.floor(O%(M+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,A>>24,A>>16&255,A>>8&255,A&255,m>>24,m>>16&255,m>>8&255,m&255,85,196,0,0]))},L.mdia=function(P){return L.box(L.types.mdia,L.mdhd(P.timescale,P.duration),L.hdlr(P.type),L.minf(P))},L.mfhd=function(P){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255]))},L.minf=function(P){return P.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(P)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(P))},L.moof=function(P,O,A){return L.box(L.types.moof,L.mfhd(P),L.traf(A,O))},L.moov=function(P){for(var O=P.length,A=[];O--;)A[O]=L.trak(P[O]);return L.box.apply(null,[L.types.moov,L.mvhd(P[0].timescale,P[0].duration)].concat(A).concat(L.mvex(P)))},L.mvex=function(P){for(var O=P.length,A=[];O--;)A[O]=L.trex(P[O]);return L.box.apply(null,[L.types.mvex].concat(A))},L.mvhd=function(P,O){O*=P;var A=Math.floor(O/(M+1)),m=Math.floor(O%(M+1)),x=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,A>>24,A>>16&255,A>>8&255,A&255,m>>24,m>>16&255,m>>8&255,m&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,x)},L.sdtp=function(P){var O=P.samples||[],A=new Uint8Array(4+O.length),m,x;for(m=0;m<O.length;m++)x=O[m].flags,A[m+4]=x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy;return L.box(L.types.sdtp,A)},L.stbl=function(P){return L.box(L.types.stbl,L.stsd(P),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(P){var O=[],A=[],m,x,y;for(m=0;m<P.sps.length;m++)x=P.sps[m],y=x.byteLength,O.push(y>>>8&255),O.push(y&255),O=O.concat(Array.prototype.slice.call(x));for(m=0;m<P.pps.length;m++)x=P.pps[m],y=x.byteLength,A.push(y>>>8&255),A.push(y&255),A=A.concat(Array.prototype.slice.call(x));var T=L.box(L.types.avcC,new Uint8Array([1,O[3],O[4],O[5],255,224|P.sps.length].concat(O).concat([P.pps.length]).concat(A))),E=P.width,v=P.height,n=P.pixelRatio[0],e=P.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,E>>8&255,E&255,v>>8&255,v&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255])))},L.esds=function(P){var O=P.config.length;return new Uint8Array([0,0,0,0,3,23+O,0,1,0,4,15+O,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([O]).concat(P.config).concat([6,1,2]))},L.mp4a=function(P){var O=P.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]),L.box(L.types.esds,L.esds(P)))},L.mp3=function(P){var O=P.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]))},L.stsd=function(P){return P.type==="audio"?!P.isAAC&&P.codec==="mp3"?L.box(L.types.stsd,L.STSD,L.mp3(P)):L.box(L.types.stsd,L.STSD,L.mp4a(P)):L.box(L.types.stsd,L.STSD,L.avc1(P))},L.tkhd=function(P){var O=P.id,A=P.duration*P.timescale,m=P.width,x=P.height,y=Math.floor(A/(M+1)),T=Math.floor(A%(M+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,O&255,0,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,T>>24,T>>16&255,T>>8&255,T&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,m>>8&255,m&255,0,0,x>>8&255,x&255,0,0]))},L.traf=function(P,O){var A=L.sdtp(P),m=P.id,x=Math.floor(O/(M+1)),y=Math.floor(O%(M+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,x>>24,x>>16&255,x>>8&255,x&255,y>>24,y>>16&255,y>>8&255,y&255])),L.trun(P,A.length+16+20+8+16+8+8),A)},L.trak=function(P){return P.duration=P.duration||4294967295,L.box(L.types.trak,L.tkhd(P),L.mdia(P))},L.trex=function(P){var O=P.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,O&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(P,O){var A=P.samples||[],m=A.length,x=12+16*m,y=new Uint8Array(x),T,E,v,n,e,r;for(O+=8+x,y.set([0,0,15,1,m>>>24&255,m>>>16&255,m>>>8&255,m&255,O>>>24&255,O>>>16&255,O>>>8&255,O&255],0),T=0;T<m;T++)E=A[T],v=E.duration,n=E.size,e=E.flags,r=E.cts,y.set([v>>>24&255,v>>>16&255,v>>>8&255,v&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*T);return L.box(L.types.trun,y)},L.initSegment=function(P){L.types||L.init();var O=L.moov(P),A=new Uint8Array(L.FTYP.byteLength+O.byteLength);return A.set(L.FTYP),A.set(O,L.FTYP.byteLength),A},L}();D.types=void 0,D.HDLR_TYPES=void 0,D.STTS=void 0,D.STSC=void 0,D.STCO=void 0,D.STSZ=void 0,D.VMHD=void 0,D.SMHD=void 0,D.STSD=void 0,D.FTYP=void 0,D.DINF=void 0,C.default=D},"./src/remux/mp4-remuxer.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return r}),p.d(C,"normalizePts",function(){return t});var M=p("./src/polyfills/number.ts"),D=p("./src/remux/aac-helper.ts"),L=p("./src/remux/mp4-generator.ts"),b=p("./src/events.ts"),P=p("./src/errors.ts"),O=p("./src/utils/logger.ts"),A=p("./src/types/loader.ts"),m=p("./src/utils/timescale-conversion.ts");function x(){return x=Object.assign||function(l){for(var c=1;c<arguments.length;c++){var h=arguments[c];for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(l[u]=h[u])}return l},x.apply(this,arguments)}var y=10*1e3,T=1024,E=1152,v=null,n=null,e=!1,r=function(){function l(h,u,s,o){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=h,this.config=u,this.typeSupported=s,this.ISGenerated=!1,v===null){var d=navigator.userAgent||"",g=d.match(/Chrome\/(\d+)/i);v=g?parseInt(g[1]):0}if(n===null){var S=navigator.userAgent.match(/Safari\/(\d+)/i);n=S?parseInt(S[1]):0}e=!!v&&v<75||!!n&&n<600}var c=l.prototype;return c.destroy=function(){},c.resetTimeStamp=function(u){O.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=u},c.resetNextTimestamp=function(){O.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},c.resetInitSegment=function(){O.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},c.getVideoStartPts=function(u){var s=!1,o=u.reduce(function(d,g){var S=g.pts-d;return S<-4294967296?(s=!0,t(d,g.pts)):S>0?d:g.pts},u[0].pts);return s&&O.logger.debug("PTS rollover detected"),o},c.remux=function(u,s,o,d,g,S,R,I){var _,B,F,U,w,K,H=g,j=g,Y=u.pid>-1,z=s.pid>-1,V=s.samples.length,Q=u.samples.length>0,X=V>1,$=(!Y||Q)&&(!z||X)||this.ISGenerated||R;if($){this.ISGenerated||(F=this.generateIS(u,s,g));var Z=this.isVideoContiguous,J=-1;if(X&&(J=f(s.samples),!Z&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,J>0){O.logger.warn("[mp4-remuxer]: Dropped "+J+" out of "+V+" video samples due to a missing keyframe");var q=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(J),s.dropped+=J,j+=(s.samples[0].pts-q)/(s.timescale||9e4)}else J===-1&&(O.logger.warn("[mp4-remuxer]: No keyframe found out of "+V+" video samples"),K=!1);if(this.ISGenerated){if(Q&&X){var ee=this.getVideoStartPts(s.samples),ie=t(u.samples[0].pts,ee)-ee,te=ie/s.inputTimeScale;H+=Math.max(0,te),j+=Math.max(0,-te)}if(Q){if(u.samplerate||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),F=this.generateIS(u,s,g)),B=this.remuxAudio(u,H,this.isAudioContiguous,S,z||X||I===A.PlaylistLevelType.AUDIO?j:void 0),X){var ne=B?B.endPTS-B.startPTS:0;s.inputTimeScale||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),F=this.generateIS(u,s,g)),_=this.remuxVideo(s,j,Z,ne)}}else X&&(_=this.remuxVideo(s,j,Z,0));_&&(_.firstKeyFrame=J,_.independent=J!==-1)}}return this.ISGenerated&&(o.samples.length&&(w=this.remuxID3(o,g)),d.samples.length&&(U=this.remuxText(d,g))),{audio:B,video:_,initSegment:F,independent:K,text:U,id3:w}},c.generateIS=function(u,s,o){var d=u.samples,g=s.samples,S=this.typeSupported,R={},I=!Object(M.isFiniteNumber)(this._initPTS),_="audio/mp4",B,F,U;if(I&&(B=F=1/0),u.config&&d.length&&(u.timescale=u.samplerate,u.isAAC||(S.mpeg?(_="audio/mpeg",u.codec=""):S.mp3&&(u.codec="mp3")),R.audio={id:"audio",container:_,codec:u.codec,initSegment:!u.isAAC&&S.mpeg?new Uint8Array(0):L.default.initSegment([u]),metadata:{channelCount:u.channelCount}},I&&(U=u.inputTimeScale,B=F=d[0].pts-Math.round(U*o))),s.sps&&s.pps&&g.length&&(s.timescale=s.inputTimeScale,R.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:L.default.initSegment([s]),metadata:{width:s.width,height:s.height}},I)){U=s.inputTimeScale;var w=this.getVideoStartPts(g),K=Math.round(U*o);F=Math.min(F,t(g[0].dts,w)-K),B=Math.min(B,w-K)}if(Object.keys(R).length)return this.ISGenerated=!0,I&&(this._initPTS=B,this._initDTS=F),{tracks:R,initPTS:B,timescale:U}},c.remuxVideo=function(u,s,o,d){var g=u.inputTimeScale,S=u.samples,R=[],I=S.length,_=this._initPTS,B=this.nextAvcDts,F=8,U,w,K,H=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,Y=0,z=!1;if(!o||B===null){var V=s*g,Q=S[0].pts-t(S[0].dts,S[0].pts);B=V-Q}for(var X=0;X<I;X++){var $=S[X];if($.pts=t($.pts-_,B),$.dts=t($.dts-_,B),$.dts>$.pts){var Z=18e3;Y=Math.max(Math.min(Y,$.pts-$.dts),-1*Z)}$.dts<S[X>0?X-1:X].dts&&(z=!0)}z&&S.sort(function(Ke,ze){var Zt=Ke.dts-ze.dts,Jt=Ke.pts-ze.pts;return Zt||Jt}),w=S[0].dts,K=S[S.length-1].dts;var J=Math.round((K-w)/(I-1));if(Y<0){if(Y<J*-2){O.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(m.toMsFromMpegTsClock)(-J,!0)+" ms");for(var q=Y,ee=0;ee<I;ee++)S[ee].dts=q=Math.max(q,S[ee].pts-J),S[ee].pts=Math.max(q,S[ee].pts)}else{O.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(m.toMsFromMpegTsClock)(Y,!0)+" ms to overcome this issue");for(var ie=0;ie<I;ie++)S[ie].dts=S[ie].dts+Y}w=S[0].dts}if(o){var te=w-B,ne=te>J,le=te<-1;if(ne||le){ne?O.logger.warn("AVC: "+Object(m.toMsFromMpegTsClock)(te,!0)+" ms ("+te+"dts) hole between fragments detected, filling it"):O.logger.warn("AVC: "+Object(m.toMsFromMpegTsClock)(-te,!0)+" ms ("+te+"dts) overlapping between fragments detected"),w=B;var se=S[0].pts-te;S[0].dts=w,S[0].pts=se,O.logger.log("Video: First PTS/DTS adjusted: "+Object(m.toMsFromMpegTsClock)(se,!0)+"/"+Object(m.toMsFromMpegTsClock)(w,!0)+", delta: "+Object(m.toMsFromMpegTsClock)(te,!0)+" ms")}}e&&(w=Math.max(0,w));for(var ue=0,oe=0,fe=0;fe<I;fe++){for(var re=S[fe],xe=re.units,Le=xe.length,ye=0,he=0;he<Le;he++)ye+=xe[he].data.length;oe+=ye,ue+=Le,re.length=ye,re.dts=Math.max(re.dts,w),re.pts=Math.max(re.pts,re.dts,0),H=Math.min(re.pts,H),j=Math.max(re.pts,j)}K=S[I-1].dts;var ce=oe+4*ue+8,Ee;try{Ee=new Uint8Array(ce)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ce,reason:"fail allocating video mdat "+ce});return}var ve=new DataView(Ee.buffer);ve.setUint32(0,ce),Ee.set(L.default.types.mdat,4);for(var de=0;de<I;de++){for(var ge=S[de],Ae=ge.units,De=0,Se=0,Oe=Ae.length;Se<Oe;Se++){var Te=Ae[Se],me=Te.data,Me=Te.data.byteLength;ve.setUint32(F,Me),F+=4,Ee.set(me,F),F+=Me,De+=4+Me}if(de<I-1)U=S[de+1].dts-ge.dts;else{var _e=this.config,Fe=ge.dts-S[de>0?de-1:de].dts;if(_e.stretchShortVideoTrack&&this.nextAudioPts!==null){var Yt=Math.floor(_e.maxBufferHole*g),we=(d?H+d*g:this.nextAudioPts)-ge.pts;we>Yt?(U=we-Fe,U<0&&(U=Fe),O.logger.log("[mp4-remuxer]: It is approximately "+we/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=Fe}else U=Fe}var zt=Math.round(ge.pts-ge.dts);R.push(new a(ge.key,U,De,zt))}if(R.length&&v&&v<70){var Ye=R[0].flags;Ye.dependsOn=2,Ye.isNonSync=0}console.assert(U!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=B=K+U,this.isVideoContiguous=!0;var Xt=L.default.moof(u.sequenceNumber++,w,x({},u,{samples:R})),$t="video",Qt={data1:Xt,data2:Ee,startPTS:H/g,endPTS:(j+U)/g,startDTS:w/g,endDTS:B/g,type:$t,hasAudio:!1,hasVideo:!0,nb:R.length,dropped:u.dropped};return u.samples=[],u.dropped=0,console.assert(Ee.length,"MDAT length must not be zero"),Qt},c.remuxAudio=function(u,s,o,d,g){var S=u.inputTimeScale,R=u.samplerate?u.samplerate:S,I=S/R,_=u.isAAC?T:E,B=_*I,F=this._initPTS,U=!u.isAAC&&this.typeSupported.mpeg,w=[],K=u.samples,H=U?0:8,j=this.nextAudioPts||-1,Y=s*S;if(this.isAudioContiguous=o=o||K.length&&j>0&&(d&&Math.abs(Y-j)<9e3||Math.abs(t(K[0].pts-F,Y)-j)<20*B),K.forEach(function(me){me.pts=t(me.pts-F,Y)}),!o||j<0){if(K=K.filter(function(me){return me.pts>=0}),!K.length)return;g===0?j=0:d?j=Math.max(0,Y):j=K[0].pts}if(u.isAAC)for(var z=g!==void 0,V=this.config.maxAudioFramesDrift,Q=0,X=j;Q<K.length;Q++){var $=K[Q],Z=$.pts,J=Z-X,q=Math.abs(1e3*J/S);if(J<=-V*B&&z)Q===0&&(O.logger.warn("Audio frame @ "+(Z/S).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*J/S)+" ms."),this.nextAudioPts=j=X=Z);else if(J>=V*B&&q<y&&z){var ee=Math.round(J/B);X=Z-ee*B,X<0&&(ee--,X+=B),Q===0&&(this.nextAudioPts=j=X),O.logger.warn("[mp4-remuxer]: Injecting "+ee+" audio frame @ "+(X/S).toFixed(3)+"s due to "+Math.round(1e3*J/S)+" ms gap.");for(var ie=0;ie<ee;ie++){var te=Math.max(X,0),ne=D.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);ne||(O.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ne=$.unit.subarray()),K.splice(Q,0,{unit:ne,pts:te}),X+=B,Q++}}$.pts=X,X+=B}for(var le=null,se=null,ue,oe=0,fe=K.length;fe--;)oe+=K[fe].unit.byteLength;for(var re=0,xe=K.length;re<xe;re++){var Le=K[re],ye=Le.unit,he=Le.pts;if(se!==null){var ce=w[re-1];ce.duration=Math.round((he-se)/I)}else if(o&&u.isAAC&&(he=j),le=he,oe>0){oe+=H;try{ue=new Uint8Array(oe)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:oe,reason:"fail allocating audio mdat "+oe});return}if(!U){var Ee=new DataView(ue.buffer);Ee.setUint32(0,oe),ue.set(L.default.types.mdat,4)}}else return;ue.set(ye,H);var ve=ye.byteLength;H+=ve,w.push(new a(!0,_,ve,0)),se=he}var de=w.length;if(!!de){var ge=w[w.length-1];this.nextAudioPts=j=se+I*ge.duration;var Ae=U?new Uint8Array(0):L.default.moof(u.sequenceNumber++,le/I,x({},u,{samples:w}));u.samples=[];var De=le/S,Se=j/S,Oe="audio",Te={data1:Ae,data2:ue,startPTS:De,endPTS:Se,startDTS:De,endDTS:Se,type:Oe,hasAudio:!0,hasVideo:!1,nb:de};return this.isAudioContiguous=!0,console.assert(ue.length,"MDAT length must not be zero"),Te}},c.remuxEmptyAudio=function(u,s,o,d){var g=u.inputTimeScale,S=u.samplerate?u.samplerate:g,R=g/S,I=this.nextAudioPts,_=(I!==null?I:d.startDTS*g)+this._initDTS,B=d.endDTS*g+this._initDTS,F=R*T,U=Math.ceil((B-_)/F),w=D.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);if(O.logger.warn("[mp4-remuxer]: remux empty Audio"),!w){O.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],H=0;H<U;H++){var j=_+H*F;K.push({unit:w,pts:j,dts:j})}return u.samples=K,this.remuxAudio(u,s,o,!1)},c.remuxID3=function(u,s){var o=u.samples.length;if(!!o){for(var d=u.inputTimeScale,g=this._initPTS,S=this._initDTS,R=0;R<o;R++){var I=u.samples[R];I.pts=t(I.pts-g,s*d)/d,I.dts=t(I.dts-S,s*d)/d}var _=u.samples;return u.samples=[],{samples:_}}},c.remuxText=function(u,s){var o=u.samples.length;if(!!o){for(var d=u.inputTimeScale,g=this._initPTS,S=0;S<o;S++){var R=u.samples[S];R.pts=t(R.pts-g,s*d)/d}u.samples.sort(function(_,B){return _.pts-B.pts});var I=u.samples;return u.samples=[],{samples:I}}},l}();function t(l,c){var h;if(c===null)return l;for(c<l?h=-8589934592:h=8589934592;Math.abs(l-c)>4294967296;)l+=h;return l}function f(l){for(var c=0;c<l.length;c++)if(l[c].key)return c;return-1}var a=function(c,h,u,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=h,this.size=u,this.cts=s,this.flags=new i(c)},i=function(c){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=c?2:1,this.isNonSync=c?0:1}},"./src/remux/passthrough-remuxer.ts":function(k,C,p){p.r(C);var M=p("./src/polyfills/number.ts"),D=p("./src/utils/mp4-tools.ts"),L=p("./src/loader/fragment.ts"),b=p("./src/utils/logger.ts"),P=function(){function m(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var x=m.prototype;return x.destroy=function(){},x.resetTimeStamp=function(T){this.initPTS=T,this.lastEndDTS=null},x.resetNextTimestamp=function(){this.lastEndDTS=null},x.resetInitSegment=function(T,E,v){this.audioCodec=E,this.videoCodec=v,this.generateInitSegment(T),this.emitInitSegment=!0},x.generateInitSegment=function(T){var E=this.audioCodec,v=this.videoCodec;if(!T||!T.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=Object(D.parseInitSegment)(T);E||(E=A(n.audio,L.ElementaryStreamTypes.AUDIO)),v||(v=A(n.video,L.ElementaryStreamTypes.VIDEO));var e={};n.audio&&n.video?e.audiovideo={container:"video/mp4",codec:E+","+v,initSegment:T,id:"main"}:n.audio?e.audio={container:"audio/mp4",codec:E,initSegment:T,id:"audio"}:n.video?e.video={container:"video/mp4",codec:v,initSegment:T,id:"main"}:b.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},x.remux=function(T,E,v,n,e){var r=this.initPTS,t=this.lastEndDTS,f={audio:void 0,video:void 0,text:n,id3:v,initSegment:void 0};Object(M.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var a=E.samples;if(!a||!a.length)return f;var i={initPTS:void 0,timescale:1},l=this.initData;if((!l||!l.length)&&(this.generateInitSegment(a),l=this.initData),!l||!l.length)return b.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(i.tracks=this.initTracks,this.emitInitSegment=!1),Object(M.isFiniteNumber)(r)||(this.initPTS=i.initPTS=r=O(l,a,t));var c=Object(D.getDuration)(a,l),h=t,u=c+h;Object(D.offsetStartDTS)(l,a,r),c>0?this.lastEndDTS=u:(b.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var s=!!l.audio,o=!!l.video,d="";s&&(d+="audio"),o&&(d+="video");var g={data1:a,startPTS:h,startDTS:h,endPTS:u,endDTS:u,type:d,hasAudio:s,hasVideo:o,nb:1,dropped:0};return f.audio=g.type==="audio"?g:void 0,f.video=g.type!=="audio"?g:void 0,f.text=n,f.id3=v,f.initSegment=i,f},m}(),O=function(x,y,T){return Object(D.getStartDTS)(x,y)-T};function A(m,x){var y=m==null?void 0:m.codec;return y&&y.length>4?y:y==="hvc1"?"hvc1.1.c.L120.90":y==="av01"?"av01.0.04M.08":y==="avc1"||x===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=P},"./src/task-loop.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return M});var M=function(){function D(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=D.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(P){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,P),!0)},L.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},L.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},D}()},"./src/types/cmcd.ts":function(k,C,p){p.r(C),p.d(C,"CMCDVersion",function(){return M}),p.d(C,"CMCDObjectType",function(){return D}),p.d(C,"CMCDStreamingFormat",function(){return L}),p.d(C,"CMCDStreamType",function(){return b});var M=1,D;(function(P){P.MANIFEST="m",P.AUDIO="a",P.VIDEO="v",P.MUXED="av",P.INIT="i",P.CAPTION="c",P.TIMED_TEXT="tt",P.KEY="k",P.OTHER="o"})(D||(D={}));var L;(function(P){P.DASH="d",P.HLS="h",P.SMOOTH="s",P.OTHER="o"})(L||(L={}));var b;(function(P){P.VOD="v",P.LIVE="l"})(b||(b={}))},"./src/types/level.ts":function(k,C,p){p.r(C),p.d(C,"HlsSkip",function(){return L}),p.d(C,"getSkipValue",function(){return b}),p.d(C,"HlsUrlParameters",function(){return P}),p.d(C,"Level",function(){return O});function M(A,m){for(var x=0;x<m.length;x++){var y=m[x];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(A,y.key,y)}}function D(A,m,x){return m&&M(A.prototype,m),x&&M(A,x),A}var L;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(L||(L={}));function b(A,m){var x=A.canSkipUntil,y=A.canSkipDateRanges,T=A.endSN,E=m!==void 0?m-T:0;return x&&E<x?y?L.v2:L.Yes:L.No}var P=function(){function A(x,y,T){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=x,this.part=y,this.skip=T}var m=A.prototype;return m.addDirectives=function(y){var T=new self.URL(y);return this.msn!==void 0&&T.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},A}(),O=function(){function A(m){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[m.url],this.attrs=m.attrs,this.bitrate=m.bitrate,m.details&&(this.details=m.details),this.id=m.id||0,this.name=m.name,this.width=m.width||0,this.height=m.height||0,this.audioCodec=m.audioCodec,this.videoCodec=m.videoCodec,this.unknownCodecs=m.unknownCodecs,this.codecSet=[m.videoCodec,m.audioCodec].filter(function(x){return x}).join(",").replace(/\.[^.,]+/g,"")}return D(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(x){var y=x%this.url.length;this._urlId!==y&&(this.details=void 0,this._urlId=y)}}]),A}()},"./src/types/loader.ts":function(k,C,p){p.r(C),p.d(C,"PlaylistContextType",function(){return M}),p.d(C,"PlaylistLevelType",function(){return D});var M;(function(L){L.MANIFEST="manifest",L.LEVEL="level",L.AUDIO_TRACK="audioTrack",L.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var D;(function(L){L.MAIN="main",L.AUDIO="audio",L.SUBTITLE="subtitle"})(D||(D={}))},"./src/types/transmuxer.ts":function(k,C,p){p.r(C),p.d(C,"ChunkMetadata",function(){return M});var M=function(b,P,O,A,m,x){A===void 0&&(A=0),m===void 0&&(m=-1),x===void 0&&(x=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=D(),this.buffering={audio:D(),video:D(),audiovideo:D()},this.level=b,this.sn=P,this.id=O,this.size=A,this.part=m,this.partial=x};function D(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(k,C,p){p.r(C),p.d(C,"AttrList",function(){return L});var M=/^(\d+)x(\d+)$/,D=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function b(O){typeof O=="string"&&(O=b.parseAttrList(O));for(var A in O)O.hasOwnProperty(A)&&(this[A]=O[A])}var P=b.prototype;return P.decimalInteger=function(A){var m=parseInt(this[A],10);return m>Number.MAX_SAFE_INTEGER?1/0:m},P.hexadecimalInteger=function(A){if(this[A]){var m=(this[A]||"0x").slice(2);m=(m.length&1?"0":"")+m;for(var x=new Uint8Array(m.length/2),y=0;y<m.length/2;y++)x[y]=parseInt(m.slice(y*2,y*2+2),16);return x}else return null},P.hexadecimalIntegerAsNumber=function(A){var m=parseInt(this[A],16);return m>Number.MAX_SAFE_INTEGER?1/0:m},P.decimalFloatingPoint=function(A){return parseFloat(this[A])},P.optionalFloat=function(A,m){var x=this[A];return x?parseFloat(x):m},P.enumeratedString=function(A){return this[A]},P.bool=function(A){return this[A]==="YES"},P.decimalResolution=function(A){var m=M.exec(this[A]);if(m!==null)return{width:parseInt(m[1],10),height:parseInt(m[2],10)}},b.parseAttrList=function(A){var m,x={},y='"';for(D.lastIndex=0;(m=D.exec(A))!==null;){var T=m[2];T.indexOf(y)===0&&T.lastIndexOf(y)===T.length-1&&(T=T.slice(1,-1)),x[m[1]]=T}return x},b}()},"./src/utils/binary-search.ts":function(k,C,p){p.r(C);var M={search:function(L,b){for(var P=0,O=L.length-1,A=null,m=null;P<=O;){A=(P+O)/2|0,m=L[A];var x=b(m);if(x>0)P=A+1;else if(x<0)O=A-1;else return m}return null}};C.default=M},"./src/utils/buffer-helper.ts":function(k,C,p){p.r(C),p.d(C,"BufferHelper",function(){return L});var M=p("./src/utils/logger.ts"),D={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function b(){}return b.isBuffered=function(O,A){try{if(O){for(var m=b.getBuffered(O),x=0;x<m.length;x++)if(A>=m.start(x)&&A<=m.end(x))return!0}}catch{}return!1},b.bufferInfo=function(O,A,m){try{if(O){var x=b.getBuffered(O),y=[],T;for(T=0;T<x.length;T++)y.push({start:x.start(T),end:x.end(T)});return this.bufferedInfo(y,A,m)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},b.bufferedInfo=function(O,A,m){A=Math.max(0,A),O.sort(function(i,l){var c=i.start-l.start;return c||l.end-i.end});var x=[];if(m)for(var y=0;y<O.length;y++){var T=x.length;if(T){var E=x[T-1].end;O[y].start-E<m?O[y].end>E&&(x[T-1].end=O[y].end):x.push(O[y])}else x.push(O[y])}else x=O;for(var v=0,n,e=A,r=A,t=0;t<x.length;t++){var f=x[t].start,a=x[t].end;if(A+m>=f&&A<a)e=f,r=a,v=r-A;else if(A+m<f){n=f;break}}return{len:v,start:e||0,end:r||0,nextStart:n}},b.getBuffered=function(O){try{return O.buffered}catch(A){return M.logger.log("failed to get media.buffered",A),D}},b}()},"./src/utils/cea-608-parser.ts":function(k,C,p){p.r(C),p.d(C,"Row",function(){return r}),p.d(C,"CaptionScreen",function(){return t});var M=p("./src/utils/logger.ts"),D={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},L=function(u){var s=u;return D.hasOwnProperty(u)&&(s=D[u]),String.fromCharCode(s)},b=15,P=100,O={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},m={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},x={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],T;(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(T||(T={}));var E=function(){function h(){this.time=null,this.verboseLevel=T.ERROR}var u=h.prototype;return u.log=function(o,d){this.verboseLevel>=o&&M.logger.log(this.time+" ["+o+"] "+d)},h}(),v=function(u){for(var s=[],o=0;o<u.length;o++)s.push(u[o].toString(16));return s},n=function(){function h(s,o,d,g,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=s||"white",this.underline=o||!1,this.italics=d||!1,this.background=g||"black",this.flash=S||!1}var u=h.prototype;return u.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},u.setStyles=function(o){for(var d=["foreground","underline","italics","background","flash"],g=0;g<d.length;g++){var S=d[g];o.hasOwnProperty(S)&&(this[S]=o[S])}},u.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},u.equals=function(o){return this.foreground===o.foreground&&this.underline===o.underline&&this.italics===o.italics&&this.background===o.background&&this.flash===o.flash},u.copy=function(o){this.foreground=o.foreground,this.underline=o.underline,this.italics=o.italics,this.background=o.background,this.flash=o.flash},u.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),e=function(){function h(s,o,d,g,S,R){this.uchar=void 0,this.penState=void 0,this.uchar=s||" ",this.penState=new n(o,d,g,S,R)}var u=h.prototype;return u.reset=function(){this.uchar=" ",this.penState.reset()},u.setChar=function(o,d){this.uchar=o,this.penState.copy(d)},u.setPenState=function(o){this.penState.copy(o)},u.equals=function(o){return this.uchar===o.uchar&&this.penState.equals(o.penState)},u.copy=function(o){this.uchar=o.uchar,this.penState.copy(o.penState)},u.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),r=function(){function h(s){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var o=0;o<P;o++)this.chars.push(new e);this.logger=s,this.pos=0,this.currPenState=new n}var u=h.prototype;return u.equals=function(o){for(var d=!0,g=0;g<P;g++)if(!this.chars[g].equals(o.chars[g])){d=!1;break}return d},u.copy=function(o){for(var d=0;d<P;d++)this.chars[d].copy(o.chars[d])},u.isEmpty=function(){for(var o=!0,d=0;d<P;d++)if(!this.chars[d].isEmpty()){o=!1;break}return o},u.setCursor=function(o){this.pos!==o&&(this.pos=o),this.pos<0?(this.logger.log(T.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>P&&(this.logger.log(T.DEBUG,"Too large cursor position "+this.pos),this.pos=P)},u.moveCursor=function(o){var d=this.pos+o;if(o>1)for(var g=this.pos+1;g<d+1;g++)this.chars[g].setPenState(this.currPenState);this.setCursor(d)},u.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},u.insertChar=function(o){o>=144&&this.backSpace();var d=L(o);if(this.pos>=P){this.logger.log(T.ERROR,"Cannot insert "+o.toString(16)+" ("+d+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(d,this.currPenState),this.moveCursor(1)},u.clearFromPos=function(o){var d;for(d=o;d<P;d++)this.chars[d].reset()},u.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},u.clearToEndOfRow=function(){this.clearFromPos(this.pos)},u.getTextString=function(){for(var o=[],d=!0,g=0;g<P;g++){var S=this.chars[g].uchar;S!==" "&&(d=!1),o.push(S)}return d?"":o.join("")},u.setPenStyles=function(o){this.currPenState.setStyles(o);var d=this.chars[this.pos];d.setPenState(this.currPenState)},h}(),t=function(){function h(s){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var o=0;o<b;o++)this.rows.push(new r(s));this.logger=s,this.currRow=b-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var u=h.prototype;return u.reset=function(){for(var o=0;o<b;o++)this.rows[o].clear();this.currRow=b-1},u.equals=function(o){for(var d=!0,g=0;g<b;g++)if(!this.rows[g].equals(o.rows[g])){d=!1;break}return d},u.copy=function(o){for(var d=0;d<b;d++)this.rows[d].copy(o.rows[d])},u.isEmpty=function(){for(var o=!0,d=0;d<b;d++)if(!this.rows[d].isEmpty()){o=!1;break}return o},u.backSpace=function(){var o=this.rows[this.currRow];o.backSpace()},u.clearToEndOfRow=function(){var o=this.rows[this.currRow];o.clearToEndOfRow()},u.insertChar=function(o){var d=this.rows[this.currRow];d.insertChar(o)},u.setPen=function(o){var d=this.rows[this.currRow];d.setPenStyles(o)},u.moveCursor=function(o){var d=this.rows[this.currRow];d.moveCursor(o)},u.setCursor=function(o){this.logger.log(T.INFO,"setCursor: "+o);var d=this.rows[this.currRow];d.setCursor(o)},u.setPAC=function(o){this.logger.log(T.INFO,"pacData = "+JSON.stringify(o));var d=o.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var g=0;g<b;g++)this.rows[g].clear();var S=this.currRow+1-this.nrRollUpRows,R=this.lastOutputScreen;if(R){var I=R.rows[S].cueStartTime,_=this.logger.time;if(I&&_!==null&&I<_)for(var B=0;B<this.nrRollUpRows;B++)this.rows[d-this.nrRollUpRows+B+1].copy(R.rows[S+B])}}this.currRow=d;var F=this.rows[this.currRow];if(o.indent!==null){var U=o.indent,w=Math.max(U-1,0);F.setCursor(o.indent),o.color=F.chars[w].penState.foreground}var K={foreground:o.color,underline:o.underline,italics:o.italics,background:"black",flash:!1};this.setPen(K)},u.setBkgData=function(o){this.logger.log(T.INFO,"bkgData = "+JSON.stringify(o)),this.backSpace(),this.setPen(o),this.insertChar(32)},u.setRollUpRows=function(o){this.nrRollUpRows=o},u.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(T.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(T.TEXT,this.getDisplayText());var o=this.currRow+1-this.nrRollUpRows,d=this.rows.splice(o,1)[0];d.clear(),this.rows.splice(this.currRow,0,d),this.logger.log(T.INFO,"Rolling up")},u.getDisplayText=function(o){o=o||!1;for(var d=[],g="",S=-1,R=0;R<b;R++){var I=this.rows[R].getTextString();I&&(S=R+1,o?d.push("Row "+S+": '"+I+"'"):d.push(I.trim()))}return d.length>0&&(o?g="["+d.join(" | ")+"]":g=d.join(`
`)),g},u.getTextAndFormat=function(){return this.rows},h}(),f=function(){function h(s,o,d){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=s,this.outputFilter=o,this.mode=null,this.verbose=0,this.displayedMemory=new t(d),this.nonDisplayedMemory=new t(d),this.lastOutputScreen=new t(d),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=d}var u=h.prototype;return u.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},u.getHandler=function(){return this.outputFilter},u.setHandler=function(o){this.outputFilter=o},u.setPAC=function(o){this.writeScreen.setPAC(o)},u.setBkgData=function(o){this.writeScreen.setBkgData(o)},u.setMode=function(o){o!==this.mode&&(this.mode=o,this.logger.log(T.INFO,"MODE="+o),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=o)},u.insertChars=function(o){for(var d=0;d<o.length;d++)this.writeScreen.insertChar(o[d]);var g=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(T.INFO,g+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(T.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},u.ccRCL=function(){this.logger.log(T.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},u.ccBS=function(){this.logger.log(T.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},u.ccAOF=function(){},u.ccAON=function(){},u.ccDER=function(){this.logger.log(T.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},u.ccRU=function(o){this.logger.log(T.INFO,"RU("+o+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(o)},u.ccFON=function(){this.logger.log(T.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},u.ccRDC=function(){this.logger.log(T.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},u.ccTR=function(){this.logger.log(T.INFO,"TR"),this.setMode("MODE_TEXT")},u.ccRTD=function(){this.logger.log(T.INFO,"RTD"),this.setMode("MODE_TEXT")},u.ccEDM=function(){this.logger.log(T.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},u.ccCR=function(){this.logger.log(T.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},u.ccENM=function(){this.logger.log(T.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},u.ccEOC=function(){if(this.logger.log(T.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var o=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=o,this.writeScreen=this.nonDisplayedMemory,this.logger.log(T.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},u.ccTO=function(o){this.logger.log(T.INFO,"TO("+o+") - Tab Offset"),this.writeScreen.moveCursor(o)},u.ccMIDROW=function(o){var d={flash:!1};if(d.underline=o%2===1,d.italics=o>=46,d.italics)d.foreground="white";else{var g=Math.floor(o/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];d.foreground=S[g]}this.logger.log(T.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},u.outputDataUpdate=function(o){o===void 0&&(o=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=d:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),o&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d),this.lastOutputScreen.copy(this.displayedMemory))},u.cueSplitAtTime=function(o){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,o,this.displayedMemory),this.cueStartTime=o))},h}(),a=function(){function h(s,o,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var g=new E;this.channels=[null,new f(s,o,g),new f(s+1,d,g)],this.cmdHistory=c(),this.logger=g}var u=h.prototype;return u.getHandler=function(o){return this.channels[o].getHandler()},u.setHandler=function(o,d){this.channels[o].setHandler(d)},u.addData=function(o,d){var g,S,R,I=!1;this.logger.time=o;for(var _=0;_<d.length;_+=2)if(S=d[_]&127,R=d[_+1]&127,!(S===0&&R===0)){if(this.logger.log(T.DATA,"["+v([d[_],d[_+1]])+"] -> ("+v([S,R])+")"),g=this.parseCmd(S,R),g||(g=this.parseMidrow(S,R)),g||(g=this.parsePAC(S,R)),g||(g=this.parseBackgroundAttributes(S,R)),!g&&(I=this.parseChars(S,R),I)){var B=this.currentChannel;if(B&&B>0){var F=this.channels[B];F.insertChars(I)}else this.logger.log(T.WARNING,"No channel found yet. TEXT-MODE?")}!g&&!I&&this.logger.log(T.WARNING,"Couldn't parse cleaned data "+v([S,R])+" orig: "+v([d[_],d[_+1]]))}},u.parseCmd=function(o,d){var g=this.cmdHistory,S=(o===20||o===28||o===21||o===29)&&d>=32&&d<=47,R=(o===23||o===31)&&d>=33&&d<=35;if(!(S||R))return!1;if(l(o,d,g))return i(null,null,g),this.logger.log(T.DEBUG,"Repeated command ("+v([o,d])+") is dropped"),!0;var I=o===20||o===21||o===23?1:2,_=this.channels[I];return o===20||o===21||o===28||o===29?d===32?_.ccRCL():d===33?_.ccBS():d===34?_.ccAOF():d===35?_.ccAON():d===36?_.ccDER():d===37?_.ccRU(2):d===38?_.ccRU(3):d===39?_.ccRU(4):d===40?_.ccFON():d===41?_.ccRDC():d===42?_.ccTR():d===43?_.ccRTD():d===44?_.ccEDM():d===45?_.ccCR():d===46?_.ccENM():d===47&&_.ccEOC():_.ccTO(d-32),i(o,d,g),this.currentChannel=I,!0},u.parseMidrow=function(o,d){var g=0;if((o===17||o===25)&&d>=32&&d<=47){if(o===17?g=1:g=2,g!==this.currentChannel)return this.logger.log(T.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[g];return S?(S.ccMIDROW(d),this.logger.log(T.DEBUG,"MIDROW ("+v([o,d])+")"),!0):!1}return!1},u.parsePAC=function(o,d){var g,S=this.cmdHistory,R=(o>=17&&o<=23||o>=25&&o<=31)&&d>=64&&d<=127,I=(o===16||o===24)&&d>=64&&d<=95;if(!(R||I))return!1;if(l(o,d,S))return i(null,null,S),!0;var _=o<=23?1:2;d>=64&&d<=95?g=_===1?O[o]:m[o]:g=_===1?A[o]:x[o];var B=this.channels[_];return B?(B.setPAC(this.interpretPAC(g,d)),i(o,d,S),this.currentChannel=_,!0):!1},u.interpretPAC=function(o,d){var g,S={color:null,italics:!1,indent:null,underline:!1,row:o};return d>95?g=d-96:g=d-64,S.underline=(g&1)===1,g<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(g/2)]:g<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((g-16)/2)*4,S},u.parseChars=function(o,d){var g,S=null,R=null;if(o>=25?(g=2,R=o-8):(g=1,R=o),R>=17&&R<=19){var I;R===17?I=d+80:R===18?I=d+112:I=d+144,this.logger.log(T.INFO,"Special char '"+L(I)+"' in channel "+g),S=[I]}else o>=32&&o<=127&&(S=d===0?[o]:[o,d]);if(S){var _=v(S);this.logger.log(T.DEBUG,"Char codes =  "+_.join(",")),i(o,d,this.cmdHistory)}return S},u.parseBackgroundAttributes=function(o,d){var g=(o===16||o===24)&&d>=32&&d<=47,S=(o===23||o===31)&&d>=45&&d<=47;if(!(g||S))return!1;var R,I={};o===16||o===24?(R=Math.floor((d-32)/2),I.background=y[R],d%2===1&&(I.background=I.background+"_semi")):d===45?I.background="transparent":(I.foreground="black",d===47&&(I.underline=!0));var _=o<=23?1:2,B=this.channels[_];return B.setBkgData(I),i(o,d,this.cmdHistory),!0},u.reset=function(){for(var o=0;o<Object.keys(this.channels).length;o++){var d=this.channels[o];d&&d.reset()}this.cmdHistory=c()},u.cueSplitAtTime=function(o){for(var d=0;d<this.channels.length;d++){var g=this.channels[d];g&&g.cueSplitAtTime(o)}},h}();function i(h,u,s){s.a=h,s.b=u}function l(h,u,s){return s.a===h&&s.b===u}function c(){return{a:null,b:null}}C.default=a},"./src/utils/codecs.ts":function(k,C,p){p.r(C),p.d(C,"isCodecType",function(){return D}),p.d(C,"isCodecSupportedInMp4",function(){return L});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function D(b,P){var O=M[P];return!!O&&O[b.slice(0,4)]===!0}function L(b,P){return MediaSource.isTypeSupported((P||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(k,C,p){p.r(C);var M=p("./src/utils/vttparser.ts"),D=p("./src/utils/webvtt-parser.ts"),L=p("./src/utils/texttrack-utils.ts"),b=/\s/,P={newCue:function(A,m,x,y){for(var T=[],E,v,n,e,r,t=self.VTTCue||self.TextTrackCue,f=0;f<y.rows.length;f++)if(E=y.rows[f],n=!0,e=0,r="",!E.isEmpty()){for(var a=0;a<E.chars.length;a++)b.test(E.chars[a].uchar)&&n?e++:(r+=E.chars[a].uchar,n=!1);E.cueStartTime=m,m===x&&(x+=1e-4),e>=16?e--:e++;var i=Object(M.fixLineBreaks)(r.trim()),l=Object(D.generateCueId)(m,x,i);(!A||!A.cues||!A.cues.getCueById(l))&&(v=new t(m,x,i),v.id=l,v.line=f+1,v.align="left",v.position=10+Math.min(80,Math.floor(e*8/32)*10),T.push(v))}return A&&T.length&&(T.sort(function(c,h){return c.line==="auto"||h.line==="auto"?0:c.line>8&&h.line>8?h.line-c.line:c.line-h.line}),T.forEach(function(c){return Object(L.addCueToTrack)(A,c)})),T}};C.default=P},"./src/utils/discontinuities.ts":function(k,C,p){p.r(C),p.d(C,"findFirstFragWithCC",function(){return b}),p.d(C,"shouldAlignOnDiscontinuities",function(){return P}),p.d(C,"findDiscontinuousReferenceFrag",function(){return O}),p.d(C,"adjustSlidingStart",function(){return m}),p.d(C,"alignStream",function(){return x}),p.d(C,"alignPDT",function(){return T}),p.d(C,"alignFragmentByPDTDelta",function(){return E}),p.d(C,"alignMediaPlaylistByPDT",function(){return v});var M=p("./src/polyfills/number.ts"),D=p("./src/utils/logger.ts"),L=p("./src/controller/level-helper.ts");function b(n,e){for(var r=null,t=0,f=n.length;t<f;t++){var a=n[t];if(a&&a.cc===e){r=a;break}}return r}function P(n,e,r){return!!(e.details&&(r.endCC>r.startCC||n&&n.cc<r.startCC))}function O(n,e){var r=n.fragments,t=e.fragments;if(!t.length||!r.length){D.logger.log("No fragments to align");return}var f=b(r,t[0].cc);if(!f||f&&!f.startPTS){D.logger.log("No frag in previous level to align on");return}return f}function A(n,e){if(n){var r=n.start+e;n.start=n.startPTS=r,n.endPTS=r+n.duration}}function m(n,e){for(var r=e.fragments,t=0,f=r.length;t<f;t++)A(r[t],n);e.fragmentHint&&A(e.fragmentHint,n),e.alignedSliding=!0}function x(n,e,r){!e||(y(n,r,e),!r.alignedSliding&&e.details&&T(r,e.details),!r.alignedSliding&&e.details&&!r.skippedSegments&&Object(L.adjustSliding)(e.details,r))}function y(n,e,r){if(P(n,r,e)){var t=O(r.details,e);t&&Object(M.isFiniteNumber)(t.start)&&(D.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),m(t.start,e))}}function T(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var r=e.fragments[0].programDateTime,t=n.fragments[0].programDateTime,f=(t-r)/1e3+e.fragments[0].start;f&&Object(M.isFiniteNumber)(f)&&(D.logger.log("Adjusting PTS using programDateTime delta "+(t-r)+"ms, sliding:"+f.toFixed(3)+" "+n.url+" "),m(f,n))}}function E(n,e){var r=n.programDateTime;if(!!r){var t=(r-e)/1e3;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function v(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var r=e.fragments[0].programDateTime,t=e.fragments[0].start,f=r-t*1e3;n.fragments.forEach(function(a){E(a,f)}),n.fragmentHint&&E(n.fragmentHint,f),n.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(k,C,p){p.r(C);var M=p("./src/utils/ewma.ts"),D=function(){function L(P,O,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(P),this.fast_=new M.default(O)}var b=L.prototype;return b.update=function(O,A){var m=this.slow_,x=this.fast_;this.slow_.halfLife!==O&&(this.slow_=new M.default(O,m.getEstimate(),m.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new M.default(A,x.getEstimate(),x.getTotalWeight()))},b.sample=function(O,A){O=Math.max(O,this.minDelayMs_);var m=8*A,x=O/1e3,y=m/x;this.fast_.sample(x,y),this.slow_.sample(x,y)},b.canEstimate=function(){var O=this.fast_;return O&&O.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},L}();C.default=D},"./src/utils/ewma.ts":function(k,C,p){p.r(C);var M=function(){function D(b,P,O){P===void 0&&(P=0),O===void 0&&(O=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=P,this.totalWeight_=O}var L=D.prototype;return L.sample=function(P,O){var A=Math.pow(this.alpha_,P);this.estimate_=O*(1-A)+A*this.estimate_,this.totalWeight_+=P},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var P=1-Math.pow(this.alpha_,this.totalWeight_);if(P)return this.estimate_/P}return this.estimate_},D}();C.default=M},"./src/utils/fetch-loader.ts":function(k,C,p){p.r(C),p.d(C,"fetchSupported",function(){return E});var M=p("./src/polyfills/number.ts"),D=p("./src/loader/load-stats.ts"),L=p("./src/demux/chunk-cache.ts");function b(t,f){t.prototype=Object.create(f.prototype),t.prototype.constructor=t,x(t,f)}function P(t){var f=typeof Map=="function"?new Map:void 0;return P=function(i){if(i===null||!m(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f!="undefined"){if(f.has(i))return f.get(i);f.set(i,l)}function l(){return O(i,arguments,y(this).constructor)}return l.prototype=Object.create(i.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),x(l,i)},P(t)}function O(t,f,a){return A()?O=Reflect.construct:O=function(l,c,h){var u=[null];u.push.apply(u,c);var s=Function.bind.apply(l,u),o=new s;return h&&x(o,h.prototype),o},O.apply(null,arguments)}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function m(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function x(t,f){return x=Object.setPrototypeOf||function(i,l){return i.__proto__=l,i},x(t,f)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},y(t)}function T(){return T=Object.assign||function(t){for(var f=1;f<arguments.length;f++){var a=arguments[f];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},T.apply(this,arguments)}function E(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var v=function(){function t(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||e,this.controller=new self.AbortController,this.stats=new D.LoadStats}var f=t.prototype;return f.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},f.abortInternal=function(){var i=this.response;(!i||!i.ok)&&(this.stats.aborted=!0,this.controller.abort())},f.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},f.load=function(i,l,c){var h=this,u=this.stats;if(u.loading.start)throw new Error("Loader can only be used once.");u.loading.start=self.performance.now();var s=n(i,this.controller.signal),o=c.onProgress,d=i.responseType==="arraybuffer",g=d?"byteLength":"length";this.context=i,this.config=l,this.callbacks=c,this.request=this.fetchSetup(i,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){h.abortInternal(),c.onTimeout(u,i,h.response)},l.timeout),self.fetch(this.request).then(function(S){if(h.response=h.loader=S,!S.ok){var R=S.status,I=S.statusText;throw new r(I||"fetch, bad network response",R,S)}return u.loading.first=Math.max(self.performance.now(),u.loading.start),u.total=parseInt(S.headers.get("Content-Length")||"0"),o&&Object(M.isFiniteNumber)(l.highWaterMark)?h.loadProgressively(S,u,i,l.highWaterMark,o):d?S.arrayBuffer():S.text()}).then(function(S){var R=h.response;self.clearTimeout(h.requestTimeout),u.loading.end=Math.max(self.performance.now(),u.loading.first),u.loaded=u.total=S[g];var I={url:R.url,data:S};o&&!Object(M.isFiniteNumber)(l.highWaterMark)&&o(u,i,S,R),c.onSuccess(I,u,i,R)}).catch(function(S){if(self.clearTimeout(h.requestTimeout),!u.aborted){var R=S.code||0;c.onError({code:R,text:S.message},i,S.details)}})},f.getCacheAge=function(){var i=null;if(this.response){var l=this.response.headers.get("age");i=l?parseFloat(l):null}return i},f.loadProgressively=function(i,l,c,h,u){h===void 0&&(h=0);var s=new L.default,o=i.body.getReader(),d=function g(){return o.read().then(function(S){if(S.done)return s.dataLength&&u(l,c,s.flush(),i),Promise.resolve(new ArrayBuffer(0));var R=S.value,I=R.length;return l.loaded+=I,I<h||s.dataLength?(s.push(R),s.dataLength>=h&&u(l,c,s.flush(),i)):u(l,c,R,i),g()}).catch(function(){return Promise.reject()})};return d()},t}();function n(t,f){var a={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(T({},t.headers))};return t.rangeEnd&&a.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),a}function e(t,f){return new self.Request(t.url,f)}var r=function(t){b(f,t);function f(a,i,l){var c;return c=t.call(this,a)||this,c.code=void 0,c.details=void 0,c.code=i,c.details=l,c}return f}(P(Error));C.default=v},"./src/utils/imsc1-ttml-parser.ts":function(k,C,p){p.r(C),p.d(C,"IMSC1_CODEC",function(){return m}),p.d(C,"parseIMSC1",function(){return E});var M=p("./src/utils/mp4-tools.ts"),D=p("./src/utils/vttparser.ts"),L=p("./src/utils/vttcue.ts"),b=p("./src/demux/id3.ts"),P=p("./src/utils/timescale-conversion.ts"),O=p("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign||function(h){for(var u=1;u<arguments.length;u++){var s=arguments[u];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(h[o]=s[o])}return h},A.apply(this,arguments)}var m="stpp.ttml.im1t",x=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,y=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function E(h,u,s,o,d){var g=Object(M.findBox)(new Uint8Array(h),["mdat"]);if(g.length===0){d(new Error("Could not parse IMSC1 mdat"));return}var S=g[0],R=Object(b.utf8ArrayToStr)(new Uint8Array(h,S.start,S.end-S.start)),I=Object(P.toTimescaleFromScale)(u,1,s);try{o(v(R,I))}catch(_){d(_)}}function v(h,u){var s=new DOMParser,o=s.parseFromString(h,"text/xml"),d=o.getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var g={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},S=Object.keys(g).reduce(function(F,U){return F[U]=d.getAttribute("ttp:"+U)||g[U],F},{}),R=d.getAttribute("xml:space")!=="preserve",I=e(n(d,"styling","style")),_=e(n(d,"layout","region")),B=n(d,"body","[begin]");return[].map.call(B,function(F){var U=r(F,R);if(!U||!F.hasAttribute("begin"))return null;var w=i(F.getAttribute("begin"),S),K=i(F.getAttribute("dur"),S),H=i(F.getAttribute("end"),S);if(w===null)throw a(F);if(H===null){if(K===null)throw a(F);H=w+K}var j=new L.default(w-u,H-u,U);j.id=Object(O.generateCueId)(j.startTime,j.endTime,j.text);var Y=_[F.getAttribute("region")],z=I[F.getAttribute("style")];j.position=10,j.size=80;var V=t(Y,z),Q=V.textAlign;if(Q){var X=T[Q];X&&(j.lineAlign=X),j.align=Q}return A(j,V),j}).filter(function(F){return F!==null})}function n(h,u,s){var o=h.getElementsByTagName(u)[0];return o?[].slice.call(o.querySelectorAll(s)):[]}function e(h){return h.reduce(function(u,s){var o=s.getAttribute("xml:id");return o&&(u[o]=s),u},{})}function r(h,u){return[].slice.call(h.childNodes).reduce(function(s,o,d){var g;return o.nodeName==="br"&&d?s+`
`:(g=o.childNodes)!==null&&g!==void 0&&g.length?r(o,u):u?s+o.textContent.trim().replace(/\s+/g," "):s+o.textContent},"")}function t(h,u){var s="http://www.w3.org/ns/ttml#styling",o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return o.reduce(function(d,g){var S=f(u,s,g)||f(h,s,g);return S&&(d[g]=S),d},{})}function f(h,u,s){return h.hasAttributeNS(u,s)?h.getAttributeNS(u,s):null}function a(h){return new Error("Could not parse ttml timestamp "+h)}function i(h,u){if(!h)return null;var s=Object(D.parseTimeStamp)(h);return s===null&&(x.test(h)?s=l(h,u):y.test(h)&&(s=c(h,u))),s}function l(h,u){var s=x.exec(h),o=(s[4]|0)+(s[5]|0)/u.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+o/u.frameRate}function c(h,u){var s=y.exec(h),o=Number(s[1]),d=s[2];switch(d){case"h":return o*3600;case"m":return o*60;case"ms":return o*1e3;case"f":return o/u.frameRate;case"t":return o/u.tickRate}return o}},"./src/utils/logger.ts":function(k,C,p){p.r(C),p.d(C,"enableLogs",function(){return O}),p.d(C,"logger",function(){return A});var M=function(){},D={trace:M,debug:M,log:M,warn:M,info:M,error:M},L=D;function b(m){var x=self.console[m];return x?x.bind(self.console,"["+m+"] >"):M}function P(m){for(var x=arguments.length,y=new Array(x>1?x-1:0),T=1;T<x;T++)y[T-1]=arguments[T];y.forEach(function(E){L[E]=m[E]?m[E].bind(m):b(E)})}function O(m){if(self.console&&m===!0||typeof m=="object"){P(m,"debug","log","info","warn","error");try{L.log()}catch{L=D}}else L=D}var A=L},"./src/utils/mediakeys-helper.ts":function(k,C,p){p.r(C),p.d(C,"KeySystems",function(){return M}),p.d(C,"requestMediaKeySystemAccess",function(){return D});var M;(function(L){L.WIDEVINE="com.widevine.alpha",L.PLAYREADY="com.microsoft.playready"})(M||(M={}));var D=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(k,C,p){p.r(C),p.d(C,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(k,C,p){p.r(C),p.d(C,"bin2str",function(){return P}),p.d(C,"readUint16",function(){return O}),p.d(C,"readUint32",function(){return A}),p.d(C,"writeUint32",function(){return m}),p.d(C,"findBox",function(){return x}),p.d(C,"parseSegmentIndex",function(){return y}),p.d(C,"parseInitSegment",function(){return T}),p.d(C,"getStartDTS",function(){return E}),p.d(C,"getDuration",function(){return v}),p.d(C,"computeRawDurationFromSamples",function(){return n}),p.d(C,"offsetStartDTS",function(){return e}),p.d(C,"segmentValidRange",function(){return r}),p.d(C,"appendUint8Array",function(){return t});var M=p("./src/utils/typed-array.ts"),D=p("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,b=[].push;function P(f){return String.fromCharCode.apply(null,f)}function O(f,a){"data"in f&&(a+=f.start,f=f.data);var i=f[a]<<8|f[a+1];return i<0?65536+i:i}function A(f,a){"data"in f&&(a+=f.start,f=f.data);var i=f[a]<<24|f[a+1]<<16|f[a+2]<<8|f[a+3];return i<0?4294967296+i:i}function m(f,a,i){"data"in f&&(a+=f.start,f=f.data),f[a]=i>>24,f[a+1]=i>>16&255,f[a+2]=i>>8&255,f[a+3]=i&255}function x(f,a){var i=[];if(!a.length)return i;var l,c,h;"data"in f?(l=f.data,c=f.start,h=f.end):(l=f,c=0,h=l.byteLength);for(var u=c;u<h;){var s=A(l,u),o=P(l.subarray(u+4,u+8)),d=s>1?u+s:h;if(o===a[0])if(a.length===1)i.push({data:l,start:u+8,end:d});else{var g=x({data:l,start:u+8,end:d},a.slice(1));g.length&&b.apply(i,g)}u=d}return i}function y(f){var a=x(f,["moov"]),i=a[0],l=i?i.end:null,c=x(f,["sidx"]);if(!c||!c[0])return null;var h=[],u=c[0],s=u.data[0],o=s===0?8:16,d=A(u,o);o+=4;var g=0,S=0;s===0?o+=8:o+=16,o+=2;var R=u.end+S,I=O(u,o);o+=2;for(var _=0;_<I;_++){var B=o,F=A(u,B);B+=4;var U=F&2147483647,w=(F&2147483648)>>>31;if(w===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var K=A(u,B);B+=4,h.push({referenceSize:U,subsegmentDuration:K,info:{duration:K/d,start:R,end:R+U-1}}),R+=U,B+=4,o=B}return{earliestPresentationTime:g,timescale:d,version:s,referencesCount:I,references:h,moovEndOffset:l}}function T(f){for(var a=[],i=x(f,["moov","trak"]),l=0;l<i.length;l++){var c=i[l],h=x(c,["tkhd"])[0];if(h){var u=h.data[h.start],s=u===0?12:20,o=A(h,s),d=x(c,["mdia","mdhd"])[0];if(d){u=d.data[d.start],s=u===0?12:20;var g=A(d,s),S=x(c,["mdia","hdlr"])[0];if(S){var R=P(S.data.subarray(S.start+8,S.start+12)),I={soun:D.ElementaryStreamTypes.AUDIO,vide:D.ElementaryStreamTypes.VIDEO}[R];if(I){var _=x(c,["mdia","minf","stbl","stsd"])[0],B=void 0;_&&(B=P(_.data.subarray(_.start+12,_.start+16))),a[o]={timescale:g,type:I},a[I]={timescale:g,id:o,codec:B}}}}}}var F=x(f,["moov","mvex","trex"]);return F.forEach(function(U){var w=A(U,4),K=a[w];K&&(K.default={duration:A(U,12),flags:A(U,20)})}),a}function E(f,a){return x(a,["moof","traf"]).reduce(function(i,l){var c=x(l,["tfdt"])[0],h=c.data[c.start],u=x(l,["tfhd"]).reduce(function(s,o){var d=A(o,4),g=f[d];if(g){var S=A(c,4);h===1&&(S*=Math.pow(2,32),S+=A(c,8));var R=g.timescale||9e4,I=S/R;if(isFinite(I)&&(s===null||I<s))return I}return s},null);return u!==null&&isFinite(u)&&(i===null||u<i)?u:i},null)||0}function v(f,a){for(var i=0,l=0,c=0,h=x(f,["moof","traf"]),u=0;u<h.length;u++){var s=h[u],o=x(s,["tfhd"])[0],d=A(o,4),g=a[d];if(!!g){var S=g.default,R=A(o,0)|(S==null?void 0:S.flags),I=S==null?void 0:S.duration;R&8&&(R&2?I=A(o,12):I=A(o,8));for(var _=g.timescale||9e4,B=x(s,["trun"]),F=0;F<B.length;F++){if(i=n(B[F]),!i&&I){var U=A(B[F],4);i=I*U}g.type===D.ElementaryStreamTypes.VIDEO?l+=i/_:g.type===D.ElementaryStreamTypes.AUDIO&&(c+=i/_)}}}if(l===0&&c===0){var w=y(f);if(w!=null&&w.references)return w.references.reduce(function(K,H){return K+H.info.duration||0},0)}return l||c}function n(f){var a=A(f,0),i=8;a&1&&(i+=4),a&4&&(i+=4);for(var l=0,c=A(f,4),h=0;h<c;h++){if(a&256){var u=A(f,i);l+=u,i+=4}a&512&&(i+=4),a&1024&&(i+=4),a&2048&&(i+=4)}return l}function e(f,a,i){x(a,["moof","traf"]).forEach(function(l){x(l,["tfhd"]).forEach(function(c){var h=A(c,4),u=f[h];if(!!u){var s=u.timescale||9e4;x(l,["tfdt"]).forEach(function(o){var d=o.data[o.start],g=A(o,4);if(d===0)m(o,4,g-i*s);else{g*=Math.pow(2,32),g+=A(o,8),g-=i*s,g=Math.max(g,0);var S=Math.floor(g/(L+1)),R=Math.floor(g%(L+1));m(o,4,S),m(o,8,R)}})}})})}function r(f){var a={valid:null,remainder:null},i=x(f,["moof"]);if(i){if(i.length<2)return a.remainder=f,a}else return a;var l=i[i.length-1];return a.valid=Object(M.sliceUint8)(f,0,l.start-8),a.remainder=Object(M.sliceUint8)(f,l.start-8),a}function t(f,a){var i=new Uint8Array(f.length+a.length);return i.set(f),i.set(a,f.length),i}},"./src/utils/output-filter.ts":function(k,C,p){p.r(C),p.d(C,"default",function(){return M});var M=function(){function D(b,P){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=P}var L=D.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(P,O,A){(this.startTime===null||this.startTime>P)&&(this.startTime=P),this.endTime=O,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[],this.startTime=null},D}()},"./src/utils/texttrack-utils.ts":function(k,C,p){p.r(C),p.d(C,"sendAddTrackEvent",function(){return D}),p.d(C,"addCueToTrack",function(){return L}),p.d(C,"clearCurrentCues",function(){return b}),p.d(C,"removeCuesInRange",function(){return P}),p.d(C,"getCuesInRange",function(){return A});var M=p("./src/utils/logger.ts");function D(m,x){var y;try{y=new Event("addtrack")}catch{y=document.createEvent("Event"),y.initEvent("addtrack",!1,!1)}y.track=m,x.dispatchEvent(y)}function L(m,x){var y=m.mode;if(y==="disabled"&&(m.mode="hidden"),m.cues&&!m.cues.getCueById(x.id))try{if(m.addCue(x),!m.cues.getCueById(x.id))throw new Error("addCue is failed for: "+x)}catch(E){M.logger.debug("[texttrack-utils]: "+E);var T=new self.TextTrackCue(x.startTime,x.endTime,x.text);T.id=x.id,m.addCue(T)}y==="disabled"&&(m.mode=y)}function b(m){var x=m.mode;if(x==="disabled"&&(m.mode="hidden"),m.cues)for(var y=m.cues.length;y--;)m.removeCue(m.cues[y]);x==="disabled"&&(m.mode=x)}function P(m,x,y){var T=m.mode;if(T==="disabled"&&(m.mode="hidden"),m.cues&&m.cues.length>0)for(var E=A(m.cues,x,y),v=0;v<E.length;v++)m.removeCue(E[v]);T==="disabled"&&(m.mode=T)}function O(m,x){if(x<m[0].startTime)return 0;var y=m.length-1;if(x>m[y].endTime)return-1;for(var T=0,E=y;T<=E;){var v=Math.floor((E+T)/2);if(x<m[v].startTime)E=v-1;else if(x>m[v].startTime&&T<y)T=v+1;else return v}return m[T].startTime-x<x-m[E].startTime?T:E}function A(m,x,y){var T=[],E=O(m,x);if(E>-1)for(var v=E,n=m.length;v<n;v++){var e=m[v];if(e.startTime>=x&&e.endTime<=y)T.push(e);else if(e.startTime>y)return T}return T}},"./src/utils/time-ranges.ts":function(k,C,p){p.r(C);var M={toString:function(L){for(var b="",P=L.length,O=0;O<P;O++)b+="["+L.start(O).toFixed(3)+","+L.end(O).toFixed(3)+"]";return b}};C.default=M},"./src/utils/timescale-conversion.ts":function(k,C,p){p.r(C),p.d(C,"toTimescaleFromBase",function(){return D}),p.d(C,"toTimescaleFromScale",function(){return L}),p.d(C,"toMsFromMpegTsClock",function(){return b}),p.d(C,"toMpegTsClockFromTimescale",function(){return P});var M=9e4;function D(O,A,m,x){m===void 0&&(m=1),x===void 0&&(x=!1);var y=O*A*m;return x?Math.round(y):y}function L(O,A,m,x){return m===void 0&&(m=1),x===void 0&&(x=!1),D(O,A,1/m,x)}function b(O,A){return A===void 0&&(A=!1),D(O,1e3,1/M,A)}function P(O,A){return A===void 0&&(A=1),D(O,M,1/A)}},"./src/utils/typed-array.ts":function(k,C,p){p.r(C),p.d(C,"sliceUint8",function(){return M});function M(D,L,b){return Uint8Array.prototype.slice?D.slice(L,b):new Uint8Array(Array.prototype.slice.call(D,L,b))}},"./src/utils/vttcue.ts":function(k,C,p){p.r(C),C.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],D=["start","middle","end","left","right"];function L(m,x){if(typeof x!="string"||!Array.isArray(m))return!1;var y=x.toLowerCase();return~m.indexOf(y)?y:!1}function b(m){return L(M,m)}function P(m){return L(D,m)}function O(m){for(var x=arguments.length,y=new Array(x>1?x-1:0),T=1;T<x;T++)y[T-1]=arguments[T];for(var E=1;E<arguments.length;E++){var v=arguments[E];for(var n in v)m[n]=v[n]}return m}function A(m,x,y){var T=this,E={enumerable:!0};T.hasBeenReset=!1;var v="",n=!1,e=m,r=x,t=y,f=null,a="",i=!0,l="auto",c="start",h=50,u="middle",s=50,o="middle";Object.defineProperty(T,"id",O({},E,{get:function(){return v},set:function(g){v=""+g}})),Object.defineProperty(T,"pauseOnExit",O({},E,{get:function(){return n},set:function(g){n=!!g}})),Object.defineProperty(T,"startTime",O({},E,{get:function(){return e},set:function(g){if(typeof g!="number")throw new TypeError("Start time must be set to a number.");e=g,this.hasBeenReset=!0}})),Object.defineProperty(T,"endTime",O({},E,{get:function(){return r},set:function(g){if(typeof g!="number")throw new TypeError("End time must be set to a number.");r=g,this.hasBeenReset=!0}})),Object.defineProperty(T,"text",O({},E,{get:function(){return t},set:function(g){t=""+g,this.hasBeenReset=!0}})),Object.defineProperty(T,"region",O({},E,{get:function(){return f},set:function(g){f=g,this.hasBeenReset=!0}})),Object.defineProperty(T,"vertical",O({},E,{get:function(){return a},set:function(g){var S=b(g);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");a=S,this.hasBeenReset=!0}})),Object.defineProperty(T,"snapToLines",O({},E,{get:function(){return i},set:function(g){i=!!g,this.hasBeenReset=!0}})),Object.defineProperty(T,"line",O({},E,{get:function(){return l},set:function(g){if(typeof g!="number"&&g!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");l=g,this.hasBeenReset=!0}})),Object.defineProperty(T,"lineAlign",O({},E,{get:function(){return c},set:function(g){var S=P(g);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");c=S,this.hasBeenReset=!0}})),Object.defineProperty(T,"position",O({},E,{get:function(){return h},set:function(g){if(g<0||g>100)throw new Error("Position must be between 0 and 100.");h=g,this.hasBeenReset=!0}})),Object.defineProperty(T,"positionAlign",O({},E,{get:function(){return u},set:function(g){var S=P(g);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");u=S,this.hasBeenReset=!0}})),Object.defineProperty(T,"size",O({},E,{get:function(){return s},set:function(g){if(g<0||g>100)throw new Error("Size must be between 0 and 100.");s=g,this.hasBeenReset=!0}})),Object.defineProperty(T,"align",O({},E,{get:function(){return o},set:function(g){var S=P(g);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");o=S,this.hasBeenReset=!0}})),T.displayState=void 0}return A.prototype.getCueAsHTML=function(){var m=self.WebVTT;return m.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":function(k,C,p){p.r(C),p.d(C,"parseTimeStamp",function(){return L}),p.d(C,"fixLineBreaks",function(){return x}),p.d(C,"VTTParser",function(){return y});var M=p("./src/utils/vttcue.ts"),D=function(){function T(){}var E=T.prototype;return E.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},T}();function L(T){function E(n,e,r,t){return(n|0)*3600+(e|0)*60+(r|0)+parseFloat(t||0)}var v=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return v?parseFloat(v[2])>59?E(v[2],v[3],0,v[4]):E(v[1],v[2],v[3],v[4]):null}var b=function(){function T(){this.values=Object.create(null)}var E=T.prototype;return E.set=function(n,e){!this.get(n)&&e!==""&&(this.values[n]=e)},E.get=function(n,e,r){return r?this.has(n)?this.values[n]:e[r]:this.has(n)?this.values[n]:e},E.has=function(n){return n in this.values},E.alt=function(n,e,r){for(var t=0;t<r.length;++t)if(e===r[t]){this.set(n,e);break}},E.integer=function(n,e){/^-?\d+$/.test(e)&&this.set(n,parseInt(e,10))},E.percent=function(n,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(n,r),!0}return!1},T}();function P(T,E,v,n){var e=n?T.split(n):[T];for(var r in e)if(typeof e[r]=="string"){var t=e[r].split(v);if(t.length===2){var f=t[0],a=t[1];E(f,a)}}}var O=new M.default(0,0,""),A=O.align==="middle"?"middle":"center";function m(T,E,v){var n=T;function e(){var f=L(T);if(f===null)throw new Error("Malformed timestamp: "+n);return T=T.replace(/^[^\sa-zA-Z-]+/,""),f}function r(f,a){var i=new b;P(f,function(h,u){var s;switch(h){case"region":for(var o=v.length-1;o>=0;o--)if(v[o].id===u){i.set(h,v[o].region);break}break;case"vertical":i.alt(h,u,["rl","lr"]);break;case"line":s=u.split(","),i.integer(h,s[0]),i.percent(h,s[0])&&i.set("snapToLines",!1),i.alt(h,s[0],["auto"]),s.length===2&&i.alt("lineAlign",s[1],["start",A,"end"]);break;case"position":s=u.split(","),i.percent(h,s[0]),s.length===2&&i.alt("positionAlign",s[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":i.percent(h,u);break;case"align":i.alt(h,u,["start",A,"end","left","right"]);break}},/:/,/\s/),a.region=i.get("region",null),a.vertical=i.get("vertical","");var l=i.get("line","auto");l==="auto"&&O.line===-1&&(l=-1),a.line=l,a.lineAlign=i.get("lineAlign","start"),a.snapToLines=i.get("snapToLines",!0),a.size=i.get("size",100),a.align=i.get("align",A);var c=i.get("position","auto");c==="auto"&&O.position===50&&(c=a.align==="start"||a.align==="left"?0:a.align==="end"||a.align==="right"?100:50),a.position=c}function t(){T=T.replace(/^\s+/,"")}if(t(),E.startTime=e(),t(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);T=T.substr(3),t(),E.endTime=e(),t(),r(T,E)}function x(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var y=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new D,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var E=T.prototype;return E.parse=function(n){var e=this;n&&(e.buffer+=e.decoder.decode(n,{stream:!0}));function r(){var c=e.buffer,h=0;for(c=x(c);h<c.length&&c[h]!=="\r"&&c[h]!==`
`;)++h;var u=c.substr(0,h);return c[h]==="\r"&&++h,c[h]===`
`&&++h,e.buffer=c.substr(h),u}function t(c){P(c,function(h,u){},/:/)}try{var f="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;f=r();var a=f.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var i=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(i?i=!1:f=r(),e.state){case"HEADER":/:/.test(f)?t(f):f||(e.state="ID");continue;case"NOTE":f||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){e.state="NOTE";break}if(!f)continue;if(e.cue=new M.default(0,0,""),e.state="CUE",f.indexOf("-->")===-1){e.cue.id=f;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{m(f,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var l=f.indexOf("-->")!==-1;if(!f||l&&(i=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=f}continue;case"BADCUE":f||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},E.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){n.onparsingerror&&n.onparsingerror(e)}return n.onflush&&n.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(k,C,p){p.r(C),p.d(C,"generateCueId",function(){return y}),p.d(C,"parseWebVTT",function(){return E});var M=p("./src/polyfills/number.ts"),D=p("./src/utils/vttparser.ts"),L=p("./src/demux/id3.ts"),b=p("./src/utils/timescale-conversion.ts"),P=p("./src/remux/mp4-remuxer.ts"),O=/\r\n|\n\r|\n|\r/g,A=function(n,e,r){return r===void 0&&(r=0),n.substr(r,e.length)===e},m=function(n){var e=parseInt(n.substr(-3)),r=parseInt(n.substr(-6,2)),t=parseInt(n.substr(-9,2)),f=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(e)||!Object(M.isFiniteNumber)(r)||!Object(M.isFiniteNumber)(t)||!Object(M.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return e+=1e3*r,e+=60*1e3*t,e+=60*60*1e3*f,e},x=function(n){for(var e=5381,r=n.length;r;)e=e*33^n.charCodeAt(--r);return(e>>>0).toString()};function y(v,n,e){return x(v.toString())+x(n.toString())+x(e)}var T=function(n,e,r){var t=n[e],f=n[t.prevCC];if(!f||!f.new&&t.new){n.ccOffset=n.presentationOffset=t.start,t.new=!1;return}for(;(a=f)!==null&&a!==void 0&&a.new;){var a;n.ccOffset+=t.start-f.start,t.new=!1,t=f,f=n[t.prevCC]}n.presentationOffset=r};function E(v,n,e,r,t,f,a,i){var l=new D.VTTParser,c=Object(L.utf8ArrayToStr)(new Uint8Array(v)).trim().replace(O,`
`).split(`
`),h=[],u=Object(b.toMpegTsClockFromTimescale)(n,e),s="00:00.000",o=0,d=0,g,S=!0,R=!1;l.oncue=function(I){var _=r[t],B=r.ccOffset,F=(o-u)/9e4;if(_!=null&&_.new&&(d!==void 0?B=r.ccOffset=_.start:T(r,t,F)),F&&(B=F-r.presentationOffset),R){var U=I.endTime-I.startTime,w=Object(P.normalizePts)((I.startTime+B-d)*9e4,f*9e4)/9e4;I.startTime=w,I.endTime=w+U}var K=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(K)),I.id||(I.id=y(I.startTime,I.endTime,K)),I.endTime>0&&h.push(I)},l.onparsingerror=function(I){g=I},l.onflush=function(){if(g){i(g);return}a(h)},c.forEach(function(I){if(S)if(A(I,"X-TIMESTAMP-MAP=")){S=!1,R=!0,I.substr(16).split(",").forEach(function(_){A(_,"LOCAL:")?s=_.substr(6):A(_,"MPEGTS:")&&(o=parseInt(_.substr(7)))});try{d=m(s)/1e3}catch(_){R=!1,g=_}return}else I===""&&(S=!1);l.parse(I+`
`)}),l.flush()}},"./src/utils/xhr-loader.ts":function(k,C,p){p.r(C);var M=p("./src/utils/logger.ts"),D=p("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,b=function(){function P(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new D.LoadStats,this.retryDelay=0}var O=P.prototype;return O.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},O.abortInternal=function(){var m=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),m&&(m.onreadystatechange=null,m.onprogress=null,m.readyState!==4&&(this.stats.aborted=!0,m.abort()))},O.abort=function(){var m;this.abortInternal(),(m=this.callbacks)!==null&&m!==void 0&&m.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},O.load=function(m,x,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=m,this.config=x,this.callbacks=y,this.retryDelay=x.retryDelay,this.loadInternal()},O.loadInternal=function(){var m=this.config,x=this.context;if(!!m){var y=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var E=this.xhrSetup;try{if(E)try{E(y,x.url)}catch{y.open("GET",x.url,!0),E(y,x.url)}y.readyState||y.open("GET",x.url,!0);var v=this.context.headers;if(v)for(var n in v)y.setRequestHeader(n,v[n])}catch(e){this.callbacks.onError({code:y.status,text:e.message},x,y);return}x.rangeEnd&&y.setRequestHeader("Range","bytes="+x.rangeStart+"-"+(x.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=x.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout),y.send()}},O.readystatechange=function(){var m=this.context,x=this.loader,y=this.stats;if(!(!m||!x)){var T=x.readyState,E=this.config;if(!y.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),T===4){x.onreadystatechange=null,x.onprogress=null;var v=x.status;if(v>=200&&v<300){y.loading.end=Math.max(self.performance.now(),y.loading.first);var n,e;if(m.responseType==="arraybuffer"?(n=x.response,e=n.byteLength):(n=x.responseText,e=n.length),y.loaded=y.total=e,!this.callbacks)return;var r=this.callbacks.onProgress;if(r&&r(y,m,n,x),!this.callbacks)return;var t={url:x.responseURL,data:n};this.callbacks.onSuccess(t,y,m,x)}else y.retry>=E.maxRetry||v>=400&&v<499?(M.logger.error(v+" while loading "+m.url),this.callbacks.onError({code:v,text:x.statusText},m,x)):(M.logger.warn(v+" while loading "+m.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,E.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),E.timeout)}},O.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var m=this.callbacks;m&&(this.abortInternal(),m.onTimeout(this.stats,this.context,this.loader))},O.loadprogress=function(m){var x=this.stats;x.loaded=m.loaded,m.lengthComputable&&(x.total=m.total)},O.getCacheAge=function(){var m=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var x=this.loader.getResponseHeader("age");m=x?parseFloat(x):null}return m},P}();C.default=b}}).default})})(We);var Ge=Xe(We.exports),pe=(N,W)=>{const k=N.__vccOpts||N;for(const[C,p]of W)k[C]=p;return k};const $e=G.defineComponent({name:"SvgIcon",props:{prefix:{type:String,default:"icon"},style:{type:Object,default:{width:"20px",height:"20px"}},name:{type:String,required:!0},color:{type:String,default:"#333"}},setup(N){return{symbolId:G.computed(()=>`#${N.prefix}-${N.name}`)}}}),Qe=["href","fill"];function Ze(N,W,k,C,p,M){return G.openBlock(),G.createElementBlock("svg",{"aria-hidden":"true",style:G.normalizeStyle(N.style)},[G.createElementVNode("use",{href:N.symbolId,fill:N.color},null,8,Qe)],4)}var je=pe($e,[["render",Ze]]),qt="";const Je={components:{Icon:je},props:["icon"]},qe={type:"button",class:"aplayer-icon"};function et(N,W,k,C,p,M){const D=G.resolveComponent("icon");return G.openBlock(),G.createElementBlock("button",qe,[G.createVNode(D,{name:k.icon},null,8,["name"])])}var Ue=pe(Je,[["render",et]]),er="";const tt={components:{IconButton:Ue},props:{pic:String,theme:String,playing:{type:Boolean,default:!1},enableDrag:{type:Boolean,default:!1}},data(){return{hasMovedSinceMouseDown:!1,dragStartX:0,dragStartY:0}},computed:{currentPicStyleObj(){return this.pic?{backgroundImage:`url(${this.pic})`,backgroundColor:this.theme}:{}}},methods:{onDragBegin(N){this.enableDrag&&(this.hasMovedSinceMouseDown=!1,this.$emit("dragbegin"),this.dragStartX=N.clientX,this.dragStartY=N.clientY,document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp))},onDocumentMouseMove(N){this.hasMovedSinceMouseDown=!0,this.$emit("dragging",{offsetLeft:N.clientX-this.dragStartX,offsetTop:N.clientY-this.dragStartY})},onDocumentMouseUp(N){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousemove",this.onDocumentMouseMove),this.$emit("dragend")},onClick(){this.hasMovedSinceMouseDown||this.$emit("toggleplay")}}};function rt(N,W,k,C,p,M){const D=G.resolveComponent("icon-button");return G.openBlock(),G.createElementBlock("div",{class:"aplayer-pic",style:G.normalizeStyle(M.currentPicStyleObj),onMousedown:W[0]||(W[0]=(...L)=>M.onDragBegin&&M.onDragBegin(...L)),onClick:W[1]||(W[1]=(...L)=>M.onClick&&M.onClick(...L))},[G.createElementVNode("div",{class:G.normalizeClass(["aplayer-button",k.playing?"aplayer-pause":"aplayer-play"])},[G.createVNode(D,{icon:k.playing?"pause":"play",class:G.normalizeClass(k.playing?"aplayer-icon-pause":"aplayer-icon-play")},null,8,["icon","class"])],2)],36)}var it=pe(tt,[["render",rt]]),tr="";const nt={props:{show:{type:Boolean,default:!0},currentMusic:Object,musicList:{type:Array,default(){return[]}},playIndex:{type:Number,default:0},theme:String,listmaxheight:String},computed:{listHeightStyle(){return{height:`${33*this.musicList.length-1}px`,maxHeight:this.listmaxheight||""}}}},at=["onClick"],st={class:"aplayer-list-index"},ot={class:"aplayer-list-title"},lt={class:"aplayer-list-author"};function ut(N,W,k,C,p,M){return G.openBlock(),G.createBlock(G.Transition,{name:"slide-v"},{default:G.withCtx(()=>[G.withDirectives(G.createElementVNode("div",{class:"aplayer-list",style:G.normalizeStyle(M.listHeightStyle),ref:"list"},[G.createElementVNode("ol",{ref:"ol",style:G.normalizeStyle(M.listHeightStyle)},[(G.openBlock(!0),G.createElementBlock(G.Fragment,null,G.renderList(k.musicList,(D,L)=>(G.openBlock(),G.createElementBlock("li",{key:L,class:G.normalizeClass({"aplayer-list-light":D===k.currentMusic}),onClick:b=>N.$emit("selectsong",D)},[G.createElementVNode("span",{class:"aplayer-list-cur",style:G.normalizeStyle({background:k.theme})},null,4),G.createElementVNode("span",st,G.toDisplayString(L+1),1),G.createElementVNode("span",ot,G.toDisplayString(D.title||"Untitled"),1),G.createElementVNode("span",lt,G.toDisplayString(D.artist||"Unknown"),1)],10,at))),128))],4)],4),[[G.vShow,k.show]])]),_:1})}var ft=pe(nt,[["render",ut]]);function dt(N){if(N){N=N.replace(/([^\]^\n])\[/g,(p,M)=>M+`
[`);const W=N.split(`
`),k=[],C=W.length;for(let p=0;p<C;p++){const M=W[p].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),D=W[p].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").replace(/^\s+|\s+$/g,"");if(M){const L=M.length;for(let b=0;b<L;b++){const P=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(M[b]),O=P[1]*60,A=parseInt(P[2]),m=P[4]?parseInt(P[4])/((P[4]+"").length===2?100:1e3):0,x=O+A+m;k.push([x,D])}}}return k.sort((p,M)=>p[0]-M[0]),k}else return[]}function ht(N,W){if(N===W)return 0;const[k,C,p]=N.split(".").map(Number),[M,D,L]=W.split(".").map(Number);if(k>M)return 1;if(k===M){if(C>D)return 1;if(C===D&&p>L)return 1}return-1}function Be(N){return console.warn(`[Vue-APlayer] ${N}`)}function Re(N){let W=N.offsetLeft,k=N.offsetParent,C;for(;k!==null;)W+=k.offsetLeft,k=k.offsetParent;return C=document.body.scrollLeft+document.documentElement.scrollLeft,W-C}function Ne(N){let W=N.offsetTop,k=N.offsetParent,C;for(;k!==null;)W+=k.offsetTop,k=k.offsetParent;return C=document.body.scrollTop+document.documentElement.scrollTop,W-C}var rr="";const ct={components:{Icon:je},props:["loadProgress","playProgress","theme"],data(){return{thumbHovered:!1}},methods:{onThumbMouseDown(N){const W=this.$refs.barWrap.clientWidth;let k=(N.clientX-Re(this.$refs.barWrap))/W;k=k>0?k:0,k=k<1?k:1,this.$emit("dragbegin",k),document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp)},onDocumentMouseMove(N){const W=this.$refs.barWrap.clientWidth;let k=(N.clientX-Re(this.$refs.barWrap))/W;k=k>0?k:0,k=k<1?k:1,this.$emit("dragging",k)},onDocumentMouseUp(N){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousemove",this.onDocumentMouseMove);const W=this.$refs.barWrap.clientWidth;let k=(N.clientX-Re(this.$refs.barWrap))/W;k=k>0?k:0,k=k<1?k:1,this.$emit("dragend",k)},onThumbTouchStart(N){const W=this.$refs.barWrap.clientWidth;let k=(N.clientX-Re(this.$refs.barWrap))/W;k=k>0?k:0,k=k<1?k:1,this.$emit("dragbegin",k),document.addEventListener("touchmove",this.onDocumentTouchMove),document.addEventListener("touchend",this.onDocumentTouchEnd)},onDocumentTouchMove(N){const W=N.changedTouches[0],k=this.$refs.barWrap.clientWidth;let C=(W.clientX-Re(this.$refs.barWrap))/k;C=C>0?C:0,C=C<1?C:1,this.$emit("dragging",C)},onDocumentTouchEnd(N){document.removeEventListener("touchend",this.onDocumentTouchEnd),document.removeEventListener("touchmove",this.onDocumentTouchMove);const W=N.changedTouches[0],k=this.$refs.barWrap.clientWidth;let C=(W.clientX-Re(this.$refs.barWrap))/k;C=C>0?C:0,C=C<1?C:1,this.$emit("dragend",C)}}},vt={class:"aplayer-bar"};function gt(N,W,k,C,p,M){const D=G.resolveComponent("icon");return G.openBlock(),G.createElementBlock("div",{class:"aplayer-bar-wrap",onMousedown:W[2]||(W[2]=(...L)=>M.onThumbMouseDown&&M.onThumbMouseDown(...L)),onTouchstart:W[3]||(W[3]=(...L)=>M.onThumbTouchStart&&M.onThumbTouchStart(...L)),ref:"barWrap"},[G.createElementVNode("div",vt,[G.createElementVNode("div",{class:"aplayer-loaded",style:G.normalizeStyle({width:`${k.loadProgress*100}%`})},null,4),G.createElementVNode("div",{class:"aplayer-played",style:G.normalizeStyle({width:`${k.playProgress*100}%`,background:k.theme})},[G.createElementVNode("span",{ref:"thumb",onMouseover:W[0]||(W[0]=L=>p.thumbHovered=!0),onMouseout:W[1]||(W[1]=L=>p.thumbHovered=!1),class:"aplayer-thumb",style:G.normalizeStyle({borderColor:k.theme,backgroundColor:p.thumbHovered?k.theme:"#fff"})},[G.createElementVNode("span",{class:"aplayer-loading-icon",style:G.normalizeStyle({backgroundColor:k.theme})},[G.createVNode(D,{name:"loading"})],4)],36)],4)])],544)}var mt=pe(ct,[["render",gt]]),ir="";const Pe=40,Et={components:{IconButton:Ue},props:["volume","muted","theme"],computed:{volumeIcon(){return this.muted||this.volume<=0?"volume-off":this.volume>=1?"volume-up":"volume-down"}},methods:{adjustVolume(N){let W=(Pe-N.clientY+Ne(this.$refs.bar))/Pe;W=W>0?W:0,W=W<1?W:1,this.$emit("setvolume",W)},onBarMouseDown(){document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseup",this.onDocumentMouseUp)},onDocumentMouseMove(N){let W=(Pe-N.clientY+Ne(this.$refs.bar))/Pe;W=W>0?W:0,W=W<1?W:1,this.$emit("setvolume",W)},onDocumentMouseUp(N){document.removeEventListener("mouseup",this.onDocumentMouseUp),document.removeEventListener("mousemove",this.onDocumentMouseMove);let W=(Pe-N.clientY+Ne(this.$refs.bar))/Pe;W=W>0?W:0,W=W<1?W:1,this.$emit("setvolume",W)}}},pt={class:"aplayer-volume-wrap"},yt={class:"aplayer-volume-bar",ref:"bar"};function Tt(N,W,k,C,p,M){const D=G.resolveComponent("icon-button");return G.openBlock(),G.createElementBlock("div",pt,[G.createVNode(D,{class:G.normalizeClass(`aplayer-icon-${M.volumeIcon}`),icon:M.volumeIcon,onClick:W[0]||(W[0]=L=>N.$emit("togglemute"))},null,8,["class","icon"]),G.createElementVNode("div",{class:"aplayer-volume-bar-wrap",onMousedown:W[1]||(W[1]=(...L)=>M.onBarMouseDown&&M.onBarMouseDown(...L))},[G.createElementVNode("div",yt,[G.createElementVNode("div",{class:"aplayer-volume",style:G.normalizeStyle({height:k.muted?0:`${Math.trunc(k.volume*100)}%`,background:k.theme})},null,4)],512)],32)])}var xt=pe(Et,[["render",Tt]]),nr="";const St={components:{IconButton:Ue,VProgress:mt,Volume:xt},props:["shuffle","repeat","stat","theme","volume","muted"],computed:{loadProgress(){return this.stat.duration===0?0:this.stat.loadedTime/this.stat.duration},playProgress(){return this.stat.duration===0?0:this.stat.playedTime/this.stat.duration}},methods:{secondToTime(N){if(isNaN(N))return"00:00";const W=D=>D<10?"0"+D:""+D,k=Math.trunc(N/60),C=Math.trunc(N-k*60),p=Math.trunc(k/60),M=Math.trunc(N/60-60*Math.trunc(N/60/60));return N>=3600?W(p)+":"+W(M)+":"+W(C):W(k)+":"+W(C)}}},Lt={class:"aplayer-controller"},At={class:"aplayer-time"},Dt={class:"aplayer-time-inner"},Ot=G.createTextVNode(" - "),Rt={class:"aplayer-ptime"},Pt=G.createTextVNode(" / "),It={class:"aplayer-dtime"};function Mt(N,W,k,C,p,M){const D=G.resolveComponent("v-progress"),L=G.resolveComponent("volume"),b=G.resolveComponent("icon-button");return G.openBlock(),G.createElementBlock("div",Lt,[G.createVNode(D,{loadProgress:M.loadProgress,playProgress:M.playProgress,theme:k.theme,onDragbegin:W[0]||(W[0]=P=>N.$emit("dragbegin",P)),onDragend:W[1]||(W[1]=P=>N.$emit("dragend",P)),onDragging:W[2]||(W[2]=P=>N.$emit("dragging",P))},null,8,["loadProgress","playProgress","theme"]),G.createElementVNode("div",At,[G.createElementVNode("div",Dt,[Ot,G.createElementVNode("span",Rt,G.toDisplayString(M.secondToTime(k.stat.playedTime)),1),Pt,G.createElementVNode("span",It,G.toDisplayString(M.secondToTime(k.stat.duration)),1)]),N.$parent.isMobile?G.createCommentVNode("",!0):(G.openBlock(),G.createBlock(L,{key:0,volume:k.volume,theme:k.theme,muted:k.muted,onTogglemute:W[3]||(W[3]=P=>N.$emit("togglemute")),onSetvolume:W[4]||(W[4]=P=>N.$emit("setvolume",P))},null,8,["volume","theme","muted"])),G.createVNode(b,{class:G.normalizeClass(["aplayer-icon-mode",{inactive:!k.shuffle}]),icon:"shuffle",onClick:W[5]||(W[5]=P=>N.$emit("toggleshuffle"))},null,8,["class"]),G.createVNode(b,{class:G.normalizeClass(["aplayer-icon-mode",{inactive:k.repeat==="no-repeat"}]),icon:k.repeat==="repeat-one"?"repeat-one":"repeat-all",onClick:W[6]||(W[6]=P=>N.$emit("nextmode"))},null,8,["icon","class"]),G.createVNode(b,{class:G.normalizeClass(["aplayer-icon-menu",{inactive:!N.$parent.showList}]),icon:"menu",onClick:W[7]||(W[7]=P=>N.$emit("togglelist"))},null,8,["class"])])])}var Ct=pe(St,[["render",Mt]]),ar="";const bt={props:{currentMusic:{type:Object,required:!0},playStat:{type:Object,required:!0}},data(){return{displayLrc:"",currentLineIndex:0}},computed:{lrcLines(){return dt(this.displayLrc)},currentLine(){return this.currentLineIndex>this.lrcLines.length-1?null:this.lrcLines[this.currentLineIndex]},transformStyle(){return{transform:`translateY(${-this.currentLineIndex*16}px)`,webkitTransform:`translateY(${-this.currentLineIndex*16}px)`}}},methods:{applyLrc(N){/^https?:\/\//.test(N)?this.fetchLrc(N):this.displayLrc=N},fetchLrc(N){fetch(N).then(W=>W.text()).then(W=>{this.displayLrc=W})},hideLrc(){this.displayLrc=""}},watch:{currentMusic:{immediate:!0,handler(N){this.currentLineIndex=0,N.lrc?this.applyLrc(N.lrc):this.hideLrc()}},"playStat.playedTime"(N){for(let W=0;W<this.lrcLines.length;W++){const k=this.lrcLines[W],C=this.lrcLines[W+1];N>=k[0]&&(!C||N<C[0])&&(this.currentLineIndex=W)}}}},_t={class:"aplayer-lrc"};function Bt(N,W,k,C,p,M){return G.openBlock(),G.createElementBlock("div",_t,[G.createElementVNode("div",{class:"aplayer-lrc-contents",style:G.normalizeStyle(M.transformStyle)},[(G.openBlock(!0),G.createElementBlock(G.Fragment,null,G.renderList(M.lrcLines,(D,L)=>(G.openBlock(),G.createElementBlock("p",{key:L,class:G.normalizeClass({"aplayer-lrc-current":L===p.currentLineIndex})},G.toDisplayString(D[1]),3))),128))],4)])}var Ft=pe(bt,[["render",Bt]]),sr="";let Ut=G.version,He=!1;const be=ht("Vue.version","2.3.0")>=0,ke={};let Ie=null;const ae={NONE:"none",MUSIC:"music",LIST:"list",NO_REPEAT:"no-repeat",REPEAT_ONE:"repeat-one",REPEAT_ALL:"repeat-all"},Nt=G.defineComponent({name:"vue-aplayer",disableVersionBadge:!1,components:{Thumbnail:it,Controls:Ct,MusicList:ft,Lyrics:Ft},props:{music:{type:Object,required:!0,validator(N){return!!N.src}},list:{type:Array,default(){return[]}},mini:{type:Boolean,default:!1},showLrc:{type:Boolean,default:!1},mutex:{type:Boolean,default:!0},theme:{type:String,default:"#41b883"},listMaxHeight:String,listFolded:{type:Boolean,default:!1},float:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},controls:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},preload:String,volume:{type:Number,default:.8,validator(N){return N>=0&&N<=1}},shuffle:{type:Boolean,default:!1},repeat:{type:String,default:ae.NO_REPEAT}},data(){return{internalMusic:this.music,isPlaying:!1,isSeeking:!1,wasPlayingBeforeSeeking:!1,isMobile:/mobile/i.test(window.navigator.userAgent),playStat:{duration:0,loadedTime:0,playedTime:0},showList:!this.listFolded,audioPlayPromise:Promise.resolve(),floatOriginX:0,floatOriginY:0,floatOffsetLeft:0,floatOffsetTop:0,selfAdaptingTheme:null,internalMuted:this.muted,internalVolume:this.volume,isLoading:!1,internalShuffle:this.shuffle,internalRepeat:this.repeat,shuffledList:[]}},computed:{audio(){return this.$refs.audio},currentMusic:{get(){return this.internalMusic},set(N){be&&this.$emit("update:music",N),this.internalMusic=N}},currentTheme(){return this.selfAdaptingTheme||this.currentMusic.theme||this.theme},isFloatMode(){return this.float&&!this.isMobile},shouldAutoplay(){return this.isMobile?!1:this.autoplay},musicList(){return this.list},shouldShowNativeControls(){return!1},floatStyleObj(){return{transform:`translate(${this.floatOffsetLeft}px, ${this.floatOffsetTop}px)`,webkitTransform:`translate(${this.floatOffsetLeft}px, ${this.floatOffsetTop}px)`}},currentPicStyleObj(){return this.currentMusic&&this.currentMusic.pic?{backgroundImage:`url(${this.currentMusic.pic})`}:{}},loadProgress(){return this.playStat.duration===0?0:this.playStat.loadedTime/this.playStat.duration},playProgress(){return this.playStat.duration===0?0:this.playStat.playedTime/this.playStat.duration},playIndex:{get(){return this.shuffledList.indexOf(this.currentMusic)},set(N){this.currentMusic=this.shuffledList[N%this.shuffledList.length]}},shouldRepeat(){return this.repeatMode!==ae.NO_REPEAT},isAudioMuted:{get(){return this.internalMuted},set(N){be&&this.$emit("update:muted",N),this.internalMuted=N}},audioVolume:{get(){return this.internalVolume},set(N){be&&this.$emit("update:volume",N),this.internalVolume=N}},shouldShuffle:{get(){return this.internalShuffle},set(N){be&&this.$emit("update:shuffle",N),this.internalShuffle=N}},repeatMode:{get(){switch(this.internalRepeat){case ae.NONE:case ae.NO_REPEAT:return ae.NO_REPEAT;case ae.MUSIC:case ae.REPEAT_ONE:return ae.REPEAT_ONE;default:return ae.REPEAT_ALL}},set(N){be&&this.$emit("update:repeat",N),this.internalRepeat=N}}},methods:{onDragBegin(){this.floatOriginX=this.floatOffsetLeft,this.floatOriginY=this.floatOffsetTop},onDragAround({offsetLeft:N,offsetTop:W}){this.floatOffsetLeft=this.floatOriginX+N,this.floatOffsetTop=this.floatOriginY+W},setNextMode(){this.repeatMode===ae.REPEAT_ALL?this.repeatMode=ae.REPEAT_ONE:this.repeatMode===ae.REPEAT_ONE?this.repeatMode=ae.NO_REPEAT:this.repeatMode=ae.REPEAT_ALL},thenPlay(){this.$nextTick(()=>{this.play()})},toggle(){this.audio.paused?this.play():this.pause()},play(){this.mutex&&(Ie&&Ie!==this&&Ie.pause(),Ie=this);const N=this.audio.play();if(N)return this.audioPlayPromise=new Promise((W,k)=>{this.rejectPlayPromise=k,N.then(C=>{this.rejectPlayPromise=null,W(C)}).catch(Be)})},pause(){this.audioPlayPromise.then(()=>{this.audio.pause()}).catch(()=>{this.audio.pause()}),this.rejectPlayPromise&&(this.rejectPlayPromise(),this.rejectPlayPromise=null)},onProgressDragBegin(N){this.wasPlayingBeforeSeeking=this.isPlaying,this.pause(),this.isSeeking=!0,isNaN(this.audio.duration)||(this.audio.currentTime=this.audio.duration*N)},onProgressDragging(N){isNaN(this.audio.duration)?this.playStat.playedTime=0:this.audio.currentTime=this.audio.duration*N},onProgressDragEnd(N){this.isSeeking=!1,this.wasPlayingBeforeSeeking&&this.thenPlay()},toggleMute(){this.setAudioMuted(!this.audio.muted)},setAudioMuted(N){this.audio.muted=N},setAudioVolume(N){this.audio.volume=N,N>0&&this.setAudioMuted(!1)},getShuffledList(){if(!this.list.length)return[this.internalMusic];let N=[...this.list];if(!this.internalShuffle||N.length<=1)return N;let W=N.indexOf(this.internalMusic);if(N.length===2&&W!==-1)return W===0?N:[this.internalMusic,N[0]];for(let k=N.length-1;k>0;k--){const C=Math.floor(Math.random()*(k+1)),p=N[k];N[k]=N[C],N[C]=p}return W!==-1&&(W=N.indexOf(this.internalMusic),W!==0&&([N[0],N[W]]=[N[W],N[0]])),N},onSelectSong(N){this.currentMusic===N?this.toggle():(this.currentMusic=N,this.thenPlay())},onAudioPlay(){this.isPlaying=!0},onAudioPause(){this.isPlaying=!1},onAudioWaiting(){this.isLoading=!0},onAudioCanplay(){this.isLoading=!1},onAudioDurationChange(){this.audio.duration!==1&&(this.playStat.duration=this.audio.duration)},onAudioProgress(){this.audio.buffered.length?this.playStat.loadedTime=this.audio.buffered.end(this.audio.buffered.length-1):this.playStat.loadedTime=0},onAudioTimeUpdate(){this.playStat.playedTime=this.audio.currentTime},onAudioSeeking(){this.playStat.playedTime=this.audio.currentTime},onAudioSeeked(){this.playStat.playedTime=this.audio.currentTime},onAudioVolumeChange(){this.audioVolume=this.audio.volume,this.isAudioMuted=this.audio.muted},onAudioEnded(){this.repeatMode===ae.REPEAT_ALL?(this.shouldShuffle&&this.playIndex===this.shuffledList.length-1&&(this.shuffledList=this.getShuffledList()),this.playIndex++,this.thenPlay()):this.repeatMode===ae.REPEAT_ONE?this.thenPlay():(this.playIndex++,this.playIndex!==0?this.thenPlay():this.shuffledList.length===1&&(this.audio.currentTime=0))},initAudio(){this.audio.controls=this.shouldShowNativeControls,this.audio.muted=this.muted,this.audio.preload=this.preload,this.audio.volume=this.volume,["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"].forEach(W=>{this.audio.addEventListener(W,k=>this.$emit(W,k))}),this.audio.addEventListener("play",this.onAudioPlay),this.audio.addEventListener("pause",this.onAudioPause),this.audio.addEventListener("abort",this.onAudioPause),this.audio.addEventListener("waiting",this.onAudioWaiting),this.audio.addEventListener("canplay",this.onAudioCanplay),this.audio.addEventListener("progress",this.onAudioProgress),this.audio.addEventListener("durationchange",this.onAudioDurationChange),this.audio.addEventListener("seeking",this.onAudioSeeking),this.audio.addEventListener("seeked",this.onAudioSeeked),this.audio.addEventListener("timeupdate",this.onAudioTimeUpdate),this.audio.addEventListener("volumechange",this.onAudioVolumeChange),this.audio.addEventListener("ended",this.onAudioEnded),this.currentMusic&&(this.audio.src=this.currentMusic.src)},setSelfAdaptingTheme(){if((this.currentMusic.theme||this.theme)==="pic"){const N=this.currentMusic.pic;if(ke[N])this.selfAdaptingTheme=ke[N];else try{new ColorThief().getColorAsync(N,([W,k,C])=>{ke[N]=`rgb(${W}, ${k}, ${C})`,this.selfAdaptingTheme=`rgb(${W}, ${k}, ${C})`})}catch{Be("color-thief is required to support self-adapting theme")}}else this.selfAdaptingTheme=null}},watch:{music(N){this.internalMusic=N},currentMusic:{handler(N){this.setSelfAdaptingTheme();const W=N.src;if(/\.m3u8(?=(#|\?|$))/.test(W))if(this.audio.canPlayType("application/x-mpegURL")||this.audio.canPlayType("application/vnd.apple.mpegURL"))this.audio.src=W;else try{Ge.isSupported()?(this.hls||(this.hls=new Ge),this.hls.loadSource(W),this.hls.attachMedia(this.audio)):(Be("HLS is not supported on your browser"),this.audio.src=W)}catch{Be("hls.js is required to support m3u8"),this.audio.src=W}else this.audio.src=W}},shouldShowNativeControls(N){this.audio.controls=N},isAudioMuted(N){this.audio.muted=N},preload(N){this.audio.preload=N},audioVolume(N){this.audio.volume=N},muted(N){this.internalMuted=N},volume(N){this.internalVolume=N},shuffle(N){this.internalShuffle=N},repeat(N){this.internalRepeat=N}},beforeMount(){!this.disableVersionBadge&&!He&&(console.log(`

 %c Vue-APlayer ${Ut} %c vue-aplayer.js.org 
`,"color: #fff; background:#41b883; padding:5px 0;","color: #fff; background: #35495e; padding:5px 0;"),He=!0),this.shuffledList=this.getShuffledList()},mounted(){this.initAudio(),this.setSelfAdaptingTheme(),this.autoplay&&this.play()},beforeDestroy(){Ie===this&&(Ie=null),this.hls&&this.hls.destroy()}}),kt={class:"aplayer-body"},wt={class:"aplayer-info"},Kt={class:"aplayer-music"},Wt={class:"aplayer-title"},Gt={class:"aplayer-author"},jt={ref:"audio"};function Ht(N,W,k,C,p,M){const D=G.resolveComponent("thumbnail"),L=G.resolveComponent("lyrics"),b=G.resolveComponent("controls"),P=G.resolveComponent("music-list");return G.openBlock(),G.createElementBlock("div",{class:G.normalizeClass(["aplayer",{"aplayer-mini":N.mini,"aplayer-withlist":!N.mini&&N.musicList.length>0,"aplayer-withlrc":!N.mini&&(!!N.$slots.display||N.showLrc),"aplayer-float":N.isFloatMode,"aplayer-loading":N.isPlaying&&N.isLoading}]),style:G.normalizeStyle(N.floatStyleObj)},[G.createElementVNode("div",kt,[G.createVNode(D,{pic:N.currentMusic.pic,playing:N.isPlaying,"enable-drag":N.isFloatMode,theme:N.currentTheme,onToggleplay:N.toggle,onDragbegin:N.onDragBegin,onDragging:N.onDragAround},null,8,["pic","playing","enable-drag","theme","onToggleplay","onDragbegin","onDragging"]),G.withDirectives(G.createElementVNode("div",wt,[G.createElementVNode("div",Kt,[G.createElementVNode("span",Wt,G.toDisplayString(N.currentMusic.title||"Untitled"),1),G.createElementVNode("span",Gt,G.toDisplayString(N.currentMusic.artist||"Unknown"),1)]),G.renderSlot(N.$slots,"display",{currentMusic:N.currentMusic,playStat:N.playStat},()=>[N.showLrc?(G.openBlock(),G.createBlock(L,{key:0,"current-music":N.currentMusic,"play-stat":N.playStat},null,8,["current-music","play-stat"])):G.createCommentVNode("",!0)]),G.createVNode(b,{shuffle:N.shouldShuffle,repeat:N.repeatMode,stat:N.playStat,volume:N.audioVolume,muted:N.isAudioMuted,theme:N.currentTheme,onToggleshuffle:W[0]||(W[0]=O=>N.shouldShuffle=!N.shouldShuffle),onTogglelist:W[1]||(W[1]=O=>N.showList=!N.showList),onTogglemute:N.toggleMute,onSetvolume:N.setAudioVolume,onDragbegin:N.onProgressDragBegin,onDragend:N.onProgressDragEnd,onDragging:N.onProgressDragging,onNextmode:N.setNextMode},null,8,["shuffle","repeat","stat","volume","muted","theme","onTogglemute","onSetvolume","onDragbegin","onDragend","onDragging","onNextmode"])],512),[[G.vShow,!N.mini]])]),G.createElementVNode("audio",jt,null,512),G.createVNode(P,{show:N.showList&&!N.mini,"current-music":N.currentMusic,"music-list":N.musicList,"play-index":N.playIndex,listmaxheight:N.listMaxHeight,theme:N.currentTheme,onSelectsong:N.onSelectSong},null,8,["show","current-music","music-list","play-index","listmaxheight","theme","onSelectsong"])],6)}var Ve=pe(Nt,[["render",Ht]]),Vt={install(N){N.component(Ve.name,Ve)}};return Vt});
